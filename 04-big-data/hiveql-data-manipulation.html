
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>HiveQL: Data Manipulation</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="PySpark: Data Exploratory" href="pyspark-data-exploratory.html" />
    <link rel="prev" title="4. Big Data" href="_intro.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/logo.svg" class="logo" alt="logo">
      
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="current nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../01-python-programing/_intro.html">
   <b>
    1. Python Programing
   </b>
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../01-python-programing/python-basic-concepts.html">
     Python: Basic Concepts
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../01-python-programing/python-data-types.html">
     Python: Data Types
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../01-python-programing/python-data-containers.html">
     Python: Data Containers
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../01-python-programing/python-functions-objects.html">
     Python: Functions and Objects
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../01-python-programing/python-algorithms.html">
     (w) Python: Algorithms
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../01-python-programing/python-external-sources.html">
     Python: External Sources
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../01-python-programing/selenium-web-scraping.html">
     Selenium: Web Scraping
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../02-mathematics/_intro.html">
   <b>
    2. Mathematics
   </b>
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../02-mathematics/numpy-linear-algebra.html">
     NumPy: Linear Algebra
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../02-mathematics/sympy-calculus.html">
     SymPy: Calculus
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../02-mathematics/numpy-probability.html">
     NumPy: Probability
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../02-mathematics/numpy-statistics.html">
     NumPy: Statistics
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../02-mathematics/scipy-hypothesis-testing.html">
     SciPy: Hypothesis Testing
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../02-mathematics/numpy-applied-mathematics.html">
     (w) NumPy: Applied Mathematics
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../02-mathematics/networkx-network-analysis.html">
     (w) NetworkX: Network Analysis
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../03-data-manipulation/_intro.html">
   <b>
    3. Data Manipulation
   </b>
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../03-data-manipulation/numpy-arrays.html">
     NumPy: Arrays
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03-data-manipulation/pandas-data-exploratory.html">
     Pandas: Data Exploratory
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03-data-manipulation/pandas-data-cleaning.html">
     Pandas: Data Cleaning
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03-data-manipulation/pandas-data-transformation.html">
     Pandas: Data Transformation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03-data-manipulation/janitor-pandas-extensions.html">
     Janitor: Pandas Extensions
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="_intro.html">
   <b>
    4. Big Data
   </b>
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     HiveQL: Data Manipulation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="pyspark-data-exploratory.html">
     PySpark: Data Exploratory
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="pyspark-data-cleaning.html">
     PySpark: Data Cleaning
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="pyspark-data-transformation.html">
     PySpark: Data Transformation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="dask-parallelized-pandas.html">
     Dask: Parallelized Pandas
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../05-data-visualization/_intro.html">
   <b>
    5. Data Visualization
   </b>
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../05-data-visualization/matplotlib-graph-construction.html">
     Matplotlib: Graph Construction
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../05-data-visualization/seaborn-statistical-visualization.html">
     Seaborn: Statistical Visualization
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../05-data-visualization/plotly-interactive-visualization.html">
     Plotly: Interactive Visualization
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../06-machine-learning/_intro.html">
   <b>
    6. Machine Learning
   </b>
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../06-machine-learning/sklearn-machine-learning.html">
     Sklearn: Machine Learning
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../06-machine-learning/sklearn-classification.html">
     Sklearn: Classification
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../06-machine-learning/sklearn-regression.html">
     Sklearn: Regression
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../06-machine-learning/sklearn-feature-engineering.html">
     Featuretools: Feature Engineering
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../06-machine-learning/lenskit-recommendation.html">
     Lenskit: Recommendation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../06-machine-learning/pyspark-machine-learning.html">
     PySpark: Machine Learning
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../07-tabular-learning/_intro.html">
   <b>
    7. Tabular Learning
   </b>
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
  <label for="toctree-checkbox-7">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../07-tabular-learning/sklearn-ensemble-learning.html">
     Sklearn: Ensemble Learning
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../07-tabular-learning/xgboost-tree-boosting.html">
     XGBoost: Tree Boosting
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../07-tabular-learning/ray-hyperparameter-optimization.html">
     Ray: Hyperparam Optimization
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../07-tabular-learning/shap-model-interpretation.html">
     Shap: Model Interpretation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../07-tabular-learning/imblearn-targeted-modeling.html">
     Imblearn: Targeted Modeling
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../08-time-series/_intro.html">
   <b>
    8. Time Series
   </b>
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
  <label for="toctree-checkbox-8">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../08-time-series/statsmodels-temporal-analysis.html">
     Statsmodels: Temporal Analysis
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../08-time-series/prophet-forecasting-algorithms.html">
     Prophet: Forecasting Algorithms
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../08-time-series/sktime-forecasting-pipeline.html">
     Sktime: Forecasting Pipeline
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../08-time-series/darts-deep-forecasting.html">
     (w) Darts: Deep Forecasting
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../09-unsupervised-learning/_intro.html">
   <b>
    9. Unsupervised Learning
   </b>
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/>
  <label for="toctree-checkbox-9">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../09-unsupervised-learning/mlxtend-association-rules.html">
     (w) MLxtend: Association Rules
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../09-unsupervised-learning/sklearn-clustering.html">
     Sklearn: Clustering
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../09-unsupervised-learning/sklearn-dimensional-reduction.html">
     Sklearn: Dimensional Reduction
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../09-unsupervised-learning/pyod-anomaly-detection.html">
     PyOD: Anomaly Detection
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../10-deep-learning/_intro.html">
   <b>
    10. Deep Learning
   </b>
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/>
  <label for="toctree-checkbox-10">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../10-deep-learning/gensim-text-mining.html">
     Gensim: Text Mining
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../10-deep-learning/opencv-image-processing.html">
     (w) OpenCV: Image Processing
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../10-deep-learning/numpy-gradient-descent.html">
     Python: Gradient Descent
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../10-deep-learning/keras-multilayer-perceptron.html">
     Keras: Multilayer Perceptron
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../10-deep-learning/keras-recurrent-networks.html">
     Keras: Recurrent Networks
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../10-deep-learning/keras-convolutional-networks.html">
     (w) Keras: Convolutional Networks
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../10-deep-learning/pytorch-deep-learning.html">
     PyTorch: Deep Learning
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../10-deep-learning/transformers-transfer-learning.html">
     (w) Transformers: Transfer Learning
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../11-r-programing/_intro.html">
   <b>
    11. R Programing
   </b>
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/>
  <label for="toctree-checkbox-11">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../11-r-programing/r-basic-concepts.html">
     R: Basic Concepts
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../11-r-programing/r-data-structures.html">
     R: Data Structures
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../11-r-programing/tidyverse-data-wrangling.html">
     Tidyverse: Data Wrangling
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../11-r-programing/dplyr-data-cleaning.html">
     Dplyr: Data Cleaning
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../11-r-programing/ggplot-data-visualization.html">
     Ggplot: Data Visualization
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../11-r-programing/r-statistics.html">
     R: Statistics
    </a>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/hungpq7/tabular-book/master?urlpath=lab/tree/04-big-data/hiveql-data-manipulation.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
      <li>
        <a href="https://colab.research.google.com/github/hungpq7/tabular-book/blob/master/04-big-data/hiveql-data-manipulation.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Colab"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../_static/images/logo_colab.png">
  </span>
<span class="headerbtn__text-container">Colab</span>
</a>

      </li>
      
      <li>
        
<button onclick="initThebeSBT()"
  class="headerbtn headerbtn-launch-thebe"
  data-toggle="tooltip"
data-placement="left"
title="Launch Thebe"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-play"></i>
  </span>
<span class="headerbtn__text-container">Live Code</span>
</button>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>
<a href="https://github.com/hungpq7/tabular-book"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="bottom"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>

</a>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#managing-tables">
   1. Managing tables
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#creating-tables">
     1.1. Creating tables
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#manually-creating-tables">
       Manually creating tables
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#metadata">
       Metadata
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#partitioning">
       Partitioning
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#importing-local-files">
     1.2. Importing local files
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#hive-data-types">
     1.3. Hive data types
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#aliases">
     1.4. Aliases
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-manipulation">
   2. Data manipulation
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#filtering">
     2.1. Filtering
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#aggregating">
     2.2. Aggregating
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#window-functions">
     2.3. Window functions
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#gathering-data">
     2.4. Gathering data
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#order-of-execution">
     2.5. Order of execution
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#functions">
     2.6. Functions
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#numeric-functions">
       Numeric functions
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#text-functions">
       Text functions
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-structures">
   3. Data structures
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#array-type">
     3.1. Array type
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#creating-array">
       Creating array
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#array-manipulation">
       Array manipulation
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#struct-type">
     3.2. Struct type
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#map-type">
     3.3. Map type
    </a>
   </li>
  </ul>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>HiveQL: Data Manipulation</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#managing-tables">
   1. Managing tables
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#creating-tables">
     1.1. Creating tables
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#manually-creating-tables">
       Manually creating tables
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#metadata">
       Metadata
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#partitioning">
       Partitioning
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#importing-local-files">
     1.2. Importing local files
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#hive-data-types">
     1.3. Hive data types
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#aliases">
     1.4. Aliases
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-manipulation">
   2. Data manipulation
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#filtering">
     2.1. Filtering
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#aggregating">
     2.2. Aggregating
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#window-functions">
     2.3. Window functions
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#gathering-data">
     2.4. Gathering data
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#order-of-execution">
     2.5. Order of execution
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#functions">
     2.6. Functions
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#numeric-functions">
       Numeric functions
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#text-functions">
       Text functions
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-structures">
   3. Data structures
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#array-type">
     3.1. Array type
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#creating-array">
       Creating array
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#array-manipulation">
       Array manipulation
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#struct-type">
     3.2. Struct type
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#map-type">
     3.3. Map type
    </a>
   </li>
  </ul>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="hiveql-data-manipulation">
<h1>HiveQL: Data Manipulation<a class="headerlink" href="#hiveql-data-manipulation" title="Permalink to this headline">#</a></h1>
<p>JupyterLab allows writing SQL query directly in-cell, thanks to the <code class="docutils literal notranslate"><span class="pre">%sparksql</span></code> magic command (use two percent signs <code class="docutils literal notranslate"><span class="pre">%%sparksql</span></code> to span code in multiple lines). An amazing feature is that PySpark can also interacts with this enviroment. This means all local files can be read as Hive tables.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">findspark</span>
<span class="kn">from</span> <span class="nn">pyspark.sql</span> <span class="kn">import</span> <span class="n">SparkSession</span>
<span class="kn">import</span> <span class="nn">pyspark.sql.functions</span> <span class="k">as</span> <span class="nn">F</span>
<span class="kn">import</span> <span class="nn">pyspark.sql.types</span> <span class="k">as</span> <span class="nn">T</span>

<span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSession</span><span class="o">.</span><span class="n">builder</span><span class="o">.</span><span class="n">master</span><span class="p">(</span><span class="s1">&#39;local&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">enableHiveSupport</span><span class="p">()</span><span class="o">.</span><span class="n">getOrCreate</span><span class="p">()</span>
<span class="n">spark</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;spark.sql.repl.eagerEval.enabled&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">spark</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;spark.sql.repl.eagerEval.truncate&#39;</span><span class="p">,</span> <span class="mi">80</span><span class="p">)</span>
<span class="n">spark</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;spark.sql.repl.eagerEval.maxNumRows&#39;</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>

<span class="o">%</span><span class="k">load_ext</span> sparksql_magic
<span class="o">%</span><span class="k">config</span> SparkSql.limit=20
</pre></div>
</div>
</div>
</div>
<section id="managing-tables">
<h2>1. Managing tables<a class="headerlink" href="#managing-tables" title="Permalink to this headline">#</a></h2>
<section id="creating-tables">
<h3>1.1. Creating tables<a class="headerlink" href="#creating-tables" title="Permalink to this headline">#</a></h3>
<section id="manually-creating-tables">
<h4>Manually creating tables<a class="headerlink" href="#manually-creating-tables" title="Permalink to this headline">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sparksql</span>

CREATE EXTERNAL TABLE IF NOT EXISTS tbl_product
STORED AS PARQUET
LOCATION &#39;../spark_db/tbl_product&#39;
TBLPROPERTIES (&#39;parquet.compression&#39;=&#39;snappy&#39;)

SELECT *
FROM VALUES
    (&#39;Laptop&#39;, 1000, 15),
    (&#39;Mouse&#39;, 20, 100),
    (&#39;Headphone&#39;, 50, 50),
    (&#39;USB&#39;, NULL, 100)
AS (product, price, stock)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table><tr style="border-bottom: 1px solid"></tr></table></div></div>
</div>
</section>
<section id="metadata">
<h4>Metadata<a class="headerlink" href="#metadata" title="Permalink to this headline">#</a></h4>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="text-align:left head"><p>Statement</p></th>
<th class="text-align:left head"><p>Usage</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">DESC</span> <span class="pre">&lt;table_name&gt;</span></code></p></td>
<td class="text-align:left"><p>Show columns and comments of a table</p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">DESC</span> <span class="pre">FORMATTED</span> <span class="pre">&lt;table_name&gt;</span></code></p></td>
<td class="text-align:left"><p>Show detailed information of a table</p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">SHOW</span> <span class="pre">CREATE</span> <span class="pre">TABLE</span> <span class="pre">&lt;table_name&gt;</span></code></p></td>
<td class="text-align:left"><p>Get the script that created the table</p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">DROP</span> <span class="pre">TABLE</span> <span class="pre">IF</span> <span class="pre">EXISTS</span> <span class="pre">&lt;table_name&gt;</span></code></p></td>
<td class="text-align:left"><p>Drop a table</p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">SHOW</span> <span class="pre">DATABASES</span></code></p></td>
<td class="text-align:left"><p>Show all available databases</p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">DESC</span> <span class="pre">DATABASE</span> <span class="pre">EXTENDED</span> <span class="pre">&lt;database_name&gt;</span></code></p></td>
<td class="text-align:left"><p>Show information about a database</p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">USE</span> <span class="pre">&lt;database_name&gt;</span></code></p></td>
<td class="text-align:left"><p>Enter a specific database</p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">SHOW</span> <span class="pre">TABLES</span></code></p></td>
<td class="text-align:left"><p>Show all available tables and view</p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p><code class="docutils literal notranslate"><span class="pre">SHOW</span> <span class="pre">TABLES</span> <span class="pre">LIKE</span> <span class="pre">&lt;pattern&gt;</span></code></p></td>
<td class="text-align:left"><p>Show all tables having a specific pattern in their name</p></td>
</tr>
</tbody>
</table>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sparksql</span>

DESC tbl_product
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table><tr style="border-bottom: 1px solid"><td style="font-weight: bold">col_name</td><td style="font-weight: bold">data_type</td><td style="font-weight: bold">comment</td></tr><tr><td>product</td><td>string</td><td>null</td></tr><tr><td>price</td><td>int</td><td>null</td></tr><tr><td>stock</td><td>int</td><td>null</td></tr></table></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sparksql</span>

SHOW TABLES LIKE &#39;*product*&#39;
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table><tr style="border-bottom: 1px solid"><td style="font-weight: bold">database</td><td style="font-weight: bold">tableName</td><td style="font-weight: bold">isTemporary</td></tr><tr><td>default</td><td>tbl_product</td><td>False</td></tr></table></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sparksql</span>

ALTER TABLE tbl_product SET TBLPROPERTIES(&#39;external&#39;=&#39;false&#39;, &#39;auto.purge&#39;=&#39;true&#39;)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table><tr style="border-bottom: 1px solid"></tr></table></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sparksql</span>

DROP TABLE IF EXISTS tbl_product
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table><tr style="border-bottom: 1px solid"></tr></table></div></div>
</div>
</section>
<section id="partitioning">
<h4>Partitioning<a class="headerlink" href="#partitioning" title="Permalink to this headline">#</a></h4>
<p>A unique feature of SparkSQL is organizing tables in partitions, which helps achieve more parallelism. A categorical column or two may be used as partition columns. Data can be inserted to a partition using <code class="docutils literal notranslate"><span class="pre">INSERT</span> <span class="pre">INTO</span> <span class="pre">TABLE</span></code> or <code class="docutils literal notranslate"><span class="pre">INSERT</span> <span class="pre">OVERWRITE</span> <span class="pre">TABLE</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sparksql</span>

CREATE TABLE IF NOT EXISTS tbl_product (
    product STRING COMMENT &#39;name of product&#39;,
    price INT COMMENT &#39;price of product&#39;,
    stock INT COMMENT &#39;number of products left&#39;
)
PARTITIONED BY (day STRING COMMENT &#39;day&#39;, hour STRING COMMENT &#39;hour&#39;)
STORED AS PARQUET
LOCATION &#39;../spark_db/tbl_product&#39;
TBLPROPERTIES (&#39;parquet.compression&#39;=&#39;snappy&#39;)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table><tr style="border-bottom: 1px solid"></tr></table></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sparksql</span>

INSERT OVERWRITE TABLE tbl_product
PARTITION (day=20210725, hour=14)
VALUES
    (&#39;Laptop&#39;, 1000, 25),
    (&#39;Mouse&#39;, 30, 100),
    (&#39;Headphone&#39;, 50, 50)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table><tr style="border-bottom: 1px solid"></tr></table></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sparksql</span>

INSERT INTO TABLE tbl_product
PARTITION (day=20210725, hour=21)
VALUES
    (&#39;Laptop&#39;, 1000, 20),
    (&#39;Mouse&#39;, 20, 97),
    (&#39;Headphone&#39;, 65, 12)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table><tr style="border-bottom: 1px solid"></tr></table></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sparksql</span>

SHOW PARTITIONS tbl_product
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table><tr style="border-bottom: 1px solid"><td style="font-weight: bold">partition</td></tr><tr><td>day=20210725/hour=14</td></tr><tr><td>day=20210725/hour=21</td></tr></table></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sparksql</span>

ALTER TABLE tbl_product DROP IF EXISTS PARTITION (day=20210725)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table><tr style="border-bottom: 1px solid"></tr></table></div></div>
</div>
</section>
</section>
<section id="importing-local-files">
<h3>1.2. Importing local files<a class="headerlink" href="#importing-local-files" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">csv</span><span class="p">(</span><span class="s1">&#39;../data/youtube_trending.csv&#39;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inferSchema</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">df</span>\
    <span class="o">.</span><span class="n">write</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;parquet&#39;</span><span class="p">)</span>\
    <span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s1">&#39;compression&#39;</span><span class="p">,</span> <span class="s1">&#39;snappy&#39;</span><span class="p">)</span>\
    <span class="o">.</span><span class="n">mode</span><span class="p">(</span><span class="s1">&#39;overwrite&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">saveAsTable</span><span class="p">(</span><span class="s1">&#39;tbl_youtube&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sparksql</span>

SELECT * FROM tbl_youtube LIMIT 5
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table><tr style="border-bottom: 1px solid"><td style="font-weight: bold">video_id</td><td style="font-weight: bold">trending_date</td><td style="font-weight: bold">channel_title</td><td style="font-weight: bold">category_id</td><td style="font-weight: bold">publish_time</td><td style="font-weight: bold">views</td><td style="font-weight: bold">likes</td><td style="font-weight: bold">dislikes</td><td style="font-weight: bold">comment_count</td><td style="font-weight: bold">comments_disabled</td><td style="font-weight: bold">ratings_disabled</td></tr><tr><td>2kyS6SvSYSE</td><td>2017-11-14</td><td>CaseyNeistat</td><td>22</td><td>2017-11-14 00:13:01</td><td>748374</td><td>57527</td><td>2966</td><td>15954</td><td>False</td><td>False</td></tr><tr><td>1ZAPwfrtAFY</td><td>2017-11-14</td><td>LastWeekTonight</td><td>24</td><td>2017-11-13 14:30:00</td><td>2418783</td><td>97185</td><td>6146</td><td>12703</td><td>False</td><td>False</td></tr><tr><td>5qpjK5DgCt4</td><td>2017-11-14</td><td>Rudy Mancuso</td><td>23</td><td>2017-11-13 02:05:24</td><td>3191434</td><td>146033</td><td>5339</td><td>8181</td><td>False</td><td>False</td></tr><tr><td>puqaWrEC7tY</td><td>2017-11-14</td><td>Good Mythical Morning</td><td>24</td><td>2017-11-13 18:00:04</td><td>343168</td><td>10172</td><td>666</td><td>2146</td><td>False</td><td>False</td></tr><tr><td>d380meD0W0M</td><td>2017-11-14</td><td>nigahiga</td><td>24</td><td>2017-11-13 01:01:41</td><td>2095731</td><td>132235</td><td>1989</td><td>17518</td><td>False</td><td>False</td></tr></table></div></div>
</div>
</section>
<section id="hive-data-types">
<h3>1.3. Hive data types<a class="headerlink" href="#hive-data-types" title="Permalink to this headline">#</a></h3>
<ul class="simple">
<li><p>Numeric types: <code class="docutils literal notranslate"><span class="pre">TINYINT</span></code>, <code class="docutils literal notranslate"><span class="pre">SMALLINT</span></code>, <code class="docutils literal notranslate"><span class="pre">INTEGER</span></code>, <code class="docutils literal notranslate"><span class="pre">BIGINT</span></code>, <code class="docutils literal notranslate"><span class="pre">FLOAT</span></code>, <code class="docutils literal notranslate"><span class="pre">DOUBLE</span></code>, <code class="docutils literal notranslate"><span class="pre">DECIMAL</span></code>, <code class="docutils literal notranslate"><span class="pre">NUMERIC</span></code></p></li>
<li><p>String types: <code class="docutils literal notranslate"><span class="pre">VARCHAR</span></code>, <code class="docutils literal notranslate"><span class="pre">CHAR</span></code></p></li>
<li><p>Datetime types: <code class="docutils literal notranslate"><span class="pre">TIMESTAMP</span></code>, <code class="docutils literal notranslate"><span class="pre">DATE</span></code>, <code class="docutils literal notranslate"><span class="pre">INTERVAL</span></code></p></li>
<li><p>Binary types: <code class="docutils literal notranslate"><span class="pre">BOOLEAN</span></code>, <code class="docutils literal notranslate"><span class="pre">BINARY</span></code></p></li>
<li><p>Container types: <code class="docutils literal notranslate"><span class="pre">ARRAY</span></code>, <code class="docutils literal notranslate"><span class="pre">MAP</span></code>, <code class="docutils literal notranslate"><span class="pre">STRUCT</span></code>, <code class="docutils literal notranslate"><span class="pre">UNIONTYPE</span></code></p></li>
</ul>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sparksql</span>

SELECT * FROM tbl_youtube LIMIT 3
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table><tr style="border-bottom: 1px solid"><td style="font-weight: bold">video_id</td><td style="font-weight: bold">trending_date</td><td style="font-weight: bold">channel_title</td><td style="font-weight: bold">category_id</td><td style="font-weight: bold">publish_time</td><td style="font-weight: bold">views</td><td style="font-weight: bold">likes</td><td style="font-weight: bold">dislikes</td><td style="font-weight: bold">comment_count</td><td style="font-weight: bold">comments_disabled</td><td style="font-weight: bold">ratings_disabled</td></tr><tr><td>2kyS6SvSYSE</td><td>2017-11-14</td><td>CaseyNeistat</td><td>22</td><td>2017-11-14 00:13:01</td><td>748374</td><td>57527</td><td>2966</td><td>15954</td><td>False</td><td>False</td></tr><tr><td>1ZAPwfrtAFY</td><td>2017-11-14</td><td>LastWeekTonight</td><td>24</td><td>2017-11-13 14:30:00</td><td>2418783</td><td>97185</td><td>6146</td><td>12703</td><td>False</td><td>False</td></tr><tr><td>5qpjK5DgCt4</td><td>2017-11-14</td><td>Rudy Mancuso</td><td>23</td><td>2017-11-13 02:05:24</td><td>3191434</td><td>146033</td><td>5339</td><td>8181</td><td>False</td><td>False</td></tr></table></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sparksql</span>

DESC tbl_youtube
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table><tr style="border-bottom: 1px solid"><td style="font-weight: bold">col_name</td><td style="font-weight: bold">data_type</td><td style="font-weight: bold">comment</td></tr><tr><td>video_id</td><td>string</td><td>null</td></tr><tr><td>trending_date</td><td>string</td><td>null</td></tr><tr><td>channel_title</td><td>string</td><td>null</td></tr><tr><td>category_id</td><td>int</td><td>null</td></tr><tr><td>publish_time</td><td>timestamp</td><td>null</td></tr><tr><td>views</td><td>int</td><td>null</td></tr><tr><td>likes</td><td>int</td><td>null</td></tr><tr><td>dislikes</td><td>int</td><td>null</td></tr><tr><td>comment_count</td><td>int</td><td>null</td></tr><tr><td>comments_disabled</td><td>boolean</td><td>null</td></tr><tr><td>ratings_disabled</td><td>boolean</td><td>null</td></tr></table></div></div>
</div>
<p>In Hive, using <code class="docutils literal notranslate"><span class="pre">CAST()</span></code> function to convert between data types.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sparksql</span>

SELECT  category_id, views, comments_disabled,
        CAST(category_id AS FLOAT) AS float_cat_id,
        CAST(views AS BIGINT) AS bigint_views,
        CAST(trending_date AS DATE) AS date,
        CAST(comments_disabled AS INT) AS int_comments_disabled
FROM tbl_youtube LIMIT 3
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table><tr style="border-bottom: 1px solid"><td style="font-weight: bold">category_id</td><td style="font-weight: bold">views</td><td style="font-weight: bold">comments_disabled</td><td style="font-weight: bold">float_cat_id</td><td style="font-weight: bold">bigint_views</td><td style="font-weight: bold">date</td><td style="font-weight: bold">int_comments_disabled</td></tr><tr><td>22</td><td>748374</td><td>False</td><td>22.0</td><td>748374</td><td>2017-11-14</td><td>0</td></tr><tr><td>24</td><td>2418783</td><td>False</td><td>24.0</td><td>2418783</td><td>2017-11-14</td><td>0</td></tr><tr><td>23</td><td>3191434</td><td>False</td><td>23.0</td><td>3191434</td><td>2017-11-14</td><td>0</td></tr></table></div></div>
</div>
<p>With datetime, we can use <code class="docutils literal notranslate"><span class="pre">CAST()</span></code>, <code class="docutils literal notranslate"><span class="pre">DATE()</span></code> or <code class="docutils literal notranslate"><span class="pre">TO_DATE()</span></code> functions to convert string to datetime. Note that <code class="docutils literal notranslate"><span class="pre">DATE()</span></code> can only user with format <em>yyyy-MM-dd</em> but <code class="docutils literal notranslate"><span class="pre">TO_DATE()</span></code> can add format parameter to fit with the input. There are also other <a class="reference external" href="https://sparkbyexamples.com/apache-hive/hive-date-and-timestamp-functions-examples/">datetime functions</a> as well.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sparksql</span>

SELECT  CAST(&#39;2021-08-10&#39; AS DATE) date,
        DATE(&#39;2021/08/10&#39;) date1,
        TO_DATE(&#39;2021/08/10&#39;, &#39;yyyy/MM/dd&#39;) as date2,
        CAST(date_format(current_date(),&#39;yyyy-MM-dd&#39;) as date) today,
        DATE(now()) as today1
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table><tr style="border-bottom: 1px solid"><td style="font-weight: bold">date</td><td style="font-weight: bold">date1</td><td style="font-weight: bold">date2</td><td style="font-weight: bold">today</td><td style="font-weight: bold">today1</td></tr><tr><td>2021-08-10</td><td>null</td><td>2021-08-10</td><td>2021-11-05</td><td>2021-11-05</td></tr></table></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sparksql</span>

SELECT  publish_time,
        UNIX_TIMESTAMP(publish_time) AS unix_publish_time,
        FROM_UNIXTIME(UNIX_TIMESTAMP(publish_time),&#39;yyyy/MM/dd HH.mm.ss&#39;) AS convert_publish_time
FROM tbl_youtube LIMIT 3
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table><tr style="border-bottom: 1px solid"><td style="font-weight: bold">publish_time</td><td style="font-weight: bold">unix_publish_time</td><td style="font-weight: bold">convert_publish_time</td></tr><tr><td>2017-11-14 00:13:01</td><td>1510593181</td><td>2017/11/14 00.13.01</td></tr><tr><td>2017-11-13 14:30:00</td><td>1510558200</td><td>2017/11/13 14.30.00</td></tr><tr><td>2017-11-13 02:05:24</td><td>1510513524</td><td>2017/11/13 02.05.24</td></tr></table></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sparksql</span>

SELECT  current_date() + interval &#39;1&#39; day AS tomorrow,
        current_date() + interval &#39;2&#39; days AS two_days_ago,
        current_date() + interval &#39;1&#39; week AS next_week,
        current_date() - interval &#39;2&#39; months AS two_months_ago,
        current_timestamp() - interval &#39;2&#39; hours AS two_hours_ago
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table><tr style="border-bottom: 1px solid"><td style="font-weight: bold">tomorrow</td><td style="font-weight: bold">two_days_ago</td><td style="font-weight: bold">next_week</td><td style="font-weight: bold">two_months_ago</td><td style="font-weight: bold">two_hours_ago</td></tr><tr><td>2021-11-06</td><td>2021-11-07</td><td>2021-11-12</td><td>2021-09-05</td><td>2021-11-05 08:19:37.611000</td></tr></table></div></div>
</div>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sparksql</span>

SELECT  publish_time,
        DATE(publish_time) AS publish_date,
        YEAR(publish_time) AS publish_year,
        MONTH(publish_time) AS publish_month,
        WEEKOFYEAR(publish_time) AS publish_week,
        QUARTER(publish_time) AS publish_quarter,
        HOUR(publish_time) AS publish_hour,
        TRUNC(CAST(publish_time AS STRING), &#39;MM&#39;) AS publish_firstday_of_month,
        EXTRACT(dayofweek from publish_time) AS publish_dayofweek,
        DATE_FORMAT(publish_time, &#39;dd.MM.yyyy&#39;) AS publish_date_format

FROM tbl_youtube
LIMIT 3
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table><tr style="border-bottom: 1px solid"><td style="font-weight: bold">publish_time</td><td style="font-weight: bold">publish_date</td><td style="font-weight: bold">publish_year</td><td style="font-weight: bold">publish_month</td><td style="font-weight: bold">publish_week</td><td style="font-weight: bold">publish_quarter</td><td style="font-weight: bold">publish_hour</td><td style="font-weight: bold">publish_firstday_of_month</td><td style="font-weight: bold">publish_dayofweek</td><td style="font-weight: bold">publish_date_format</td></tr><tr><td>2017-11-14 00:13:01</td><td>2017-11-14</td><td>2017</td><td>11</td><td>46</td><td>4</td><td>0</td><td>2017-11-01</td><td>3</td><td>14.11.2017</td></tr><tr><td>2017-11-13 14:30:00</td><td>2017-11-13</td><td>2017</td><td>11</td><td>46</td><td>4</td><td>14</td><td>2017-11-01</td><td>2</td><td>13.11.2017</td></tr><tr><td>2017-11-13 02:05:24</td><td>2017-11-13</td><td>2017</td><td>11</td><td>46</td><td>4</td><td>2</td><td>2017-11-01</td><td>2</td><td>13.11.2017</td></tr></table></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sparksql</span>

SELECT  publish_time, trending_date,
        DATE_ADD(publish_time, 2) AS date_add,
        DATEDIFF(trending_date, publish_time) AS date_diff
FROM tbl_youtube
LIMIT 3
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table><tr style="border-bottom: 1px solid"><td style="font-weight: bold">publish_time</td><td style="font-weight: bold">trending_date</td><td style="font-weight: bold">date_add</td><td style="font-weight: bold">date_diff</td></tr><tr><td>2017-11-14 00:13:01</td><td>2017-11-14</td><td>2017-11-16</td><td>0</td></tr><tr><td>2017-11-13 14:30:00</td><td>2017-11-14</td><td>2017-11-15</td><td>1</td></tr><tr><td>2017-11-13 02:05:24</td><td>2017-11-14</td><td>2017-11-15</td><td>1</td></tr></table></div></div>
</div>
</section>
<section id="aliases">
<h3>1.4. Aliases<a class="headerlink" href="#aliases" title="Permalink to this headline">#</a></h3>
<p>Alias has been used when name of column or table is too long to use it mutiple times</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">csv</span><span class="p">(</span><span class="s1">&#39;../data/youtube_category.csv&#39;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inferSchema</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">df</span>\
    <span class="o">.</span><span class="n">write</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;parquet&#39;</span><span class="p">)</span>\
    <span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s1">&#39;compression&#39;</span><span class="p">,</span> <span class="s1">&#39;snappy&#39;</span><span class="p">)</span>\
    <span class="o">.</span><span class="n">mode</span><span class="p">(</span><span class="s1">&#39;overwrite&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">saveAsTable</span><span class="p">(</span><span class="s1">&#39;tbl_youtube_category&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sparksql</span>

SELECT  category_id AS id,
        category_name AS name
FROM tbl_youtube_category LIMIT 5
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table><tr style="border-bottom: 1px solid"><td style="font-weight: bold">id</td><td style="font-weight: bold">name</td></tr><tr><td>1</td><td>Film &amp; Animation</td></tr><tr><td>2</td><td>Autos &amp; Vehicles</td></tr><tr><td>10</td><td>Music</td></tr><tr><td>15</td><td>Pets &amp; Animals</td></tr><tr><td>17</td><td>Sports</td></tr></table></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sparksql</span>

SELECT  ytb.video_id, 
        ytb.category_id,
        ytb.publish_time,
        ytb.likes, 
        ytb.views, 
        cat.category_name 
FROM tbl_youtube AS ytb
LEFT JOIN tbl_youtube_category AS cat
ON ytb.category_id = cat.category_id
AND ytb.publish_time &gt;= &#39;2017-11-12&#39;
LIMIT 5
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table><tr style="border-bottom: 1px solid"><td style="font-weight: bold">video_id</td><td style="font-weight: bold">category_id</td><td style="font-weight: bold">publish_time</td><td style="font-weight: bold">likes</td><td style="font-weight: bold">views</td><td style="font-weight: bold">category_name</td></tr><tr><td>2kyS6SvSYSE</td><td>22</td><td>2017-11-14 00:13:01</td><td>57527</td><td>748374</td><td>People &amp; Blogs</td></tr><tr><td>1ZAPwfrtAFY</td><td>24</td><td>2017-11-13 14:30:00</td><td>97185</td><td>2418783</td><td>Entertainment</td></tr><tr><td>5qpjK5DgCt4</td><td>23</td><td>2017-11-13 02:05:24</td><td>146033</td><td>3191434</td><td>Comedy</td></tr><tr><td>puqaWrEC7tY</td><td>24</td><td>2017-11-13 18:00:04</td><td>10172</td><td>343168</td><td>Entertainment</td></tr><tr><td>d380meD0W0M</td><td>24</td><td>2017-11-13 01:01:41</td><td>132235</td><td>2095731</td><td>Entertainment</td></tr></table></div></div>
</div>
</section>
</section>
<section id="data-manipulation">
<h2>2. Data manipulation<a class="headerlink" href="#data-manipulation" title="Permalink to this headline">#</a></h2>
<section id="filtering">
<h3>2.1. Filtering<a class="headerlink" href="#filtering" title="Permalink to this headline">#</a></h3>
<p>Filtering in SQL come with <code class="docutils literal notranslate"><span class="pre">WHERE</span></code> statement. With number or datetime, use <code class="docutils literal notranslate"><span class="pre">&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">=</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;</span></code> as normal, with string type, some common statements are <code class="docutils literal notranslate"><span class="pre">RLIKE</span></code>, <code class="docutils literal notranslate"><span class="pre">LIKE</span></code>, <code class="docutils literal notranslate"><span class="pre">IN</span></code> and <code class="docutils literal notranslate"><span class="pre">IS</span> <span class="pre">NULL</span></code>.
When using multi condition with <code class="docutils literal notranslate"><span class="pre">AND</span></code>, <code class="docutils literal notranslate"><span class="pre">OR</span></code>, we should group statement <code class="docutils literal notranslate"><span class="pre">OR</span></code> with brackets to clear the query</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">csv</span><span class="p">(</span><span class="s1">&#39;../data/supermarket_sales.csv&#39;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inferSchema</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">df</span>\
    <span class="o">.</span><span class="n">write</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;parquet&#39;</span><span class="p">)</span>\
    <span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s1">&#39;compression&#39;</span><span class="p">,</span> <span class="s1">&#39;snappy&#39;</span><span class="p">)</span>\
    <span class="o">.</span><span class="n">mode</span><span class="p">(</span><span class="s1">&#39;overwrite&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">saveAsTable</span><span class="p">(</span><span class="s1">&#39;tbl_supermarket&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sparksql</span>

SELECT * FROM tbl_supermarket 
WHERE quantity &gt;= 5 AND quantity &lt;= 9
LIMIT 3
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table><tr style="border-bottom: 1px solid"><td style="font-weight: bold">invoice_id</td><td style="font-weight: bold">brand</td><td style="font-weight: bold">city</td><td style="font-weight: bold">customer_type</td><td style="font-weight: bold">gender</td><td style="font-weight: bold">product_line</td><td style="font-weight: bold">unit_price</td><td style="font-weight: bold">quantity</td><td style="font-weight: bold">tax</td><td style="font-weight: bold">date</td><td style="font-weight: bold">time</td><td style="font-weight: bold">payment</td><td style="font-weight: bold">cost</td><td style="font-weight: bold">gross_margin_percentage</td><td style="font-weight: bold">profit</td><td style="font-weight: bold">rating</td></tr><tr><td>750-67-8428</td><td>A</td><td>Yangon</td><td>Member</td><td>Female</td><td>Health and beauty</td><td>74.69</td><td>7</td><td>26.1415</td><td>01/05/2019</td><td>13:08</td><td>Ewallet</td><td>522.83</td><td>4.761904762</td><td>26.1415</td><td>9.1</td></tr><tr><td>226-31-3081</td><td>C</td><td>Naypyitaw</td><td>Normal</td><td>Female</td><td>Electronic accessories</td><td>15.28</td><td>5</td><td>3.82</td><td>03/08/2019</td><td>10:29</td><td>Cash</td><td>76.4</td><td>4.761904762</td><td>3.82</td><td>9.6</td></tr><tr><td>631-41-3108</td><td>A</td><td>Yangon</td><td>Normal</td><td>Male</td><td>Home and lifestyle</td><td>46.33</td><td>7</td><td>16.2155</td><td>03/03/2019</td><td>13:23</td><td>Credit card</td><td>324.31</td><td>4.761904762</td><td>16.2155</td><td>7.4</td></tr></table></div></div>
</div>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sparksql</span>

SELECT * FROM tbl_supermarket 
WHERE date &gt; &#39;3/15/2019&#39; 
LIMIT 3
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table><tr style="border-bottom: 1px solid"><td style="font-weight: bold">invoice_id</td><td style="font-weight: bold">brand</td><td style="font-weight: bold">city</td><td style="font-weight: bold">customer_type</td><td style="font-weight: bold">gender</td><td style="font-weight: bold">product_line</td><td style="font-weight: bold">unit_price</td><td style="font-weight: bold">quantity</td><td style="font-weight: bold">tax</td><td style="font-weight: bold">date</td><td style="font-weight: bold">time</td><td style="font-weight: bold">payment</td><td style="font-weight: bold">cost</td><td style="font-weight: bold">gross_margin_percentage</td><td style="font-weight: bold">profit</td><td style="font-weight: bold">rating</td></tr><tr><td>699-14-3026</td><td>C</td><td>Naypyitaw</td><td>Normal</td><td>Male</td><td>Electronic accessories</td><td>85.39</td><td>7</td><td>29.8865</td><td>3/25/2019</td><td>18:30</td><td>Ewallet</td><td>597.73</td><td>4.761904762</td><td>29.8865</td><td>4.1</td></tr><tr><td>829-34-3910</td><td>A</td><td>Yangon</td><td>Normal</td><td>Female</td><td>Health and beauty</td><td>71.38</td><td>10</td><td>35.69</td><td>3/29/2019</td><td>19:21</td><td>Cash</td><td>713.8</td><td>4.761904762</td><td>35.69</td><td>5.7</td></tr><tr><td>227-03-5010</td><td>A</td><td>Yangon</td><td>Member</td><td>Female</td><td>Home and lifestyle</td><td>52.59</td><td>8</td><td>21.036</td><td>3/22/2019</td><td>19:20</td><td>Credit card</td><td>420.72</td><td>4.761904762</td><td>21.036</td><td>8.5</td></tr></table></div></div>
</div>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sparksql</span>

SELECT * FROM tbl_supermarket 
WHERE payment = &#39;Cash&#39; AND rating &gt; 5
LIMIT 3
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table><tr style="border-bottom: 1px solid"><td style="font-weight: bold">invoice_id</td><td style="font-weight: bold">brand</td><td style="font-weight: bold">city</td><td style="font-weight: bold">customer_type</td><td style="font-weight: bold">gender</td><td style="font-weight: bold">product_line</td><td style="font-weight: bold">unit_price</td><td style="font-weight: bold">quantity</td><td style="font-weight: bold">tax</td><td style="font-weight: bold">date</td><td style="font-weight: bold">time</td><td style="font-weight: bold">payment</td><td style="font-weight: bold">cost</td><td style="font-weight: bold">gross_margin_percentage</td><td style="font-weight: bold">profit</td><td style="font-weight: bold">rating</td></tr><tr><td>226-31-3081</td><td>C</td><td>Naypyitaw</td><td>Normal</td><td>Female</td><td>Electronic accessories</td><td>15.28</td><td>5</td><td>3.82</td><td>03/08/2019</td><td>10:29</td><td>Cash</td><td>76.4</td><td>4.761904762</td><td>3.82</td><td>9.6</td></tr><tr><td>529-56-3974</td><td>B</td><td>Mandalay</td><td>Member</td><td>Male</td><td>Electronic accessories</td><td>25.51</td><td>4</td><td>5.102</td><td>03/09/2019</td><td>17:03</td><td>Cash</td><td>102.04</td><td>4.761904762</td><td>5.102</td><td>6.8</td></tr><tr><td>829-34-3910</td><td>A</td><td>Yangon</td><td>Normal</td><td>Female</td><td>Health and beauty</td><td>71.38</td><td>10</td><td>35.69</td><td>3/29/2019</td><td>19:21</td><td>Cash</td><td>713.8</td><td>4.761904762</td><td>35.69</td><td>5.7</td></tr></table></div></div>
</div>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sparksql</span>

SELECT * FROM tbl_supermarket 
WHERE payment = &#39;Cash&#39; AND (city = &#39;Yangon&#39; OR city = &#39;Mandalay&#39;)
LIMIT 3
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table><tr style="border-bottom: 1px solid"><td style="font-weight: bold">invoice_id</td><td style="font-weight: bold">brand</td><td style="font-weight: bold">city</td><td style="font-weight: bold">customer_type</td><td style="font-weight: bold">gender</td><td style="font-weight: bold">product_line</td><td style="font-weight: bold">unit_price</td><td style="font-weight: bold">quantity</td><td style="font-weight: bold">tax</td><td style="font-weight: bold">date</td><td style="font-weight: bold">time</td><td style="font-weight: bold">payment</td><td style="font-weight: bold">cost</td><td style="font-weight: bold">gross_margin_percentage</td><td style="font-weight: bold">profit</td><td style="font-weight: bold">rating</td></tr><tr><td>529-56-3974</td><td>B</td><td>Mandalay</td><td>Member</td><td>Male</td><td>Electronic accessories</td><td>25.51</td><td>4</td><td>5.102</td><td>03/09/2019</td><td>17:03</td><td>Cash</td><td>102.04</td><td>4.761904762</td><td>5.102</td><td>6.8</td></tr><tr><td>829-34-3910</td><td>A</td><td>Yangon</td><td>Normal</td><td>Female</td><td>Health and beauty</td><td>71.38</td><td>10</td><td>35.69</td><td>3/29/2019</td><td>19:21</td><td>Cash</td><td>713.8</td><td>4.761904762</td><td>35.69</td><td>5.7</td></tr><tr><td>299-46-1805</td><td>B</td><td>Mandalay</td><td>Member</td><td>Female</td><td>Sports and travel</td><td>93.72</td><td>6</td><td>28.116</td><td>1/15/2019</td><td>16:19</td><td>Cash</td><td>562.32</td><td>4.761904762</td><td>28.116</td><td>4.5</td></tr></table></div></div>
</div>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sparksql</span>

SELECT * FROM tbl_supermarket
WHERE product_line IS NULL
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table><tr style="border-bottom: 1px solid"><td style="font-weight: bold">invoice_id</td><td style="font-weight: bold">brand</td><td style="font-weight: bold">city</td><td style="font-weight: bold">customer_type</td><td style="font-weight: bold">gender</td><td style="font-weight: bold">product_line</td><td style="font-weight: bold">unit_price</td><td style="font-weight: bold">quantity</td><td style="font-weight: bold">tax</td><td style="font-weight: bold">date</td><td style="font-weight: bold">time</td><td style="font-weight: bold">payment</td><td style="font-weight: bold">cost</td><td style="font-weight: bold">gross_margin_percentage</td><td style="font-weight: bold">profit</td><td style="font-weight: bold">rating</td></tr></table></div></div>
</div>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sparksql</span>

SELECT * FROM tbl_supermarket
WHERE brand IN (&#39;A&#39;,&#39;C&#39;) AND product_line LIKE &#39;%beauty&#39;
LIMIT 5
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table><tr style="border-bottom: 1px solid"><td style="font-weight: bold">invoice_id</td><td style="font-weight: bold">brand</td><td style="font-weight: bold">city</td><td style="font-weight: bold">customer_type</td><td style="font-weight: bold">gender</td><td style="font-weight: bold">product_line</td><td style="font-weight: bold">unit_price</td><td style="font-weight: bold">quantity</td><td style="font-weight: bold">tax</td><td style="font-weight: bold">date</td><td style="font-weight: bold">time</td><td style="font-weight: bold">payment</td><td style="font-weight: bold">cost</td><td style="font-weight: bold">gross_margin_percentage</td><td style="font-weight: bold">profit</td><td style="font-weight: bold">rating</td></tr><tr><td>750-67-8428</td><td>A</td><td>Yangon</td><td>Member</td><td>Female</td><td>Health and beauty</td><td>74.69</td><td>7</td><td>26.1415</td><td>01/05/2019</td><td>13:08</td><td>Ewallet</td><td>522.83</td><td>4.761904762</td><td>26.1415</td><td>9.1</td></tr><tr><td>123-19-1176</td><td>A</td><td>Yangon</td><td>Member</td><td>Male</td><td>Health and beauty</td><td>58.22</td><td>8</td><td>23.288</td><td>1/27/2019</td><td>20:33</td><td>Ewallet</td><td>465.76</td><td>4.761904762</td><td>23.288</td><td>8.4</td></tr><tr><td>665-32-9167</td><td>A</td><td>Yangon</td><td>Member</td><td>Female</td><td>Health and beauty</td><td>36.26</td><td>2</td><td>3.626</td><td>01/10/2019</td><td>17:15</td><td>Credit card</td><td>72.52</td><td>4.761904762</td><td>3.626</td><td>7.2</td></tr><tr><td>829-34-3910</td><td>A</td><td>Yangon</td><td>Normal</td><td>Female</td><td>Health and beauty</td><td>71.38</td><td>10</td><td>35.69</td><td>3/29/2019</td><td>19:21</td><td>Cash</td><td>713.8</td><td>4.761904762</td><td>35.69</td><td>5.7</td></tr><tr><td>656-95-9349</td><td>A</td><td>Yangon</td><td>Member</td><td>Female</td><td>Health and beauty</td><td>68.93</td><td>7</td><td>24.1255</td><td>03/11/2019</td><td>11:03</td><td>Credit card</td><td>482.51</td><td>4.761904762</td><td>24.1255</td><td>4.6</td></tr></table></div></div>
</div>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sparksql</span>

SELECT * FROM tbl_supermarket
WHERE brand NOT IN (&#39;A&#39;,&#39;C&#39;) AND product_line RLIKE (&#39;accessories|travel&#39;)
LIMIT 5
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table><tr style="border-bottom: 1px solid"><td style="font-weight: bold">invoice_id</td><td style="font-weight: bold">brand</td><td style="font-weight: bold">city</td><td style="font-weight: bold">customer_type</td><td style="font-weight: bold">gender</td><td style="font-weight: bold">product_line</td><td style="font-weight: bold">unit_price</td><td style="font-weight: bold">quantity</td><td style="font-weight: bold">tax</td><td style="font-weight: bold">date</td><td style="font-weight: bold">time</td><td style="font-weight: bold">payment</td><td style="font-weight: bold">cost</td><td style="font-weight: bold">gross_margin_percentage</td><td style="font-weight: bold">profit</td><td style="font-weight: bold">rating</td></tr><tr><td>351-62-0822</td><td>B</td><td>Mandalay</td><td>Member</td><td>Female</td><td>Fashion accessories</td><td>14.48</td><td>4</td><td>2.896</td><td>02/06/2019</td><td>18:07</td><td>Ewallet</td><td>57.92</td><td>4.761904762</td><td>2.896</td><td>4.5</td></tr><tr><td>529-56-3974</td><td>B</td><td>Mandalay</td><td>Member</td><td>Male</td><td>Electronic accessories</td><td>25.51</td><td>4</td><td>5.102</td><td>03/09/2019</td><td>17:03</td><td>Cash</td><td>102.04</td><td>4.761904762</td><td>5.102</td><td>6.8</td></tr><tr><td>299-46-1805</td><td>B</td><td>Mandalay</td><td>Member</td><td>Female</td><td>Sports and travel</td><td>93.72</td><td>6</td><td>28.116</td><td>1/15/2019</td><td>16:19</td><td>Cash</td><td>562.32</td><td>4.761904762</td><td>28.116</td><td>4.5</td></tr><tr><td>649-29-6775</td><td>B</td><td>Mandalay</td><td>Normal</td><td>Male</td><td>Fashion accessories</td><td>33.52</td><td>1</td><td>1.676</td><td>02/08/2019</td><td>15:31</td><td>Cash</td><td>33.52</td><td>4.761904762</td><td>1.676</td><td>6.7</td></tr><tr><td>871-79-8483</td><td>B</td><td>Mandalay</td><td>Normal</td><td>Male</td><td>Fashion accessories</td><td>94.13</td><td>5</td><td>23.5325</td><td>2/25/2019</td><td>19:39</td><td>Credit card</td><td>470.65</td><td>4.761904762</td><td>23.5325</td><td>4.8</td></tr></table></div></div>
</div>
</section>
<section id="aggregating">
<h3>2.2. Aggregating<a class="headerlink" href="#aggregating" title="Permalink to this headline">#</a></h3>
<p>Popular Hive’s <a class="reference external" href="https://cwiki.apache.org/confluence/display/hive/languagemanual+udf#LanguageManualUDF-Built-inAggregateFunctions(UDAF)">aggregate functions</a>: <code class="docutils literal notranslate"><span class="pre">COUNT(*)</span></code>, <code class="docutils literal notranslate"><span class="pre">COUNT(DISTINCT)</span></code>, <code class="docutils literal notranslate"><span class="pre">COUNT(CASE</span> <span class="pre">WHEN)</span></code>, <code class="docutils literal notranslate"><span class="pre">SUM</span></code>, <code class="docutils literal notranslate"><span class="pre">SUM(DISTINCT)</span></code>, <code class="docutils literal notranslate"><span class="pre">AVG</span></code>, <code class="docutils literal notranslate"><span class="pre">AVG(DISTINCT)</span></code>, <code class="docutils literal notranslate"><span class="pre">MIN</span></code>, <code class="docutils literal notranslate"><span class="pre">MAX</span></code>, <code class="docutils literal notranslate"><span class="pre">VAR_POP</span></code>, <code class="docutils literal notranslate"><span class="pre">STDDEV_POP</span></code> and <code class="docutils literal notranslate"><span class="pre">PERCENTILE</span></code>.</p>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sparksql</span>

SELECT * from tbl_supermarket LIMIT 3
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table><tr style="border-bottom: 1px solid"><td style="font-weight: bold">invoice_id</td><td style="font-weight: bold">brand</td><td style="font-weight: bold">city</td><td style="font-weight: bold">customer_type</td><td style="font-weight: bold">gender</td><td style="font-weight: bold">product_line</td><td style="font-weight: bold">unit_price</td><td style="font-weight: bold">quantity</td><td style="font-weight: bold">tax</td><td style="font-weight: bold">date</td><td style="font-weight: bold">time</td><td style="font-weight: bold">payment</td><td style="font-weight: bold">cost</td><td style="font-weight: bold">gross_margin_percentage</td><td style="font-weight: bold">profit</td><td style="font-weight: bold">rating</td></tr><tr><td>750-67-8428</td><td>A</td><td>Yangon</td><td>Member</td><td>Female</td><td>Health and beauty</td><td>74.69</td><td>7</td><td>26.1415</td><td>01/05/2019</td><td>13:08</td><td>Ewallet</td><td>522.83</td><td>4.761904762</td><td>26.1415</td><td>9.1</td></tr><tr><td>226-31-3081</td><td>C</td><td>Naypyitaw</td><td>Normal</td><td>Female</td><td>Electronic accessories</td><td>15.28</td><td>5</td><td>3.82</td><td>03/08/2019</td><td>10:29</td><td>Cash</td><td>76.4</td><td>4.761904762</td><td>3.82</td><td>9.6</td></tr><tr><td>631-41-3108</td><td>A</td><td>Yangon</td><td>Normal</td><td>Male</td><td>Home and lifestyle</td><td>46.33</td><td>7</td><td>16.2155</td><td>03/03/2019</td><td>13:23</td><td>Credit card</td><td>324.31</td><td>4.761904762</td><td>16.2155</td><td>7.4</td></tr></table></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sparksql</span>

SELECT COUNT(*) FROM tbl_supermarket
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table><tr style="border-bottom: 1px solid"><td style="font-weight: bold">count(1)</td></tr><tr><td>1000</td></tr></table></div></div>
</div>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sparksql</span>

SELECT  brand, 
        ROUND(SUM(profit),2) total_profit, 
        COUNT(invoice_id) total_invoice,
        COUNT(DISTINCT product_line) num_product_line,
        AVG(unit_price) avg_price,
        MIN(tax) min_tax,
        MAX(tax) max_tax
FROM tbl_supermarket 
GROUP BY brand
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table><tr style="border-bottom: 1px solid"><td style="font-weight: bold">brand</td><td style="font-weight: bold">total_profit</td><td style="font-weight: bold">total_invoice</td><td style="font-weight: bold">num_product_line</td><td style="font-weight: bold">avg_price</td><td style="font-weight: bold">min_tax</td><td style="font-weight: bold">max_tax</td></tr><tr><td>B</td><td>5057.03</td><td>332</td><td>6</td><td>55.65927710843373</td><td>0.8875</td><td>48.69</td></tr><tr><td>C</td><td>5265.18</td><td>328</td><td>6</td><td>56.60902439024389</td><td>0.5085</td><td>49.65</td></tr><tr><td>A</td><td>5057.16</td><td>340</td><td>6</td><td>54.780852941176484</td><td>0.6045</td><td>49.49</td></tr></table></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sparksql</span>

SELECT  brand, city, 
        SUM(CASE WHEN customer_type = &#39;Member&#39; THEN profit ELSE 0 END) member_profit,
        SUM(CASE WHEN customer_type = &#39;Normal&#39; THEN profit ELSE 0 END) normal_profit
FROM tbl_supermarket
GROUP BY brand, city
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table><tr style="border-bottom: 1px solid"><td style="font-weight: bold">brand</td><td style="font-weight: bold">city</td><td style="font-weight: bold">member_profit</td><td style="font-weight: bold">normal_profit</td></tr><tr><td>B</td><td>Mandalay</td><td>2557.366000000001</td><td>2499.666</td></tr><tr><td>C</td><td>Naypyitaw</td><td>2708.6325000000006</td><td>2556.5439999999994</td></tr><tr><td>A</td><td>Yangon</td><td>2554.165499999999</td><td>2502.9950000000017</td></tr></table></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sparksql</span>

SELECT  product_line, 
        ROUND(VAR_POP(unit_price),2) price_var_pop, 
        ROUND(VARIANCE(unit_price),2) price_var_samp,
        ROUND(STDDEV_POP(unit_price),2) price_std,
        ROUND(PERCENTILE(unit_price,0.5),2) price_median
FROM tbl_supermarket
GROUP BY product_line
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table><tr style="border-bottom: 1px solid"><td style="font-weight: bold">product_line</td><td style="font-weight: bold">price_var_pop</td><td style="font-weight: bold">price_var_samp</td><td style="font-weight: bold">price_std</td><td style="font-weight: bold">price_median</td></tr><tr><td>Home and lifestyle</td><td>682.51</td><td>686.8</td><td>26.12</td><td>55.59</td></tr><tr><td>Fashion accessories</td><td>707.1</td><td>711.09</td><td>26.59</td><td>55.09</td></tr><tr><td>Health and beauty</td><td>689.91</td><td>694.48</td><td>26.27</td><td>57.41</td></tr><tr><td>Electronic accessories</td><td>711.25</td><td>715.46</td><td>26.67</td><td>51.5</td></tr><tr><td>Food and beverages</td><td>686.16</td><td>690.13</td><td>26.19</td><td>54.0</td></tr><tr><td>Sports and travel</td><td>719.52</td><td>723.88</td><td>26.82</td><td>58.65</td></tr></table></div></div>
</div>
</section>
<section id="window-functions">
<h3>2.3. Window functions<a class="headerlink" href="#window-functions" title="Permalink to this headline">#</a></h3>
<ul class="simple">
<li><p><a class="reference external" href="https://cwiki.apache.org/confluence/display/hive/languagemanual+windowingandanalytics">Windows functions</a>: <code class="docutils literal notranslate"><span class="pre">ROW_NUMBER</span></code>, <code class="docutils literal notranslate"><span class="pre">RANK</span></code>, <code class="docutils literal notranslate"><span class="pre">DENSE_RANK</span></code>, <code class="docutils literal notranslate"><span class="pre">NTILE</span></code>,… (same as in PySpark)</p></li>
<li><p>Special uses of <code class="docutils literal notranslate"><span class="pre">SUM</span></code>, <code class="docutils literal notranslate"><span class="pre">COUNT</span></code> (with or without <code class="docutils literal notranslate"><span class="pre">PARTITION</span> <span class="pre">BY</span></code>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ROW</span> <span class="pre">BETWEEN</span></code>, <code class="docutils literal notranslate"><span class="pre">RANGE</span> <span class="pre">BETWEEN</span></code>, <code class="docutils literal notranslate"><span class="pre">UNBOUNDED</span></code>, <code class="docutils literal notranslate"><span class="pre">PRECEDING</span></code>, <code class="docutils literal notranslate"><span class="pre">CURRENT_ROW</span></code>,…</p></li>
</ul>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sparksql</span>

SELECT * FROM tbl_supermarket LIMIT 3
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table><tr style="border-bottom: 1px solid"><td style="font-weight: bold">invoice_id</td><td style="font-weight: bold">brand</td><td style="font-weight: bold">city</td><td style="font-weight: bold">customer_type</td><td style="font-weight: bold">gender</td><td style="font-weight: bold">product_line</td><td style="font-weight: bold">unit_price</td><td style="font-weight: bold">quantity</td><td style="font-weight: bold">tax</td><td style="font-weight: bold">date</td><td style="font-weight: bold">time</td><td style="font-weight: bold">payment</td><td style="font-weight: bold">cost</td><td style="font-weight: bold">gross_margin_percentage</td><td style="font-weight: bold">profit</td><td style="font-weight: bold">rating</td></tr><tr><td>750-67-8428</td><td>A</td><td>Yangon</td><td>Member</td><td>Female</td><td>Health and beauty</td><td>74.69</td><td>7</td><td>26.1415</td><td>01/05/2019</td><td>13:08</td><td>Ewallet</td><td>522.83</td><td>4.761904762</td><td>26.1415</td><td>9.1</td></tr><tr><td>226-31-3081</td><td>C</td><td>Naypyitaw</td><td>Normal</td><td>Female</td><td>Electronic accessories</td><td>15.28</td><td>5</td><td>3.82</td><td>03/08/2019</td><td>10:29</td><td>Cash</td><td>76.4</td><td>4.761904762</td><td>3.82</td><td>9.6</td></tr><tr><td>631-41-3108</td><td>A</td><td>Yangon</td><td>Normal</td><td>Male</td><td>Home and lifestyle</td><td>46.33</td><td>7</td><td>16.2155</td><td>03/03/2019</td><td>13:23</td><td>Credit card</td><td>324.31</td><td>4.761904762</td><td>16.2155</td><td>7.4</td></tr></table></div></div>
</div>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sparksql</span>

SELECT *, 
    ROW_NUMBER() OVER(PARTITION BY(brand) ORDER BY(total_profit) DESC) AS row_num,
    RANK() OVER(ORDER BY(total_profit) DESC) AS rank,
    DENSE_RANK() OVER(ORDER BY(total_profit) DESC) AS dense_rank,
    NTILE(4) OVER(ORDER BY(total_profit) DESC) AS ntile
FROM
(SELECT brand, product_line, SUM(profit) total_profit 
FROM tbl_supermarket
GROUP BY brand, product_line)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table><tr style="border-bottom: 1px solid"><td style="font-weight: bold">brand</td><td style="font-weight: bold">product_line</td><td style="font-weight: bold">total_profit</td><td style="font-weight: bold">row_num</td><td style="font-weight: bold">rank</td><td style="font-weight: bold">dense_rank</td><td style="font-weight: bold">ntile</td></tr><tr><td>A</td><td>Home and lifestyle</td><td>1067.4854999999998</td><td>1</td><td>2</td><td>2</td><td>1</td></tr><tr><td>A</td><td>Sports and travel</td><td>922.5095</td><td>2</td><td>6</td><td>6</td><td>2</td></tr><tr><td>A</td><td>Electronic accessories</td><td>872.2435000000002</td><td>3</td><td>8</td><td>8</td><td>2</td></tr><tr><td>A</td><td>Food and beverages</td><td>817.2905</td><td>4</td><td>10</td><td>10</td><td>2</td></tr><tr><td>A</td><td>Fashion accessories</td><td>777.7385000000002</td><td>5</td><td>14</td><td>14</td><td>3</td></tr><tr><td>A</td><td>Health and beauty</td><td>599.893</td><td>6</td><td>18</td><td>18</td><td>4</td></tr><tr><td>B</td><td>Sports and travel</td><td>951.8189999999997</td><td>1</td><td>4</td><td>4</td><td>1</td></tr><tr><td>B</td><td>Health and beauty</td><td>951.4599999999999</td><td>2</td><td>5</td><td>5</td><td>1</td></tr><tr><td>B</td><td>Home and lifestyle</td><td>835.6745000000001</td><td>3</td><td>9</td><td>9</td><td>2</td></tr><tr><td>B</td><td>Electronic accessories</td><td>811.9735000000001</td><td>4</td><td>11</td><td>11</td><td>3</td></tr><tr><td>B</td><td>Fashion accessories</td><td>781.5864999999999</td><td>5</td><td>13</td><td>13</td><td>3</td></tr><tr><td>B</td><td>Food and beverages</td><td>724.5184999999999</td><td>6</td><td>16</td><td>16</td><td>4</td></tr><tr><td>C</td><td>Food and beverages</td><td>1131.7549999999999</td><td>1</td><td>1</td><td>1</td><td>1</td></tr><tr><td>C</td><td>Fashion accessories</td><td>1026.67</td><td>2</td><td>3</td><td>3</td><td>1</td></tr><tr><td>C</td><td>Electronic accessories</td><td>903.2844999999999</td><td>3</td><td>7</td><td>7</td><td>2</td></tr><tr><td>C</td><td>Health and beauty</td><td>791.206</td><td>4</td><td>12</td><td>12</td><td>3</td></tr><tr><td>C</td><td>Sports and travel</td><td>750.5680000000003</td><td>5</td><td>15</td><td>15</td><td>4</td></tr><tr><td>C</td><td>Home and lifestyle</td><td>661.6930000000002</td><td>6</td><td>17</td><td>17</td><td>4</td></tr></table></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sparksql</span>

SELECT  invoice_id, brand, city, 
        COUNT(invoice_id) OVER(PARTITION BY (city)) AS total_invoice,
        SUM(quantity) OVER(PARTITION BY (city)) AS total_quantity
FROM tbl_supermarket
LIMIT 4
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table><tr style="border-bottom: 1px solid"><td style="font-weight: bold">invoice_id</td><td style="font-weight: bold">brand</td><td style="font-weight: bold">city</td><td style="font-weight: bold">total_invoice</td><td style="font-weight: bold">total_quantity</td></tr><tr><td>226-31-3081</td><td>C</td><td>Naypyitaw</td><td>328</td><td>1831</td></tr><tr><td>699-14-3026</td><td>C</td><td>Naypyitaw</td><td>328</td><td>1831</td></tr><tr><td>315-22-5665</td><td>C</td><td>Naypyitaw</td><td>328</td><td>1831</td></tr><tr><td>300-71-4605</td><td>C</td><td>Naypyitaw</td><td>328</td><td>1831</td></tr></table></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sparksql</span>

SELECT city, COUNT(invoice_id) AS num_invoice
FROM tbl_supermarket
GROUP BY  city
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table><tr style="border-bottom: 1px solid"><td style="font-weight: bold">city</td><td style="font-weight: bold">num_invoice</td></tr><tr><td>Naypyitaw</td><td>328</td></tr><tr><td>Mandalay</td><td>332</td></tr><tr><td>Yangon</td><td>340</td></tr></table></div></div>
</div>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sparksql</span>

SELECT *, 
SUM(quantity) OVER (PARTITION BY brand ORDER BY date ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) as test
FROM tbl_supermarket
LIMIT 5
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table><tr style="border-bottom: 1px solid"><td style="font-weight: bold">invoice_id</td><td style="font-weight: bold">brand</td><td style="font-weight: bold">city</td><td style="font-weight: bold">customer_type</td><td style="font-weight: bold">gender</td><td style="font-weight: bold">product_line</td><td style="font-weight: bold">unit_price</td><td style="font-weight: bold">quantity</td><td style="font-weight: bold">tax</td><td style="font-weight: bold">date</td><td style="font-weight: bold">time</td><td style="font-weight: bold">payment</td><td style="font-weight: bold">cost</td><td style="font-weight: bold">gross_margin_percentage</td><td style="font-weight: bold">profit</td><td style="font-weight: bold">rating</td><td style="font-weight: bold">test</td></tr><tr><td>891-01-7034</td><td>B</td><td>Mandalay</td><td>Normal</td><td>Female</td><td>Electronic accessories</td><td>74.71</td><td>6</td><td>22.413</td><td>01/01/2019</td><td>19:07</td><td>Cash</td><td>448.26</td><td>4.761904762</td><td>22.413</td><td>6.7</td><td>6</td></tr><tr><td>770-42-8960</td><td>B</td><td>Mandalay</td><td>Normal</td><td>Male</td><td>Food and beverages</td><td>21.12</td><td>8</td><td>8.448</td><td>01/01/2019</td><td>19:31</td><td>Cash</td><td>168.96</td><td>4.761904762</td><td>8.448</td><td>6.3</td><td>14</td></tr><tr><td>746-04-1077</td><td>B</td><td>Mandalay</td><td>Member</td><td>Female</td><td>Food and beverages</td><td>84.63</td><td>10</td><td>42.315</td><td>01/01/2019</td><td>11:36</td><td>Credit card</td><td>846.3</td><td>4.761904762</td><td>42.315</td><td>9.0</td><td>24</td></tr><tr><td>244-08-0162</td><td>B</td><td>Mandalay</td><td>Normal</td><td>Female</td><td>Health and beauty</td><td>34.21</td><td>10</td><td>17.105</td><td>01/02/2019</td><td>13:00</td><td>Cash</td><td>342.1</td><td>4.761904762</td><td>17.105</td><td>5.1</td><td>34</td></tr><tr><td>198-84-7132</td><td>B</td><td>Mandalay</td><td>Member</td><td>Male</td><td>Fashion accessories</td><td>40.61</td><td>9</td><td>18.2745</td><td>01/02/2019</td><td>13:40</td><td>Cash</td><td>365.49</td><td>4.761904762</td><td>18.2745</td><td>7.0</td><td>43</td></tr></table></div></div>
</div>
</section>
<section id="gathering-data">
<h3>2.4. Gathering data<a class="headerlink" href="#gathering-data" title="Permalink to this headline">#</a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">JOIN</span></code>: cross, left, right, inner, outer</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">UNION</span></code>: all</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sparksql</span>

CREATE EXTERNAL TABLE IF NOT EXISTS tbl_user
STORED AS PARQUET
LOCATION &#39;tbl_user&#39;
TBLPROPERTIES (&#39;parquet.compression&#39;=&#39;snappy&#39;)

SELECT *
FROM VALUES
    (1, &#39;Jane&#39;, NULL),
    (2, &#39;Alex&#39;, 25),
    (3, &#39;Mary&#39;, 21),
    (4, NULL, 20)
AS (userid, name, age)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table><tr style="border-bottom: 1px solid"></tr></table></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sparksql</span>

CREATE EXTERNAL TABLE IF NOT EXISTS tbl_sale
STORED AS PARQUET
LOCATION &#39;tbl_sale&#39;
TBLPROPERTIES (&#39;parquet.compression&#39;=&#39;snappy&#39;)

SELECT *
FROM VALUES
    (1, 1000, 2, 5),
    (2, 2560, 5, 10),
    (3, 1400, 1, 15),
    (5, 3214, 3, 0)
AS (userid, sale, quantity, shipping_fee)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table><tr style="border-bottom: 1px solid"></tr></table></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sparksql</span>

CREATE EXTERNAL TABLE IF NOT EXISTS tbl_user_append
STORED AS PARQUET
LOCATION &#39;tbl_user_append&#39;
TBLPROPERTIES (&#39;parquet.compression&#39;=&#39;snappy&#39;)

SELECT *
FROM VALUES
    (5, &#39;Adam&#39;, 26),
    (6, &#39;Kayn&#39;, 25),
    (7, &#39;Kelly&#39;, 19),
    (8, &#39;Muoas&#39;, 20)
AS (userid, name, age)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table><tr style="border-bottom: 1px solid"></tr></table></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sparksql</span>

SELECT u.*, s.* FROM tbl_user u
LEFT JOIN tbl_sale s
ON u.userid = s.userid
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table><tr style="border-bottom: 1px solid"><td style="font-weight: bold">userid</td><td style="font-weight: bold">name</td><td style="font-weight: bold">age</td><td style="font-weight: bold">userid</td><td style="font-weight: bold">sale</td><td style="font-weight: bold">quantity</td><td style="font-weight: bold">shipping_fee</td></tr><tr><td>3</td><td>Mary</td><td>21</td><td>3</td><td>1400</td><td>1</td><td>15</td></tr><tr><td>2</td><td>Alex</td><td>25</td><td>2</td><td>2560</td><td>5</td><td>10</td></tr><tr><td>1</td><td>Jane</td><td>null</td><td>1</td><td>1000</td><td>2</td><td>5</td></tr><tr><td>4</td><td>null</td><td>20</td><td>null</td><td>null</td><td>null</td><td>null</td></tr></table></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sparksql</span>

SELECT u.*, s.* FROM tbl_user u
INNER JOIN tbl_sale s
ON u.userid = s.userid
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table><tr style="border-bottom: 1px solid"><td style="font-weight: bold">userid</td><td style="font-weight: bold">name</td><td style="font-weight: bold">age</td><td style="font-weight: bold">userid</td><td style="font-weight: bold">sale</td><td style="font-weight: bold">quantity</td><td style="font-weight: bold">shipping_fee</td></tr><tr><td>3</td><td>Mary</td><td>21</td><td>3</td><td>1400</td><td>1</td><td>15</td></tr><tr><td>1</td><td>Jane</td><td>null</td><td>1</td><td>1000</td><td>2</td><td>5</td></tr><tr><td>2</td><td>Alex</td><td>25</td><td>2</td><td>2560</td><td>5</td><td>10</td></tr></table></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sparksql</span>

SELECT u.*, s.* FROM tbl_user u
FULL OUTER JOIN tbl_sale s
ON u.userid = s.userid
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table><tr style="border-bottom: 1px solid"><td style="font-weight: bold">userid</td><td style="font-weight: bold">name</td><td style="font-weight: bold">age</td><td style="font-weight: bold">userid</td><td style="font-weight: bold">sale</td><td style="font-weight: bold">quantity</td><td style="font-weight: bold">shipping_fee</td></tr><tr><td>1</td><td>Jane</td><td>null</td><td>1</td><td>1000</td><td>2</td><td>5</td></tr><tr><td>3</td><td>Mary</td><td>21</td><td>3</td><td>1400</td><td>1</td><td>15</td></tr><tr><td>null</td><td>null</td><td>null</td><td>5</td><td>3214</td><td>3</td><td>0</td></tr><tr><td>4</td><td>null</td><td>20</td><td>null</td><td>null</td><td>null</td><td>null</td></tr><tr><td>2</td><td>Alex</td><td>25</td><td>2</td><td>2560</td><td>5</td><td>10</td></tr></table></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sparksql</span>

SELECT * FROM tbl_user 
UNION (SELECT * FROM tbl_user_append) 
ORDER BY userid
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table><tr style="border-bottom: 1px solid"><td style="font-weight: bold">userid</td><td style="font-weight: bold">name</td><td style="font-weight: bold">age</td></tr><tr><td>1</td><td>Jane</td><td>null</td></tr><tr><td>2</td><td>Alex</td><td>25</td></tr><tr><td>3</td><td>Mary</td><td>21</td></tr><tr><td>4</td><td>null</td><td>20</td></tr><tr><td>5</td><td>Adam</td><td>26</td></tr><tr><td>6</td><td>Kayn</td><td>25</td></tr><tr><td>7</td><td>Kelly</td><td>19</td></tr><tr><td>8</td><td>Muoas</td><td>20</td></tr></table></div></div>
</div>
</section>
<section id="order-of-execution">
<h3>2.5. Order of execution<a class="headerlink" href="#order-of-execution" title="Permalink to this headline">#</a></h3>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">FROM</span> <span class="o">-&gt;</span> <span class="k">JOIN</span> <span class="p">[</span><span class="k">ON</span><span class="p">]</span> <span class="o">-&gt;</span> <span class="k">WHERE</span> <span class="o">-&gt;</span> <span class="k">GROUP</span> <span class="k">BY</span> <span class="o">-&gt;</span> <span class="k">HAVING</span> <span class="o">-&gt;</span> <span class="k">SELECT</span> <span class="o">-&gt;</span> <span class="k">ORDER</span> <span class="k">BY</span> <span class="o">-&gt;</span> <span class="k">LIMIT</span>
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sparksql</span>

SELECT  category_name, 
        SUM(likes) total_like, 
        SUM(views) total_view 
FROM
    (SELECT  ytb.video_id, 
            ytb.category_id,
            ytb.publish_time,
            ytb.likes, 
            ytb.views, 
            cat.category_name 
    FROM tbl_youtube AS ytb
    LEFT JOIN tbl_youtube_category AS cat
    ON ytb.category_id = cat.category_id
    WHERE ytb.publish_time &gt;= &#39;2017-11-12&#39;)
    
GROUP BY category_name
HAVING total_like &gt; 5e6
ORDER BY total_like DESC
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table><tr style="border-bottom: 1px solid"><td style="font-weight: bold">category_name</td><td style="font-weight: bold">total_like</td><td style="font-weight: bold">total_view</td></tr><tr><td>Music</td><td>178960460</td><td>3943074543</td></tr><tr><td>Entertainment</td><td>119595586</td><td>3913251602</td></tr><tr><td>Comedy</td><td>50180357</td><td>972703458</td></tr><tr><td>People &amp; Blogs</td><td>25302630</td><td>590243343</td></tr><tr><td>How to &amp; Style</td><td>24267555</td><td>694417305</td></tr><tr><td>Science &amp; Technology</td><td>13931612</td><td>476338569</td></tr><tr><td>Film &amp; Animation</td><td>11891589</td><td>574027383</td></tr><tr><td>Sports</td><td>7067350</td><td>340256954</td></tr><tr><td>Education</td><td>6078265</td><td>146637269</td></tr></table></div></div>
</div>
</section>
<section id="functions">
<h3>2.6. Functions<a class="headerlink" href="#functions" title="Permalink to this headline">#</a></h3>
<p>Hive’s <a class="reference external" href="https://cwiki.apache.org/confluence/display/hive/languagemanual+udf#LanguageManualUDF-Built-inFunctions">built-in functions</a>: <code class="docutils literal notranslate"><span class="pre">PI</span></code>, <code class="docutils literal notranslate"><span class="pre">RAND</span></code>, <code class="docutils literal notranslate"><span class="pre">LOG</span></code>, <code class="docutils literal notranslate"><span class="pre">SQRT</span></code>, <code class="docutils literal notranslate"><span class="pre">POW/POWER</span></code>, <code class="docutils literal notranslate"><span class="pre">CONCAT</span></code>, <code class="docutils literal notranslate"><span class="pre">CONCAT_WS</span></code>, <code class="docutils literal notranslate"><span class="pre">NVL</span></code>, <code class="docutils literal notranslate"><span class="pre">NVL2</span></code>, <code class="docutils literal notranslate"><span class="pre">REGEXP_REPLACE</span></code>, <code class="docutils literal notranslate"><span class="pre">REGEXP_EXTRACT</span></code>, <code class="docutils literal notranslate"><span class="pre">SPLIT</span></code>, <code class="docutils literal notranslate"><span class="pre">GREATEST</span></code>, <code class="docutils literal notranslate"><span class="pre">LEAST</span></code>, <code class="docutils literal notranslate"><span class="pre">LOWER/UPPER</span></code>, <code class="docutils literal notranslate"><span class="pre">LENGTH</span></code>, <code class="docutils literal notranslate"><span class="pre">NULLIF</span></code>, <code class="docutils literal notranslate"><span class="pre">LPAD/RPAD</span></code>, <code class="docutils literal notranslate"><span class="pre">LTRIM/RTRIM/TRIM</span></code>, <code class="docutils literal notranslate"><span class="pre">SUBSTR/SUBSTRING</span></code>, <code class="docutils literal notranslate"><span class="pre">CASE</span> <span class="pre">WHEN</span></code>.</p>
<section id="numeric-functions">
<h4>Numeric functions<a class="headerlink" href="#numeric-functions" title="Permalink to this headline">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sparksql</span>

SELECT  ROUND(PI(),4) AS pi,
        ROUND(LOG(2,10),2) AS log10,
        SQRT(25) AS sqrt,
        POW(10,2) AS pow
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table><tr style="border-bottom: 1px solid"><td style="font-weight: bold">pi</td><td style="font-weight: bold">log10</td><td style="font-weight: bold">sqrt</td><td style="font-weight: bold">pow</td></tr><tr><td>3.1416</td><td>3.32</td><td>5.0</td><td>100.0</td></tr></table></div></div>
</div>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sparksql</span>

SELECT  video_id, category_id, CONCAT(video_id,&#39;-&#39;,category_id) AS newid,
        NVL(category_id, 0) AS category_id,
        LENGTH(channel_title) AS length_title,
        CASE WHEN likes &lt;= 20000 THEN &#39;group 1&#39;
             WHEN likes &gt; 20000 AND likes &lt; 30000 THEN &#39;group 2&#39;
             ELSE &#39;group 3&#39; END AS group_like
FROM tbl_youtube
LIMIT 5
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table><tr style="border-bottom: 1px solid"><td style="font-weight: bold">video_id</td><td style="font-weight: bold">category_id</td><td style="font-weight: bold">newid</td><td style="font-weight: bold">category_id</td><td style="font-weight: bold">length_title</td><td style="font-weight: bold">group_like</td></tr><tr><td>2kyS6SvSYSE</td><td>22</td><td>2kyS6SvSYSE-22</td><td>22</td><td>12</td><td>group 3</td></tr><tr><td>1ZAPwfrtAFY</td><td>24</td><td>1ZAPwfrtAFY-24</td><td>24</td><td>15</td><td>group 3</td></tr><tr><td>5qpjK5DgCt4</td><td>23</td><td>5qpjK5DgCt4-23</td><td>23</td><td>12</td><td>group 3</td></tr><tr><td>puqaWrEC7tY</td><td>24</td><td>puqaWrEC7tY-24</td><td>24</td><td>21</td><td>group 1</td></tr><tr><td>d380meD0W0M</td><td>24</td><td>d380meD0W0M-24</td><td>24</td><td>8</td><td>group 3</td></tr></table></div></div>
</div>
</section>
<section id="text-functions">
<h4>Text functions<a class="headerlink" href="#text-functions" title="Permalink to this headline">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sparksql</span>

CREATE EXTERNAL TABLE IF NOT EXISTS tbl_seafood
STORED AS PARQUET
LOCATION &#39;tbl_seafood&#39;
TBLPROPERTIES (&#39;parquet.compression&#39;=&#39;snappy&#39;)

SELECT *
FROM VALUES
    (&#39;2021-10-01&#39;, &#39;Shrimp, frozen, chem free&#39;, 26,&#39;  usd/kg&#39;,&#39;54HPG&#39;, &#39;VN&#39;),
    (&#39;2021-10-02&#39;, &#39;FISH, fresh, chemical-free&#39;, 25,&#39;USD  /KG&#39;,&#39;9BGG&#39;, &#39;US&#39;),
    (&#39;2021-10-03&#39;, &#39;Prawn, frz, chemical-free&#39;, 19, &#39;USD/ kg&#39;,&#39;23LSN&#39;, &#39;UK&#39;),
    (&#39;2021-10-04&#39;, &#39;CraB, Frozen, chem free&#39;, 20, &#39;USD / kg&#39;,&#39;001HNI&#39;, &#39;NZL&#39;)
AS (date, product, price, unit, code, country)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table><tr style="border-bottom: 1px solid"></tr></table></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sparksql</span>

SELECT * from tbl_seafood
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table><tr style="border-bottom: 1px solid"><td style="font-weight: bold">date</td><td style="font-weight: bold">product</td><td style="font-weight: bold">price</td><td style="font-weight: bold">unit</td><td style="font-weight: bold">code</td><td style="font-weight: bold">country</td></tr><tr><td>2021-10-04</td><td>CraB, Frozen, chem free</td><td>20</td><td>USD / kg</td><td>001HNI</td><td>NZL</td></tr><tr><td>2021-10-01</td><td>Shrimp, frozen, chem free</td><td>26</td><td>  usd/kg</td><td>54HPG</td><td>VN</td></tr><tr><td>2021-10-02</td><td>FISH, fresh, chemical-free</td><td>25</td><td>USD  /KG</td><td>9BGG</td><td>US</td></tr><tr><td>2021-10-03</td><td>Prawn, frz, chemical-free</td><td>19</td><td>USD/ kg</td><td>23LSN</td><td>UK</td></tr></table></div></div>
</div>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sparksql</span>

SELECT *, 
        LOWER(product_name) AS norm_name,
        REGEXP_REPLACE(LOWER(product_frz),&#39;frz&#39;,&#39;frozen&#39;) AS norm_frz,
        CASE WHEN product_chem LIKE &#39;%chem free%&#39; 
             THEN &#39;chemical-free&#39; 
             ELSE product_chem END AS norm_chem,
        SUBSTRING(norm_code,0,3) AS code_number,
        CONCAT(norm_code, &#39;-&#39;, country) AS full_code,
        REGEXP_EXTRACT(norm_code, &#39;[A-Z]+&#39;,0) AS code_location
FROM
    (SELECT *, 
            SPLIT(product,&#39;,&#39;)[0] AS product_name,
            SPLIT(product,&#39;,&#39;)[1] AS product_frz,
            SPLIT(product,&#39;,&#39;)[2] AS product_chem,
            LPAD(code,6,0) AS norm_code,
            REGEXP_REPLACE(UPPER(TRIM(unit)),&#39; &#39;,&#39;&#39;) AS norm_unit
    FROM tbl_seafood)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table><tr style="border-bottom: 1px solid"><td style="font-weight: bold">date</td><td style="font-weight: bold">product</td><td style="font-weight: bold">price</td><td style="font-weight: bold">unit</td><td style="font-weight: bold">code</td><td style="font-weight: bold">country</td><td style="font-weight: bold">product_name</td><td style="font-weight: bold">product_frz</td><td style="font-weight: bold">product_chem</td><td style="font-weight: bold">norm_code</td><td style="font-weight: bold">norm_unit</td><td style="font-weight: bold">norm_name</td><td style="font-weight: bold">norm_frz</td><td style="font-weight: bold">norm_chem</td><td style="font-weight: bold">code_number</td><td style="font-weight: bold">full_code</td><td style="font-weight: bold">code_location</td></tr><tr><td>2021-10-04</td><td>CraB, Frozen, chem free</td><td>20</td><td>USD / kg</td><td>001HNI</td><td>NZL</td><td>CraB</td><td> Frozen</td><td> chem free</td><td>001HNI</td><td>USD/KG</td><td>crab</td><td> frozen</td><td>chemical-free</td><td>001</td><td>001HNI-NZL</td><td>HNI</td></tr><tr><td>2021-10-01</td><td>Shrimp, frozen, chem free</td><td>26</td><td>  usd/kg</td><td>54HPG</td><td>VN</td><td>Shrimp</td><td> frozen</td><td> chem free</td><td>054HPG</td><td>USD/KG</td><td>shrimp</td><td> frozen</td><td>chemical-free</td><td>054</td><td>054HPG-VN</td><td>HPG</td></tr><tr><td>2021-10-02</td><td>FISH, fresh, chemical-free</td><td>25</td><td>USD  /KG</td><td>9BGG</td><td>US</td><td>FISH</td><td> fresh</td><td> chemical-free</td><td>009BGG</td><td>USD/KG</td><td>fish</td><td> fresh</td><td> chemical-free</td><td>009</td><td>009BGG-US</td><td>BGG</td></tr><tr><td>2021-10-03</td><td>Prawn, frz, chemical-free</td><td>19</td><td>USD/ kg</td><td>23LSN</td><td>UK</td><td>Prawn</td><td> frz</td><td> chemical-free</td><td>023LSN</td><td>USD/KG</td><td>prawn</td><td> frozen</td><td> chemical-free</td><td>023</td><td>023LSN-UK</td><td>LSN</td></tr></table></div></div>
</div>
</section>
</section>
</section>
<section id="data-structures">
<h2>3. Data structures<a class="headerlink" href="#data-structures" title="Permalink to this headline">#</a></h2>
<section id="array-type">
<h3>3.1. Array type<a class="headerlink" href="#array-type" title="Permalink to this headline">#</a></h3>
<ul class="simple">
<li><p>Definition: same as Numpy’s array</p></li>
<li><p>Schema: <code class="docutils literal notranslate"><span class="pre">ARRAY&lt;STRING&gt;</span></code></p></li>
<li><p>Inserting: <code class="docutils literal notranslate"><span class="pre">ARRAY('algebra',</span> <span class="pre">'calculus',...)</span></code></p></li>
<li><p>Accessing: <code class="docutils literal notranslate"><span class="pre">A[1]</span></code>, start with 0</p></li>
<li><p>Techniques:</p>
<ul>
<li><p>Unpacking: <code class="docutils literal notranslate"><span class="pre">LATERAL</span> <span class="pre">VIEW,</span> <span class="pre">EXPLODE,</span> <span class="pre">POSEXPLODE,</span> <span class="pre">INLINE,...</span></code></p></li>
<li><p>Higher order functions: <code class="docutils literal notranslate"><span class="pre">TRANSFORM,</span> <span class="pre">FILTER,</span> <span class="pre">EXISTS,</span> <span class="pre">AGGREGATE</span></code> (<a class="reference external" href="https://databricks.com/blog/2017/05/24/working-with-nested-data-using-higher-order-functions-in-sql-on-databricks.html">read more</a>)</p></li>
<li><p>Basic functions: <code class="docutils literal notranslate"><span class="pre">SIZE,</span> <span class="pre">ARRAY_CONTAINS,</span> <span class="pre">SORT_ARRAY,</span> <span class="pre">CONCAT_WS,</span> <span class="pre">SEQUENCE,...</span></code> (same as in PySpark)</p></li>
</ul>
</li>
</ul>
<section id="creating-array">
<h4>Creating array<a class="headerlink" href="#creating-array" title="Permalink to this headline">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sparksql</span>

CREATE EXTERNAL TABLE IF NOT EXISTS tbl_movie
STORED AS PARQUET
LOCATION &#39;tbl_movie&#39;
TBLPROPERTIES (&#39;parquet.compression&#39;=&#39;snappy&#39;)

SELECT *
FROM VALUES
    (1, &#39;Money heist&#39;, ARRAY(&#39;Monte&#39;,&#39;Corberó&#39;, &#39;Alonso&#39;), &#39;criminal, sex, drama&#39;, &#39;Portuga&#39;, 4.8, 4.6),
    (2, &#39;Stranger thing&#39;, ARRAY(&#39;Finn&#39;,&#39;Millie&#39;,&#39;Noah&#39;), &#39;horror, science, drama, thriller&#39;, &#39;US&#39;, 4.9, 4.5),
    (3, &#39;Hill house&#39;,  ARRAY(&#39;Victoria&#39;,&#39;Kate&#39;,&#39;Oliver&#39;), &#39;horror, supernature&#39;,&#39;US&#39;, 4.7, 4.8),
    (4, &#39;Squid game&#39;, ARRAY(&#39;jung-jae&#39;,&#39;Gong yoo&#39;,&#39;Ha-joon&#39;), NULL, &#39;Korea&#39;, 4.6, 4.6)
AS (id, name, actors, genre, country, idbm_rating, tomatoes_rating)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table><tr style="border-bottom: 1px solid"></tr></table></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sparksql</span>

DESC tbl_movie
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table><tr style="border-bottom: 1px solid"><td style="font-weight: bold">col_name</td><td style="font-weight: bold">data_type</td><td style="font-weight: bold">comment</td></tr><tr><td>id</td><td>int</td><td>null</td></tr><tr><td>name</td><td>string</td><td>null</td></tr><tr><td>actors</td><td>array&lt;string&gt;</td><td>null</td></tr><tr><td>genre</td><td>string</td><td>null</td></tr><tr><td>country</td><td>string</td><td>null</td></tr><tr><td>idbm_rating</td><td>decimal(2,1)</td><td>null</td></tr><tr><td>tomatoes_rating</td><td>decimal(2,1)</td><td>null</td></tr></table></div></div>
</div>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sparksql</span>
SELECT *, 
SPLIT(genre,&#39;,&#39;) AS group_genre, 
ARRAY(idbm_rating, tomatoes_rating) as rating
FROM tbl_movie
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table><tr style="border-bottom: 1px solid"><td style="font-weight: bold">id</td><td style="font-weight: bold">name</td><td style="font-weight: bold">actors</td><td style="font-weight: bold">genre</td><td style="font-weight: bold">country</td><td style="font-weight: bold">idbm_rating</td><td style="font-weight: bold">tomatoes_rating</td><td style="font-weight: bold">group_genre</td><td style="font-weight: bold">rating</td></tr><tr><td>1</td><td>Money heist</td><td>[&#x27;Monte&#x27;, &#x27;Corberó&#x27;, &#x27;Alonso&#x27;]</td><td>criminal, sex, drama</td><td>Portuga</td><td>4.8</td><td>4.6</td><td>[&#x27;criminal&#x27;, &#x27; sex&#x27;, &#x27; drama&#x27;]</td><td>[Decimal(&#x27;4.8&#x27;), Decimal(&#x27;4.6&#x27;)]</td></tr><tr><td>2</td><td>Stranger thing</td><td>[&#x27;Finn&#x27;, &#x27;Millie&#x27;, &#x27;Noah&#x27;]</td><td>horror, science, drama, thriller</td><td>US</td><td>4.9</td><td>4.5</td><td>[&#x27;horror&#x27;, &#x27; science&#x27;, &#x27; drama&#x27;, &#x27; thriller&#x27;]</td><td>[Decimal(&#x27;4.9&#x27;), Decimal(&#x27;4.5&#x27;)]</td></tr><tr><td>3</td><td>Hill house</td><td>[&#x27;Victoria&#x27;, &#x27;Kate&#x27;, &#x27;Oliver&#x27;]</td><td>horror, supernature</td><td>US</td><td>4.7</td><td>4.8</td><td>[&#x27;horror&#x27;, &#x27; supernature&#x27;]</td><td>[Decimal(&#x27;4.7&#x27;), Decimal(&#x27;4.8&#x27;)]</td></tr><tr><td>4</td><td>Squid game</td><td>[&#x27;jung-jae&#x27;, &#x27;Gong yoo&#x27;, &#x27;Ha-joon&#x27;]</td><td>null</td><td>Korea</td><td>4.6</td><td>4.6</td><td>null</td><td>[Decimal(&#x27;4.6&#x27;), Decimal(&#x27;4.6&#x27;)]</td></tr></table></div></div>
</div>
</section>
<section id="array-manipulation">
<h4>Array manipulation<a class="headerlink" href="#array-manipulation" title="Permalink to this headline">#</a></h4>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sparksql</span>
SELECT *, 
actors[0] AS first_actor, 
actors[1] AS second_actor,
SLICE(actors, 1,2) AS slice_array
FROM tbl_movie
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table><tr style="border-bottom: 1px solid"><td style="font-weight: bold">id</td><td style="font-weight: bold">name</td><td style="font-weight: bold">actors</td><td style="font-weight: bold">genre</td><td style="font-weight: bold">country</td><td style="font-weight: bold">idbm_rating</td><td style="font-weight: bold">tomatoes_rating</td><td style="font-weight: bold">first_actor</td><td style="font-weight: bold">second_actor</td><td style="font-weight: bold">slice_array</td></tr><tr><td>1</td><td>Money heist</td><td>[&#x27;Monte&#x27;, &#x27;Corberó&#x27;, &#x27;Alonso&#x27;]</td><td>criminal, sex, drama</td><td>Portuga</td><td>4.8</td><td>4.6</td><td>Monte</td><td>Corberó</td><td>[&#x27;Monte&#x27;, &#x27;Corberó&#x27;]</td></tr><tr><td>2</td><td>Stranger thing</td><td>[&#x27;Finn&#x27;, &#x27;Millie&#x27;, &#x27;Noah&#x27;]</td><td>horror, science, drama, thriller</td><td>US</td><td>4.9</td><td>4.5</td><td>Finn</td><td>Millie</td><td>[&#x27;Finn&#x27;, &#x27;Millie&#x27;]</td></tr><tr><td>3</td><td>Hill house</td><td>[&#x27;Victoria&#x27;, &#x27;Kate&#x27;, &#x27;Oliver&#x27;]</td><td>horror, supernature</td><td>US</td><td>4.7</td><td>4.8</td><td>Victoria</td><td>Kate</td><td>[&#x27;Victoria&#x27;, &#x27;Kate&#x27;]</td></tr><tr><td>4</td><td>Squid game</td><td>[&#x27;jung-jae&#x27;, &#x27;Gong yoo&#x27;, &#x27;Ha-joon&#x27;]</td><td>null</td><td>Korea</td><td>4.6</td><td>4.6</td><td>jung-jae</td><td>Gong yoo</td><td>[&#x27;jung-jae&#x27;, &#x27;Gong yoo&#x27;]</td></tr></table></div></div>
</div>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sparksql</span>
select * from tbl_movie LATERAL VIEW EXPLODE(actors) AS explode_actor LIMIT 3
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table><tr style="border-bottom: 1px solid"><td style="font-weight: bold">id</td><td style="font-weight: bold">name</td><td style="font-weight: bold">actors</td><td style="font-weight: bold">genre</td><td style="font-weight: bold">country</td><td style="font-weight: bold">idbm_rating</td><td style="font-weight: bold">tomatoes_rating</td><td style="font-weight: bold">explode_actor</td></tr><tr><td>1</td><td>Money heist</td><td>[&#x27;Monte&#x27;, &#x27;Corberó&#x27;, &#x27;Alonso&#x27;]</td><td>criminal, sex, drama</td><td>Portuga</td><td>4.8</td><td>4.6</td><td>Monte</td></tr><tr><td>1</td><td>Money heist</td><td>[&#x27;Monte&#x27;, &#x27;Corberó&#x27;, &#x27;Alonso&#x27;]</td><td>criminal, sex, drama</td><td>Portuga</td><td>4.8</td><td>4.6</td><td>Corberó</td></tr><tr><td>1</td><td>Money heist</td><td>[&#x27;Monte&#x27;, &#x27;Corberó&#x27;, &#x27;Alonso&#x27;]</td><td>criminal, sex, drama</td><td>Portuga</td><td>4.8</td><td>4.6</td><td>Alonso</td></tr></table></div></div>
</div>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sparksql</span>
select *, EXPLODE(actors) AS explode_actor from tbl_movie LIMIT 3
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table><tr style="border-bottom: 1px solid"><td style="font-weight: bold">id</td><td style="font-weight: bold">name</td><td style="font-weight: bold">actors</td><td style="font-weight: bold">genre</td><td style="font-weight: bold">country</td><td style="font-weight: bold">idbm_rating</td><td style="font-weight: bold">tomatoes_rating</td><td style="font-weight: bold">explode_actor</td></tr><tr><td>1</td><td>Money heist</td><td>[&#x27;Monte&#x27;, &#x27;Corberó&#x27;, &#x27;Alonso&#x27;]</td><td>criminal, sex, drama</td><td>Portuga</td><td>4.8</td><td>4.6</td><td>Monte</td></tr><tr><td>1</td><td>Money heist</td><td>[&#x27;Monte&#x27;, &#x27;Corberó&#x27;, &#x27;Alonso&#x27;]</td><td>criminal, sex, drama</td><td>Portuga</td><td>4.8</td><td>4.6</td><td>Corberó</td></tr><tr><td>1</td><td>Money heist</td><td>[&#x27;Monte&#x27;, &#x27;Corberó&#x27;, &#x27;Alonso&#x27;]</td><td>criminal, sex, drama</td><td>Portuga</td><td>4.8</td><td>4.6</td><td>Alonso</td></tr></table></div></div>
</div>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sparksql</span>
select *, POSEXPLODE(actors) AS (pos, name) from tbl_movie LIMIT 3
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table><tr style="border-bottom: 1px solid"><td style="font-weight: bold">id</td><td style="font-weight: bold">name</td><td style="font-weight: bold">actors</td><td style="font-weight: bold">genre</td><td style="font-weight: bold">country</td><td style="font-weight: bold">idbm_rating</td><td style="font-weight: bold">tomatoes_rating</td><td style="font-weight: bold">pos</td><td style="font-weight: bold">name</td></tr><tr><td>1</td><td>Money heist</td><td>[&#x27;Monte&#x27;, &#x27;Corberó&#x27;, &#x27;Alonso&#x27;]</td><td>criminal, sex, drama</td><td>Portuga</td><td>4.8</td><td>4.6</td><td>0</td><td>Monte</td></tr><tr><td>1</td><td>Money heist</td><td>[&#x27;Monte&#x27;, &#x27;Corberó&#x27;, &#x27;Alonso&#x27;]</td><td>criminal, sex, drama</td><td>Portuga</td><td>4.8</td><td>4.6</td><td>1</td><td>Corberó</td></tr><tr><td>1</td><td>Money heist</td><td>[&#x27;Monte&#x27;, &#x27;Corberó&#x27;, &#x27;Alonso&#x27;]</td><td>criminal, sex, drama</td><td>Portuga</td><td>4.8</td><td>4.6</td><td>2</td><td>Alonso</td></tr></table></div></div>
</div>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sparksql</span>
select *, ARRAY_JOIN(actors, &quot;; &quot;) AS list_actors from tbl_movie
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table><tr style="border-bottom: 1px solid"><td style="font-weight: bold">id</td><td style="font-weight: bold">name</td><td style="font-weight: bold">actors</td><td style="font-weight: bold">genre</td><td style="font-weight: bold">country</td><td style="font-weight: bold">idbm_rating</td><td style="font-weight: bold">tomatoes_rating</td><td style="font-weight: bold">list_actors</td></tr><tr><td>1</td><td>Money heist</td><td>[&#x27;Monte&#x27;, &#x27;Corberó&#x27;, &#x27;Alonso&#x27;]</td><td>criminal, sex, drama</td><td>Portuga</td><td>4.8</td><td>4.6</td><td>Monte; Corberó; Alonso</td></tr><tr><td>2</td><td>Stranger thing</td><td>[&#x27;Finn&#x27;, &#x27;Millie&#x27;, &#x27;Noah&#x27;]</td><td>horror, science, drama, thriller</td><td>US</td><td>4.9</td><td>4.5</td><td>Finn; Millie; Noah</td></tr><tr><td>3</td><td>Hill house</td><td>[&#x27;Victoria&#x27;, &#x27;Kate&#x27;, &#x27;Oliver&#x27;]</td><td>horror, supernature</td><td>US</td><td>4.7</td><td>4.8</td><td>Victoria; Kate; Oliver</td></tr><tr><td>4</td><td>Squid game</td><td>[&#x27;jung-jae&#x27;, &#x27;Gong yoo&#x27;, &#x27;Ha-joon&#x27;]</td><td>null</td><td>Korea</td><td>4.6</td><td>4.6</td><td>jung-jae; Gong yoo; Ha-joon</td></tr></table></div></div>
</div>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sparksql</span>

SELECT *, 
FILTER(actors, x -&gt; x like &#39;%oo%&#39;) AS filter_array,
CONCAT(actors, FILTER(actors, x -&gt; x like &#39;%oo%&#39;)) AS concat_array,
ARRAY_INTERSECT(actors, FILTER(actors, x -&gt; x like &#39;%oo%&#39;)) AS intersect,
ARRAY_UNION(actors, FILTER(actors, x -&gt; x like &#39;%oo%&#39;)) AS union,
SHUFFLE(actors) AS shuffer,
ARRAY_SORT(actors) AS sorted_array,
ARRAY_MAX(actors) AS array_max,
ARRAY_MIN(actors) AS array_min,
ARRAY_DISTINCT(actors) AS distinct_array
FROM tbl_movie
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table><tr style="border-bottom: 1px solid"><td style="font-weight: bold">id</td><td style="font-weight: bold">name</td><td style="font-weight: bold">actors</td><td style="font-weight: bold">genre</td><td style="font-weight: bold">country</td><td style="font-weight: bold">idbm_rating</td><td style="font-weight: bold">tomatoes_rating</td><td style="font-weight: bold">filter_array</td><td style="font-weight: bold">concat_array</td><td style="font-weight: bold">intersect</td><td style="font-weight: bold">union</td><td style="font-weight: bold">shuffer</td><td style="font-weight: bold">sorted_array</td><td style="font-weight: bold">array_max</td><td style="font-weight: bold">array_min</td><td style="font-weight: bold">distinct_array</td></tr><tr><td>1</td><td>Money heist</td><td>[&#x27;Monte&#x27;, &#x27;Corberó&#x27;, &#x27;Alonso&#x27;]</td><td>criminal, sex, drama</td><td>Portuga</td><td>4.8</td><td>4.6</td><td>[]</td><td>[&#x27;Monte&#x27;, &#x27;Corberó&#x27;, &#x27;Alonso&#x27;]</td><td>[]</td><td>[&#x27;Monte&#x27;, &#x27;Corberó&#x27;, &#x27;Alonso&#x27;]</td><td>[&#x27;Corberó&#x27;, &#x27;Monte&#x27;, &#x27;Alonso&#x27;]</td><td>[&#x27;Alonso&#x27;, &#x27;Corberó&#x27;, &#x27;Monte&#x27;]</td><td>Monte</td><td>Alonso</td><td>[&#x27;Monte&#x27;, &#x27;Corberó&#x27;, &#x27;Alonso&#x27;]</td></tr><tr><td>2</td><td>Stranger thing</td><td>[&#x27;Finn&#x27;, &#x27;Millie&#x27;, &#x27;Noah&#x27;]</td><td>horror, science, drama, thriller</td><td>US</td><td>4.9</td><td>4.5</td><td>[]</td><td>[&#x27;Finn&#x27;, &#x27;Millie&#x27;, &#x27;Noah&#x27;]</td><td>[]</td><td>[&#x27;Finn&#x27;, &#x27;Millie&#x27;, &#x27;Noah&#x27;]</td><td>[&#x27;Noah&#x27;, &#x27;Millie&#x27;, &#x27;Finn&#x27;]</td><td>[&#x27;Finn&#x27;, &#x27;Millie&#x27;, &#x27;Noah&#x27;]</td><td>Noah</td><td>Finn</td><td>[&#x27;Finn&#x27;, &#x27;Millie&#x27;, &#x27;Noah&#x27;]</td></tr><tr><td>3</td><td>Hill house</td><td>[&#x27;Victoria&#x27;, &#x27;Kate&#x27;, &#x27;Oliver&#x27;]</td><td>horror, supernature</td><td>US</td><td>4.7</td><td>4.8</td><td>[]</td><td>[&#x27;Victoria&#x27;, &#x27;Kate&#x27;, &#x27;Oliver&#x27;]</td><td>[]</td><td>[&#x27;Victoria&#x27;, &#x27;Kate&#x27;, &#x27;Oliver&#x27;]</td><td>[&#x27;Oliver&#x27;, &#x27;Victoria&#x27;, &#x27;Kate&#x27;]</td><td>[&#x27;Kate&#x27;, &#x27;Oliver&#x27;, &#x27;Victoria&#x27;]</td><td>Victoria</td><td>Kate</td><td>[&#x27;Victoria&#x27;, &#x27;Kate&#x27;, &#x27;Oliver&#x27;]</td></tr><tr><td>4</td><td>Squid game</td><td>[&#x27;jung-jae&#x27;, &#x27;Gong yoo&#x27;, &#x27;Ha-joon&#x27;]</td><td>null</td><td>Korea</td><td>4.6</td><td>4.6</td><td>[&#x27;Gong yoo&#x27;, &#x27;Ha-joon&#x27;]</td><td>[&#x27;jung-jae&#x27;, &#x27;Gong yoo&#x27;, &#x27;Ha-joon&#x27;, &#x27;Gong yoo&#x27;, &#x27;Ha-joon&#x27;]</td><td>[&#x27;Gong yoo&#x27;, &#x27;Ha-joon&#x27;]</td><td>[&#x27;jung-jae&#x27;, &#x27;Gong yoo&#x27;, &#x27;Ha-joon&#x27;]</td><td>[&#x27;Ha-joon&#x27;, &#x27;Gong yoo&#x27;, &#x27;jung-jae&#x27;]</td><td>[&#x27;Gong yoo&#x27;, &#x27;Ha-joon&#x27;, &#x27;jung-jae&#x27;]</td><td>jung-jae</td><td>Gong yoo</td><td>[&#x27;jung-jae&#x27;, &#x27;Gong yoo&#x27;, &#x27;Ha-joon&#x27;]</td></tr></table></div></div>
</div>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sparksql</span>

SELECT *,
TRANSFORM(actors, actors -&gt; CONCAT(actors,&#39;-ss1&#39;)) as actor_ss1,
EXISTS(actors, actors -&gt; length(actors) &gt; 7) as actor_filter
FROM tbl_movie
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table><tr style="border-bottom: 1px solid"><td style="font-weight: bold">id</td><td style="font-weight: bold">name</td><td style="font-weight: bold">actors</td><td style="font-weight: bold">genre</td><td style="font-weight: bold">country</td><td style="font-weight: bold">idbm_rating</td><td style="font-weight: bold">tomatoes_rating</td><td style="font-weight: bold">actor_ss1</td><td style="font-weight: bold">actor_filter</td></tr><tr><td>1</td><td>Money heist</td><td>[&#x27;Monte&#x27;, &#x27;Corberó&#x27;, &#x27;Alonso&#x27;]</td><td>criminal, sex, drama</td><td>Portuga</td><td>4.8</td><td>4.6</td><td>[&#x27;Monte-ss1&#x27;, &#x27;Corberó-ss1&#x27;, &#x27;Alonso-ss1&#x27;]</td><td>False</td></tr><tr><td>2</td><td>Stranger thing</td><td>[&#x27;Finn&#x27;, &#x27;Millie&#x27;, &#x27;Noah&#x27;]</td><td>horror, science, drama, thriller</td><td>US</td><td>4.9</td><td>4.5</td><td>[&#x27;Finn-ss1&#x27;, &#x27;Millie-ss1&#x27;, &#x27;Noah-ss1&#x27;]</td><td>False</td></tr><tr><td>3</td><td>Hill house</td><td>[&#x27;Victoria&#x27;, &#x27;Kate&#x27;, &#x27;Oliver&#x27;]</td><td>horror, supernature</td><td>US</td><td>4.7</td><td>4.8</td><td>[&#x27;Victoria-ss1&#x27;, &#x27;Kate-ss1&#x27;, &#x27;Oliver-ss1&#x27;]</td><td>True</td></tr><tr><td>4</td><td>Squid game</td><td>[&#x27;jung-jae&#x27;, &#x27;Gong yoo&#x27;, &#x27;Ha-joon&#x27;]</td><td>null</td><td>Korea</td><td>4.6</td><td>4.6</td><td>[&#x27;jung-jae-ss1&#x27;, &#x27;Gong yoo-ss1&#x27;, &#x27;Ha-joon-ss1&#x27;]</td><td>True</td></tr></table></div></div>
</div>
</section>
</section>
<section id="struct-type">
<h3>3.2. Struct type<a class="headerlink" href="#struct-type" title="Permalink to this headline">#</a></h3>
<ul class="simple">
<li><p>Definition: two or more arrays zipped together</p></li>
<li><p>Schema: <code class="docutils literal notranslate"><span class="pre">ARRAY&lt;STRUCT&lt;id:INT,</span> <span class="pre">name:STRING,</span> <span class="pre">interest:STRING&gt;&gt;</span></code></p></li>
<li><p>Inserting: <code class="docutils literal notranslate"><span class="pre">ARRAY(STRUCT(0,</span> <span class="pre">'triangle',</span> <span class="pre">'three'),</span> <span class="pre">STRUCT(1,</span> <span class="pre">'rectangle',</span> <span class="pre">'four'))</span></code></p></li>
<li><p>Accessing: <code class="docutils literal notranslate"><span class="pre">S.id,</span> <span class="pre">S.name,</span> <span class="pre">S.interest</span></code></p></li>
<li><p>Techniques: <code class="docutils literal notranslate"><span class="pre">ARRAYS_ZIP</span></code></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sparksql</span>
CREATE EXTERNAL TABLE IF NOT EXISTS tbl_employee
(
  id BIGINT,
  name STRING,
  employee_info STRUCT &lt; employer: STRING, id: BIGINT, address: STRING &gt;,
  places_lived ARRAY &lt; STRUCT &lt;street: STRING, city: STRING, country: STRING &gt;&gt;
)
STORED AS PARQUET
LOCATION &#39;tbl_employee&#39;
TBLPROPERTIES (&#39;parquet.compression&#39;=&#39;snappy&#39;)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table><tr style="border-bottom: 1px solid"></tr></table></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sparksql</span>

INSERT OVERWRITE tbl_employee
VALUES
    (1, &#39;Anna&#39;, (&#39;Anna&#39;,1,&#39;US&#39;), ARRAY(STRUCT(&#39;abc&#39;,&#39;new york&#39;,&#39;US&#39;))),
    (2, &#39;Alex&#39;, (&#39;Alex&#39;,2,&#39;US&#39;), ARRAY(STRUCT(&#39;abc&#39;,&#39;cali&#39;,&#39;US&#39;))),
    (3, &#39;Tom&#39;, (&#39;Tom&#39;,3,&#39;US&#39;), ARRAY(STRUCT(&#39;abc&#39;,&#39;brooklin&#39;,&#39;US&#39;)))
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table><tr style="border-bottom: 1px solid"></tr></table></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sparksql</span>
DESC tbl_employee
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table><tr style="border-bottom: 1px solid"><td style="font-weight: bold">col_name</td><td style="font-weight: bold">data_type</td><td style="font-weight: bold">comment</td></tr><tr><td>id</td><td>bigint</td><td>null</td></tr><tr><td>name</td><td>string</td><td>null</td></tr><tr><td>employee_info</td><td>struct&lt;employer:string,id:bigint,address:string&gt;</td><td>null</td></tr><tr><td>places_lived</td><td>array&lt;struct&lt;street:string,city:string,country:string&gt;&gt;</td><td>null</td></tr></table></div></div>
</div>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sparksql</span>

SELECT *, employee_info.employer, employee_info.id, places_lived.city
FROM tbl_employee
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table><tr style="border-bottom: 1px solid"><td style="font-weight: bold">id</td><td style="font-weight: bold">name</td><td style="font-weight: bold">employee_info</td><td style="font-weight: bold">places_lived</td><td style="font-weight: bold">employer</td><td style="font-weight: bold">id</td><td style="font-weight: bold">city</td></tr><tr><td>1</td><td>Anna</td><td>Row(employer=&#x27;Anna&#x27;, id=1, address=&#x27;US&#x27;)</td><td>[Row(street=&#x27;abc&#x27;, city=&#x27;new york&#x27;, country=&#x27;US&#x27;)]</td><td>Anna</td><td>1</td><td>[&#x27;new york&#x27;]</td></tr><tr><td>2</td><td>Alex</td><td>Row(employer=&#x27;Alex&#x27;, id=2, address=&#x27;US&#x27;)</td><td>[Row(street=&#x27;abc&#x27;, city=&#x27;cali&#x27;, country=&#x27;US&#x27;)]</td><td>Alex</td><td>2</td><td>[&#x27;cali&#x27;]</td></tr><tr><td>3</td><td>Tom</td><td>Row(employer=&#x27;Tom&#x27;, id=3, address=&#x27;US&#x27;)</td><td>[Row(street=&#x27;abc&#x27;, city=&#x27;brooklin&#x27;, country=&#x27;US&#x27;)]</td><td>Tom</td><td>3</td><td>[&#x27;brooklin&#x27;]</td></tr></table></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sparksql</span>

SELECT employee_info.*
  FROM tbl_employee
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table><tr style="border-bottom: 1px solid"><td style="font-weight: bold">employer</td><td style="font-weight: bold">id</td><td style="font-weight: bold">address</td></tr><tr><td>Anna</td><td>1</td><td>US</td></tr><tr><td>Alex</td><td>2</td><td>US</td></tr><tr><td>Tom</td><td>3</td><td>US</td></tr></table></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sparksql</span>

SELECT id, INLINE(places_lived)
FROM tbl_employee
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table><tr style="border-bottom: 1px solid"><td style="font-weight: bold">id</td><td style="font-weight: bold">street</td><td style="font-weight: bold">city</td><td style="font-weight: bold">country</td></tr><tr><td>1</td><td>abc</td><td>new york</td><td>US</td></tr><tr><td>2</td><td>abc</td><td>cali</td><td>US</td></tr><tr><td>3</td><td>abc</td><td>brooklin</td><td>US</td></tr></table></div></div>
</div>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sparksql</span>

SELECT *, EXPLODE(places_lived) AS struct_place
FROM tbl_employee
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table><tr style="border-bottom: 1px solid"><td style="font-weight: bold">id</td><td style="font-weight: bold">name</td><td style="font-weight: bold">employee_info</td><td style="font-weight: bold">places_lived</td><td style="font-weight: bold">struct_place</td></tr><tr><td>1</td><td>Anna</td><td>Row(employer=&#x27;Anna&#x27;, id=1, address=&#x27;US&#x27;)</td><td>[Row(street=&#x27;abc&#x27;, city=&#x27;new york&#x27;, country=&#x27;US&#x27;)]</td><td>Row(street=&#x27;abc&#x27;, city=&#x27;new york&#x27;, country=&#x27;US&#x27;)</td></tr><tr><td>2</td><td>Alex</td><td>Row(employer=&#x27;Alex&#x27;, id=2, address=&#x27;US&#x27;)</td><td>[Row(street=&#x27;abc&#x27;, city=&#x27;cali&#x27;, country=&#x27;US&#x27;)]</td><td>Row(street=&#x27;abc&#x27;, city=&#x27;cali&#x27;, country=&#x27;US&#x27;)</td></tr><tr><td>3</td><td>Tom</td><td>Row(employer=&#x27;Tom&#x27;, id=3, address=&#x27;US&#x27;)</td><td>[Row(street=&#x27;abc&#x27;, city=&#x27;brooklin&#x27;, country=&#x27;US&#x27;)]</td><td>Row(street=&#x27;abc&#x27;, city=&#x27;brooklin&#x27;, country=&#x27;US&#x27;)</td></tr></table></div></div>
</div>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sparksql</span>

SELECT id, ARRAYS_ZIP(ARRAY(employee_info), places_lived) AS info
FROM tbl_employee 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table><tr style="border-bottom: 1px solid"><td style="font-weight: bold">id</td><td style="font-weight: bold">info</td></tr><tr><td>1</td><td>[Row(0=Row(employer=&#x27;Anna&#x27;, id=1, address=&#x27;US&#x27;), places_lived=Row(street=&#x27;abc&#x27;, city=&#x27;new york&#x27;, country=&#x27;US&#x27;))]</td></tr><tr><td>2</td><td>[Row(0=Row(employer=&#x27;Alex&#x27;, id=2, address=&#x27;US&#x27;), places_lived=Row(street=&#x27;abc&#x27;, city=&#x27;cali&#x27;, country=&#x27;US&#x27;))]</td></tr><tr><td>3</td><td>[Row(0=Row(employer=&#x27;Tom&#x27;, id=3, address=&#x27;US&#x27;), places_lived=Row(street=&#x27;abc&#x27;, city=&#x27;brooklin&#x27;, country=&#x27;US&#x27;))]</td></tr></table></div></div>
</div>
</section>
<section id="map-type">
<h3>3.3. Map type<a class="headerlink" href="#map-type" title="Permalink to this headline">#</a></h3>
<ul class="simple">
<li><p>Definition: same as Python’s dict</p></li>
<li><p>Schema: <code class="docutils literal notranslate"><span class="pre">MAP&lt;STRING,</span> <span class="pre">STRING&gt;</span></code></p></li>
<li><p>Inserting: <code class="docutils literal notranslate"><span class="pre">MAP('0',</span> <span class="pre">'algebra',</span> <span class="pre">'1',</span> <span class="pre">'calculus')</span></code></p></li>
<li><p>Accessing: <code class="docutils literal notranslate"><span class="pre">M['0']</span></code></p></li>
<li><p>Techniques:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">LATERAL</span> <span class="pre">VIEW,</span> <span class="pre">EXPLODE,</span> <span class="pre">POSEEXPLODE,</span> <span class="pre">INLINE,...</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">MAP_KEYS,</span> <span class="pre">MAP_VALUES,</span> <span class="pre">STR_TO_MAP</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">GET_JSON_OBJECT</span></code></p></li>
</ul>
</li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sparksql</span>
CREATE EXTERNAL TABLE IF NOT EXISTS tbl_class
STORED AS PARQUET
LOCATION &#39;tbl_class&#39;
TBLPROPERTIES (&#39;parquet.compression&#39;=&#39;snappy&#39;)

SELECT * FROM VALUES
(1, &#39;Anna&#39;, MAP(&#39;year&#39;,2021,&#39;teacher&#39;,&#39;Myan&#39;,&#39;subject&#39;,&#39;math&#39;), &#39;score,3.4&#39;),
(2, &#39;Alex&#39;, MAP(&#39;year&#39;,2021,&#39;teacher&#39;,&#39;Myan&#39;,&#39;subject&#39;,&#39;math&#39;), &#39;score,2.2&#39;),
(3, &#39;Tom&#39;, MAP(&#39;year&#39;,2021,&#39;teacher&#39;,&#39;Myan&#39;,&#39;subject&#39;,&#39;math&#39;), &#39;score,1.5&#39;)
AS (id, name, info, score)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table><tr style="border-bottom: 1px solid"></tr></table></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sparksql</span>

DESC tbl_class
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table><tr style="border-bottom: 1px solid"><td style="font-weight: bold">col_name</td><td style="font-weight: bold">data_type</td><td style="font-weight: bold">comment</td></tr><tr><td>id</td><td>int</td><td>null</td></tr><tr><td>name</td><td>string</td><td>null</td></tr><tr><td>info</td><td>map&lt;string,string&gt;</td><td>null</td></tr><tr><td>score</td><td>string</td><td>null</td></tr></table></div></div>
</div>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sparksql</span>

SELECT *, info[&#39;year&#39;] AS year, info.teacher
FROM tbl_class
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table><tr style="border-bottom: 1px solid"><td style="font-weight: bold">id</td><td style="font-weight: bold">name</td><td style="font-weight: bold">info</td><td style="font-weight: bold">score</td><td style="font-weight: bold">year</td><td style="font-weight: bold">teacher</td></tr><tr><td>1</td><td>Anna</td><td>{&#x27;year&#x27;: &#x27;2021&#x27;, &#x27;subject&#x27;: &#x27;math&#x27;, &#x27;teacher&#x27;: &#x27;Myan&#x27;}</td><td>score,3.4</td><td>2021</td><td>Myan</td></tr><tr><td>2</td><td>Alex</td><td>{&#x27;year&#x27;: &#x27;2021&#x27;, &#x27;subject&#x27;: &#x27;math&#x27;, &#x27;teacher&#x27;: &#x27;Myan&#x27;}</td><td>score,2.2</td><td>2021</td><td>Myan</td></tr><tr><td>3</td><td>Tom</td><td>{&#x27;year&#x27;: &#x27;2021&#x27;, &#x27;subject&#x27;: &#x27;math&#x27;, &#x27;teacher&#x27;: &#x27;Myan&#x27;}</td><td>score,1.5</td><td>2021</td><td>Myan</td></tr></table></div></div>
</div>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sparksql</span>

SELECT *, MAP_KEYS(info) AS key, MAP_VALUES(info) AS value
FROM tbl_class
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table><tr style="border-bottom: 1px solid"><td style="font-weight: bold">id</td><td style="font-weight: bold">name</td><td style="font-weight: bold">info</td><td style="font-weight: bold">score</td><td style="font-weight: bold">key</td><td style="font-weight: bold">value</td></tr><tr><td>1</td><td>Anna</td><td>{&#x27;year&#x27;: &#x27;2021&#x27;, &#x27;subject&#x27;: &#x27;math&#x27;, &#x27;teacher&#x27;: &#x27;Myan&#x27;}</td><td>score,3.4</td><td>[&#x27;year&#x27;, &#x27;teacher&#x27;, &#x27;subject&#x27;]</td><td>[&#x27;2021&#x27;, &#x27;Myan&#x27;, &#x27;math&#x27;]</td></tr><tr><td>2</td><td>Alex</td><td>{&#x27;year&#x27;: &#x27;2021&#x27;, &#x27;subject&#x27;: &#x27;math&#x27;, &#x27;teacher&#x27;: &#x27;Myan&#x27;}</td><td>score,2.2</td><td>[&#x27;year&#x27;, &#x27;teacher&#x27;, &#x27;subject&#x27;]</td><td>[&#x27;2021&#x27;, &#x27;Myan&#x27;, &#x27;math&#x27;]</td></tr><tr><td>3</td><td>Tom</td><td>{&#x27;year&#x27;: &#x27;2021&#x27;, &#x27;subject&#x27;: &#x27;math&#x27;, &#x27;teacher&#x27;: &#x27;Myan&#x27;}</td><td>score,1.5</td><td>[&#x27;year&#x27;, &#x27;teacher&#x27;, &#x27;subject&#x27;]</td><td>[&#x27;2021&#x27;, &#x27;Myan&#x27;, &#x27;math&#x27;]</td></tr></table></div></div>
</div>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sparksql</span>

SELECT *, STR_TO_MAP(score), SIZE(info)
FROM tbl_class
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table><tr style="border-bottom: 1px solid"><td style="font-weight: bold">id</td><td style="font-weight: bold">name</td><td style="font-weight: bold">info</td><td style="font-weight: bold">score</td><td style="font-weight: bold">str_to_map(score, ,, :)</td><td style="font-weight: bold">size(info)</td></tr><tr><td>1</td><td>Anna</td><td>{&#x27;year&#x27;: &#x27;2021&#x27;, &#x27;subject&#x27;: &#x27;math&#x27;, &#x27;teacher&#x27;: &#x27;Myan&#x27;}</td><td>score,3.4</td><td>{&#x27;score&#x27;: None, &#x27;3.4&#x27;: None}</td><td>3</td></tr><tr><td>2</td><td>Alex</td><td>{&#x27;year&#x27;: &#x27;2021&#x27;, &#x27;subject&#x27;: &#x27;math&#x27;, &#x27;teacher&#x27;: &#x27;Myan&#x27;}</td><td>score,2.2</td><td>{&#x27;score&#x27;: None, &#x27;2.2&#x27;: None}</td><td>3</td></tr><tr><td>3</td><td>Tom</td><td>{&#x27;year&#x27;: &#x27;2021&#x27;, &#x27;subject&#x27;: &#x27;math&#x27;, &#x27;teacher&#x27;: &#x27;Myan&#x27;}</td><td>score,1.5</td><td>{&#x27;1.5&#x27;: None, &#x27;score&#x27;: None}</td><td>3</td></tr></table></div></div>
</div>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "hungpq7/tabular-book",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./04-big-data"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="_intro.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title"><b>4. Big Data</b></p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="pyspark-data-exploratory.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">PySpark: Data Exploratory</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Quang Hung &#9829; Thuy Linh<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>
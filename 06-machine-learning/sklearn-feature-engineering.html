
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Sklearn: Feature Engineering</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Lenskit: Recommendation" href="lenskit-recommendation.html" />
    <link rel="prev" title="Sklearn: Regression" href="sklearn-regression.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/logo.svg" class="logo" alt="logo">
      
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../util/intro.html">
                    Data Science
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../01-python-programing/_intro.html">
   <b>
    1. Python Programing
   </b>
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../01-python-programing/python-basic-concepts.html">
     Python: Basic Concepts
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../01-python-programing/python-data-types.html">
     Python: Data Types
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../01-python-programing/python-data-containers.html">
     Python: Data Containers
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../01-python-programing/python-functions-objects.html">
     Python: Functions and Objects
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../01-python-programing/python-algorithms.html">
     (w) Python: Algorithms
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../01-python-programing/python-external-sources.html">
     Python: External Sources
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../01-python-programing/selenium-web-scraping.html">
     Selenium: Web Scraping
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../02-mathematics/_intro.html">
   <b>
    2. Mathematics
   </b>
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../02-mathematics/numpy-linear-algebra.html">
     NumPy: Linear Algebra
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../02-mathematics/sympy-calculus.html">
     SymPy: Calculus
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../02-mathematics/numpy-probability.html">
     NumPy: Probability
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../02-mathematics/numpy-statistics.html">
     NumPy: Statistics
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../02-mathematics/scipy-hypothesis-testing.html">
     SciPy: Hypothesis Testing
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../02-mathematics/numpy-applied-mathematics.html">
     NumPy: Applied Mathematics
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../02-mathematics/networkx-network-analysis.html">
     (w) NetworkX: Network Analysis
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../03-data-manipulation/_intro.html">
   <b>
    3. Data Manipulation
   </b>
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../03-data-manipulation/numpy-arrays.html">
     NumPy: Arrays
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03-data-manipulation/pandas-data-exploratory.html">
     Pandas: Data Exploratory
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03-data-manipulation/pandas-data-cleaning.html">
     Pandas: Data Cleaning
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03-data-manipulation/pandas-data-transformation.html">
     Pandas: Data Transformation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03-data-manipulation/janitor-pandas-extensions.html">
     Janitor: Pandas Extensions
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../04-big-data/_intro.html">
   <b>
    4. Big Data
   </b>
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../04-big-data/hiveql-data-manipulation.html">
     HiveQL: Data Manipulation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../04-big-data/pyspark-data-exploratory.html">
     PySpark: Data Exploratory
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../04-big-data/pyspark-data-cleaning.html">
     PySpark: Data Cleaning
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../04-big-data/pyspark-data-transformation.html">
     PySpark: Data Transformation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../04-big-data/dask-parallelized-pandas.html">
     Dask: Parallelized Pandas
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../05-data-visualization/_intro.html">
   <b>
    5. Data Visualization
   </b>
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../05-data-visualization/matplotlib-graph-construction.html">
     Matplotlib: Graph Construction
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../05-data-visualization/seaborn-statistical-visualization.html">
     Seaborn: Statistical Visualization
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../05-data-visualization/plotly-interactive-visualization.html">
     Plotly: Interactive Visualization
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="_intro.html">
   <b>
    6. Machine Learning
   </b>
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="sklearn-machine-learning.html">
     Sklearn: Machine Learning
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="sklearn-classification.html">
     Sklearn: Classification
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="sklearn-regression.html">
     Sklearn: Regression
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Sklearn: Feature Engineering
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="lenskit-recommendation.html">
     Lenskit: Recommendation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="pyspark-machine-learning.html">
     PySpark: Machine Learning
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../07-tabular-learning/_intro.html">
   <b>
    7. Tabular Learning
   </b>
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
  <label for="toctree-checkbox-7">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../07-tabular-learning/sklearn-ensemble-learning.html">
     Sklearn: Ensemble Learning
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../07-tabular-learning/xgboost-tree-boosting.html">
     XGBoost: Tree Boosting
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../07-tabular-learning/ray-hyperparameter-optimization.html">
     Ray: Hyperparam Optimization
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../07-tabular-learning/shap-model-interpretation.html">
     Shap: Model Interpretation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../07-tabular-learning/imblearn-targeted-modeling.html">
     Imblearn: Targeted Modeling
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../08-time-series/_intro.html">
   <b>
    8. Time Series
   </b>
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
  <label for="toctree-checkbox-8">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../08-time-series/statsmodels-temporal-analysis.html">
     Statsmodels: Temporal Analysis
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../08-time-series/prophet-forecasting-algorithms.html">
     Prophet: Forecasting Algorithms
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../08-time-series/sktime-forecasting-pipeline.html">
     Sktime: Forecasting Pipeline
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../08-time-series/darts-deep-forecasting.html">
     Darts: Deep Forecasting
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../09-unsupervised-learning/_intro.html">
   <b>
    9. Unsupervised Learning
   </b>
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/>
  <label for="toctree-checkbox-9">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../09-unsupervised-learning/mlxtend-association-rules.html">
     (w) MLxtend: Association Rules
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../09-unsupervised-learning/sklearn-clustering.html">
     Sklearn: Clustering
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../09-unsupervised-learning/sklearn-dimensional-reduction.html">
     Sklearn: Dimensional Reduction
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../09-unsupervised-learning/pyod-anomaly-detection.html">
     PyOD: Anomaly Detection
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../10-deep-learning/_intro.html">
   <b>
    10. Deep Learning
   </b>
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/>
  <label for="toctree-checkbox-10">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../10-deep-learning/gensim-text-mining.html">
     Gensim: Text Mining
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../10-deep-learning/opencv-image-processing.html">
     OpenCV: Image Processing
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../10-deep-learning/numpy-gradient-descent.html">
     Python: Gradient Descent
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../10-deep-learning/keras-multilayer-perceptron.html">
     Keras: Multilayer Perceptron
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../10-deep-learning/keras-recurrent-networks.html">
     Keras: Recurrent Networks
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../10-deep-learning/keras-convolutional-networks.html">
     Keras: Convolutional Networks
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../10-deep-learning/pytorch-deep-learning.html">
     PyTorch: Deep Learning
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../10-deep-learning/transformers-transfer-learning.html">
     Transformers: Transfer Learning
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../11-r-programing/_intro.html">
   <b>
    11. R Programing
   </b>
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/>
  <label for="toctree-checkbox-11">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../11-r-programing/r-basic-concepts.html">
     R: Basic Concepts
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../11-r-programing/r-data-structures.html">
     R: Data Structures
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../11-r-programing/tidyverse-data-wrangling.html">
     Tidyverse: Data Wrangling
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../11-r-programing/dplyr-data-cleaning.html">
     Dplyr: Data Cleaning
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../11-r-programing/ggplot-data-visualization.html">
     Ggplot: Data Visualization
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../11-r-programing/r-statistics.html">
     R: Statistics
    </a>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/hungpq7/tabular-book/master?urlpath=lab/tree/06-machine-learning/sklearn-feature-engineering.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
      <li>
        <a href="https://colab.research.google.com/github/hungpq7/tabular-book/blob/master/06-machine-learning/sklearn-feature-engineering.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Colab"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../_static/images/logo_colab.png">
  </span>
<span class="headerbtn__text-container">Colab</span>
</a>

      </li>
      
      <li>
        
<button onclick="initThebeSBT()"
  class="headerbtn headerbtn-launch-thebe"
  data-toggle="tooltip"
data-placement="left"
title="Launch Thebe"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-play"></i>
  </span>
<span class="headerbtn__text-container">Live Code</span>
</button>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>
<a href="https://github.com/hungpq7/tabular-book"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="bottom"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>

</a>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../_sources/06-machine-learning/sklearn-feature-engineering.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-preprocessing">
   1. Data preprocessing
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#scaling">
     1.1. Scaling
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#min-max-scaling">
       Min-max scaling
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#standardization">
       Standardization
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#normalizing">
       Normalizing
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#transformation">
     1.2. Transformation
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#logarithm">
       Logarithm
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#box-cox">
       Box-Cox
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#yeo-johnson">
       Yeo-Johnson
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#bucketizing">
     1.2. Bucketizing
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#discretizating">
       Discretizating
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#clustering">
       Clustering
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#mapping">
       Mapping
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#encoding">
     1.3. Encoding
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#ordinal-encoding">
       Ordinal encoding
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#one-hot-encoding">
       One-hot encoding
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#rare-encoding">
       Rare encoding
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#helmert-encoding">
       Helmert encoding
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#count-encoding">
       Count encoding
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#target-encoding">
       Target encoding
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#m-estimate-encoding">
       M-estimate encoding
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#weight-of-evidence">
       Weight of Evidence
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#feature-synthesis">
   2. Feature synthesis
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#transform-within-a-table">
     2.1. Transform within a table
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#aggregating-across-tables">
     2.2. Aggregating across tables
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#entity-set">
       Entity set
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#primitives">
       Primitives
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#pipeline">
   3. Pipeline
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id1">
     3.1. Data preprocessing
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#simple-pipeline">
       Simple pipeline
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#column-transformer">
       Column transformer
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#modeling">
     3.2. Modeling
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#grid-search">
       Grid search
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#model-selection">
       Model selection
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#saving-a-model">
       Saving a model
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#resources">
   Resources
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Sklearn: Feature Engineering</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-preprocessing">
   1. Data preprocessing
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#scaling">
     1.1. Scaling
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#min-max-scaling">
       Min-max scaling
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#standardization">
       Standardization
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#normalizing">
       Normalizing
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#transformation">
     1.2. Transformation
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#logarithm">
       Logarithm
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#box-cox">
       Box-Cox
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#yeo-johnson">
       Yeo-Johnson
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#bucketizing">
     1.2. Bucketizing
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#discretizating">
       Discretizating
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#clustering">
       Clustering
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#mapping">
       Mapping
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#encoding">
     1.3. Encoding
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#ordinal-encoding">
       Ordinal encoding
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#one-hot-encoding">
       One-hot encoding
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#rare-encoding">
       Rare encoding
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#helmert-encoding">
       Helmert encoding
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#count-encoding">
       Count encoding
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#target-encoding">
       Target encoding
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#m-estimate-encoding">
       M-estimate encoding
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#weight-of-evidence">
       Weight of Evidence
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#feature-synthesis">
   2. Feature synthesis
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#transform-within-a-table">
     2.1. Transform within a table
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#aggregating-across-tables">
     2.2. Aggregating across tables
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#entity-set">
       Entity set
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#primitives">
       Primitives
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#pipeline">
   3. Pipeline
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id1">
     3.1. Data preprocessing
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#simple-pipeline">
       Simple pipeline
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#column-transformer">
       Column transformer
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#modeling">
     3.2. Modeling
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#grid-search">
       Grid search
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#model-selection">
       Model selection
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#saving-a-model">
       Saving a model
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#resources">
   Resources
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="sklearn-feature-engineering">
<h1>Sklearn: Feature Engineering<a class="headerlink" href="#sklearn-feature-engineering" title="Permalink to this headline">#</a></h1>
<p>As introducted in the topic <em>Pandas: Data Cleaning</em>, clean data is used as the input for analytical tasks. However, to build a good predictive model (in both performance and computation), a lot more works need to be done in order to improve data quality. These kind of tasks are called <a class="reference external" href="https://en.wikipedia.org/wiki/Feature_engineering">feature engineering</a>, they get data into the appropriate format and reveal hidden insights. Feature engineering tasks are technically simple, but they do require some domain knowledge. This makes feature engineering more of an art than a science.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">janitor</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">stats</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>

<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">MinMaxScaler</span><span class="p">,</span> <span class="n">Normalizer</span><span class="p">,</span> <span class="n">StandardScaler</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">FunctionTransformer</span><span class="p">,</span> <span class="n">OneHotEncoder</span><span class="p">,</span> <span class="n">OrdinalEncoder</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span><span class="p">,</span> <span class="n">GridSearchCV</span> 
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span><span class="p">,</span> <span class="n">make_pipeline</span>
<span class="kn">from</span> <span class="nn">sklearn.cluster</span> <span class="kn">import</span> <span class="n">KMeans</span>
<span class="kn">from</span> <span class="nn">sklearn.impute</span> <span class="kn">import</span> <span class="n">SimpleImputer</span><span class="p">,</span> <span class="n">KNNImputer</span>
<span class="kn">from</span> <span class="nn">sklearn.compose</span> <span class="kn">import</span> <span class="n">ColumnTransformer</span>
<span class="kn">from</span> <span class="nn">sklearn.base</span> <span class="kn">import</span> <span class="n">BaseEstimator</span>
<span class="kn">from</span> <span class="nn">sklearn.tree</span> <span class="kn">import</span> <span class="n">DecisionTreeClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span><span class="p">,</span> <span class="n">HistGradientBoostingClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">roc_auc_score</span> <span class="k">as</span> <span class="n">AUC</span>

<span class="kn">from</span> <span class="nn">feature_engine.transformation</span> <span class="kn">import</span> <span class="n">LogCpTransformer</span><span class="p">,</span> <span class="n">PowerTransformer</span>
<span class="kn">from</span> <span class="nn">feature_engine.transformation</span> <span class="kn">import</span> <span class="n">BoxCoxTransformer</span><span class="p">,</span> <span class="n">YeoJohnsonTransformer</span>
<span class="kn">from</span> <span class="nn">feature_engine.wrappers</span> <span class="kn">import</span> <span class="n">SklearnTransformerWrapper</span>
<span class="kn">from</span> <span class="nn">feature_engine.encoding</span> <span class="kn">import</span> <span class="n">RareLabelEncoder</span>

<span class="kn">import</span> <span class="nn">category_encoders</span> <span class="k">as</span> <span class="nn">ce</span>
<span class="kn">import</span> <span class="nn">featuretools</span> <span class="k">as</span> <span class="nn">ft</span>

<span class="n">np</span><span class="o">.</span><span class="n">set_printoptions</span><span class="p">(</span><span class="n">precision</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">suppress</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">([</span><span class="s1">&#39;seaborn&#39;</span><span class="p">,</span> <span class="s1">&#39;seaborn-whitegrid&#39;</span><span class="p">])</span>
<span class="o">%</span><span class="k">config</span> InlineBackend.figure_format = &#39;retina&#39;
</pre></div>
</div>
</div>
</div>
<section id="data-preprocessing">
<h2>1. Data preprocessing<a class="headerlink" href="#data-preprocessing" title="Permalink to this headline">#</a></h2>
<section id="scaling">
<h3>1.1. Scaling<a class="headerlink" href="#scaling" title="Permalink to this headline">#</a></h3>
<p>Scaling is a preprocessing technique defined only on numerical variables, where the scaled variable distributes the same as the original one but does have specific properties.</p>
<ul class="simple">
<li><p><em>Min-max scaling</em>: to have the min of <span class="math notranslate nohighlight">\(0\)</span> and max of <span class="math notranslate nohighlight">\(1\)</span></p></li>
<li><p><em>Standardization</em>: to have the mean of <span class="math notranslate nohighlight">\(0\)</span> and standard deviation of <span class="math notranslate nohighlight">\(1\)</span></p></li>
<li><p><em>Manhattan normalization</em>: to have the absolute values sum up to <span class="math notranslate nohighlight">\(1\)</span></p></li>
<li><p><em>Euclidean normalization</em>: to have the squared values sum up to <span class="math notranslate nohighlight">\(1\)</span></p></li>
</ul>
<section id="min-max-scaling">
<h4>Min-max scaling<a class="headerlink" href="#min-max-scaling" title="Permalink to this headline">#</a></h4>
<p>Many Machine Learning algorithms assume all variables are on the same scale, typically <span class="math notranslate nohighlight">\([0;1]\)</span>. The formula for rescaling to <span class="math notranslate nohighlight">\([a;b]\)</span> is:</p>
<div class="math notranslate nohighlight">
\[\mathbf{x}'=\frac{\mathbf{x}-\mathbf{x}_{min}}{\mathbf{x}_{max}-\mathbf{x}_{min}}(b-a)+a\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">17</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">38</span><span class="p">],</span>
    <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">75</span><span class="p">,</span> <span class="mi">81</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">55</span><span class="p">]</span>
<span class="p">})</span>

<span class="n">scaler</span> <span class="o">=</span> <span class="n">MinMaxScaler</span><span class="p">(</span><span class="n">feature_range</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
<span class="n">dataScaled</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<span class="n">dfScaled</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">dataScaled</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;x_scaled&#39;</span><span class="p">,</span> <span class="s1">&#39;y_scaled&#39;</span><span class="p">])</span>

<span class="n">df</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dfScaled</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>x</th>
      <th>y</th>
      <th>x_scaled</th>
      <th>y_scaled</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>17</td>
      <td>75</td>
      <td>0.000000</td>
      <td>0.896552</td>
    </tr>
    <tr>
      <th>1</th>
      <td>22</td>
      <td>81</td>
      <td>0.238095</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>2</th>
      <td>25</td>
      <td>32</td>
      <td>0.380952</td>
      <td>0.155172</td>
    </tr>
    <tr>
      <th>3</th>
      <td>30</td>
      <td>23</td>
      <td>0.619048</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>4</th>
      <td>38</td>
      <td>55</td>
      <td>1.000000</td>
      <td>0.551724</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="standardization">
<h4>Standardization<a class="headerlink" href="#standardization" title="Permalink to this headline">#</a></h4>
<p>Also called <em>z-score</em> scaling, it is a technique that transforms a variable so that it has a mean of <span class="math notranslate nohighlight">\(0\)</span> and a standard deviation of <span class="math notranslate nohighlight">\(1\)</span>. Standardization is strongly recommended as the default method for data preprocessing. The formula for standardizing <span class="math notranslate nohighlight">\(x\)</span> is:</p>
<div class="math notranslate nohighlight">
\[\mathbf{x}'=\frac{\mathbf{x}-\mu_\mathbf{x}}{\sigma_\mathbf{x}}\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">17</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">38</span><span class="p">],</span>
    <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">75</span><span class="p">,</span> <span class="mi">81</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">55</span><span class="p">]</span>
<span class="p">})</span>

<span class="n">scaler</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span>
<span class="n">dataScaled</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<span class="n">dfScaled</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">dataScaled</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;x_scaled&#39;</span><span class="p">,</span> <span class="s1">&#39;y_scaled&#39;</span><span class="p">])</span>

<span class="n">df</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dfScaled</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>x</th>
      <th>y</th>
      <th>x_scaled</th>
      <th>y_scaled</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>17</td>
      <td>75</td>
      <td>-1.310622</td>
      <td>0.953649</td>
    </tr>
    <tr>
      <th>1</th>
      <td>22</td>
      <td>81</td>
      <td>-0.613483</td>
      <td>1.216121</td>
    </tr>
    <tr>
      <th>2</th>
      <td>25</td>
      <td>32</td>
      <td>-0.195199</td>
      <td>-0.927401</td>
    </tr>
    <tr>
      <th>3</th>
      <td>30</td>
      <td>23</td>
      <td>0.501940</td>
      <td>-1.321110</td>
    </tr>
    <tr>
      <th>4</th>
      <td>38</td>
      <td>55</td>
      <td>1.617363</td>
      <td>0.078742</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="normalizing">
<h4>Normalizing<a class="headerlink" href="#normalizing" title="Permalink to this headline">#</a></h4>
<p>This technique ensures the vector has a total length of 1. The length can be either Manhattan distance (<span class="math notranslate nohighlight">\(L_1\)</span>) <span class="math notranslate nohighlight">\(\|\mathbf{x}\|_1 = |x_1|+|x_2|+\dots+|x_n|\)</span> or Euclidean distance (<span class="math notranslate nohighlight">\(L_2\)</span>) <span class="math notranslate nohighlight">\(\|\mathbf{x}\|_2 = \sqrt{x_1^2+x_2^2+\dots+x_n^2}\)</span>. The formula for normalizing is:</p>
<div class="math notranslate nohighlight">
\[\mathbf{x}'=\frac{\mathbf{x}}{\|\mathbf{x}\|}\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">17</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">38</span><span class="p">],</span>
    <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">75</span><span class="p">,</span> <span class="mi">81</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">55</span><span class="p">]</span>
<span class="p">})</span>

<span class="n">scaler</span> <span class="o">=</span> <span class="n">Normalizer</span><span class="p">(</span><span class="n">norm</span><span class="o">=</span><span class="s1">&#39;l1&#39;</span><span class="p">)</span>
<span class="n">dataScaled</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
<span class="n">dfScaled</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">dataScaled</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;x_scaled&#39;</span><span class="p">,</span> <span class="s1">&#39;y_scaled&#39;</span><span class="p">])</span>

<span class="n">df</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dfScaled</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>x</th>
      <th>y</th>
      <th>x_scaled</th>
      <th>y_scaled</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>17</td>
      <td>75</td>
      <td>0.128788</td>
      <td>0.281955</td>
    </tr>
    <tr>
      <th>1</th>
      <td>22</td>
      <td>81</td>
      <td>0.166667</td>
      <td>0.304511</td>
    </tr>
    <tr>
      <th>2</th>
      <td>25</td>
      <td>32</td>
      <td>0.189394</td>
      <td>0.120301</td>
    </tr>
    <tr>
      <th>3</th>
      <td>30</td>
      <td>23</td>
      <td>0.227273</td>
      <td>0.086466</td>
    </tr>
    <tr>
      <th>4</th>
      <td>38</td>
      <td>55</td>
      <td>0.287879</td>
      <td>0.206767</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
</section>
<section id="transformation">
<h3>1.2. Transformation<a class="headerlink" href="#transformation" title="Permalink to this headline">#</a></h3>
<p>Sometimes real world data distribute not very nice, while most transformation techiniques do not affect the distribution. Imagine the label in a regression problem is mostly small values, then Machine Learning algorithms will have a hard time <em>learning</em> higher values. By taking advantage of mathematical functions, Data Scientists can control the distribution of data to make them more <em>nature</em>.</p>
<section id="logarithm">
<h4>Logarithm<a class="headerlink" href="#logarithm" title="Permalink to this headline">#</a></h4>
<p>This popular technique has the ability to make right skewed data distribute normally. The formula of the transformation is:</p>
<div class="math notranslate nohighlight">
\[\mathbf{x}'=\log_b{(\mathbf{x}+c)}\]</div>
<p>Some notable tips when using <a class="reference external" href="https://feature-engine.readthedocs.io/en/latest/api_doc/transformation/LogCpTransformer.html"><code class="docutils literal notranslate"><span class="pre">LogCpTransformer</span></code></a>:</p>
<ul class="simple">
<li><p>It works only on features contain all postive values.</p></li>
<li><p>Different base values <span class="math notranslate nohighlight">\(b\)</span> can be used, the most common ones are: <span class="math notranslate nohighlight">\(e\)</span>, <span class="math notranslate nohighlight">\(2\)</span> and <span class="math notranslate nohighlight">\(10\)</span>.</p></li>
<li><p>The term <span class="math notranslate nohighlight">\(c\)</span> (usually <span class="math notranslate nohighlight">\(c=1\)</span>) is added to <span class="math notranslate nohighlight">\(\mathbf{x}\)</span> to make sure the transformed values are all positive, since <span class="math notranslate nohighlight">\(\log{(x+1)}&gt;\log1=0\)</span>.</p></li>
<li><p>If the input values are very large, log transformation will not work. Thus, I insert a min-max scaler before it.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">skewnorm</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">10000</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="n">x</span><span class="p">})</span>

<span class="n">transformer</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span>
    <span class="n">SklearnTransformerWrapper</span><span class="p">(</span><span class="n">MinMaxScaler</span><span class="p">()),</span>
    <span class="n">LogCpTransformer</span><span class="p">(</span><span class="n">base</span><span class="o">=</span><span class="s1">&#39;10&#39;</span><span class="p">,</span> <span class="n">C</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
<span class="p">)</span>
<span class="n">dfTransformed</span> <span class="o">=</span> <span class="n">transformer</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">kde</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">dfTransformed</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">kde</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/sklearn-feature-engineering_15_0.png" src="../_images/sklearn-feature-engineering_15_0.png" />
</div>
</div>
</section>
<section id="box-cox">
<h4>Box-Cox<a class="headerlink" href="#box-cox" title="Permalink to this headline">#</a></h4>
<p><a class="reference external" href="https://en.wikipedia.org/wiki/Power_transform#Box%E2%80%93Cox_transformation">Box-Cox transform</a> is a member of <a class="reference external" href="https://en.wikipedia.org/wiki/Power_transform">power transform</a> family. It has the effect of making data more normal distribution-like. The transformation is given by a <a class="reference external" href="https://en.wikipedia.org/wiki/Piecewise">piecewise function</a> as below:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\mathbf{x}'=
\begin{cases}
    {\dfrac {\mathbf{x}^{\lambda}-1}{\lambda}}&amp;{\text{if }}\lambda\neq 0\\
    \log\mathbf{x}&amp;{\text{if }}\lambda=0
\end{cases}
\end{split}\]</div>
<p>We implement this transformation via the class <a class="reference external" href="https://feature-engine.readthedocs.io/en/latest/api_doc/transformation/BoxCoxTransformer.html"><code class="docutils literal notranslate"><span class="pre">BoxCoxTransformer</span></code></a>. It wraps the function <a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.stats.boxcox.html"><code class="docutils literal notranslate"><span class="pre">boxcox()</span></code></a> which estimates the value of <span class="math notranslate nohighlight">\(\lambda\)</span> that maximizes log-likelihood.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">skewnorm</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">10000</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="n">x</span><span class="p">})</span>

<span class="n">transformer</span> <span class="o">=</span> <span class="n">BoxCoxTransformer</span><span class="p">()</span>
<span class="n">dfTransformed</span> <span class="o">=</span> <span class="n">transformer</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">kde</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">dfTransformed</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">kde</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/sklearn-feature-engineering_18_0.png" src="../_images/sklearn-feature-engineering_18_0.png" />
</div>
</div>
</section>
<section id="yeo-johnson">
<h4>Yeo-Johnson<a class="headerlink" href="#yeo-johnson" title="Permalink to this headline">#</a></h4>
<p><a class="reference external" href="https://en.wikipedia.org/wiki/Power_transform#Yeo%E2%80%93Johnson_transformation">Yeo-Johnson transform</a> is another member of power transform family. It extends Box-Cox transform to handle nagative input data, using the following function:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\mathbf{x}'=
\begin{cases}
    \dfrac{(\mathbf{x}+1)^{\lambda}-1}{\lambda}       &amp; \text{if }\lambda\neq 0\text{ and }\mathbf{x}\geq 0 \\
    \log(\mathbf{x}+1)                                &amp; \text{if }\lambda=    0\text{ and }\mathbf{x}\geq 0 \\
    -\dfrac{(-\mathbf{x}+1)^{2-\lambda}-1}{2-\lambda} &amp; \text{if }\lambda\neq 2\text{ and }\mathbf{x}\leq 0 \\
    -\log(-\mathbf{x}+1)                              &amp; \text{if }\lambda=    0\text{ and }\mathbf{x}\geq 0 \\
\end{cases}
\end{split}\]</div>
<p>It can be implemented via the class <a class="reference external" href="https://feature-engine.readthedocs.io/en/latest/api_doc/transformation/YeoJohnsonTransformer.html"><code class="docutils literal notranslate"><span class="pre">YeoJohnsonTransformer</span></code></a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">skewnorm</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">10000</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="n">x</span><span class="p">})</span>

<span class="n">transformer</span> <span class="o">=</span> <span class="n">YeoJohnsonTransformer</span><span class="p">()</span>
<span class="n">dfTransformed</span> <span class="o">=</span> <span class="n">transformer</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">kde</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">dfTransformed</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">kde</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/sklearn-feature-engineering_21_0.png" src="../_images/sklearn-feature-engineering_21_0.png" />
</div>
</div>
</section>
</section>
<section id="bucketizing">
<h3>1.2. Bucketizing<a class="headerlink" href="#bucketizing" title="Permalink to this headline">#</a></h3>
<p>Bucketizing (or binning) refers to the tasks that put data into larger bins. Doing bucketizing means sacrifying information, however it makes data more regularized and thus prevents overfitting. Either numerical and categorical variables can be binned.</p>
<section id="discretizating">
<h4>Discretizating<a class="headerlink" href="#discretizating" title="Permalink to this headline">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">17</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">38</span><span class="p">]})</span>

<span class="n">group</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span>
    <span class="n">df</span><span class="o">.</span><span class="n">x</span><span class="p">,</span>
    <span class="n">bins</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span>
    <span class="n">right</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">])</span>

<span class="n">df</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">group</span><span class="o">=</span><span class="n">group</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>x</th>
      <th>group</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>17</td>
      <td>A</td>
    </tr>
    <tr>
      <th>1</th>
      <td>22</td>
      <td>B</td>
    </tr>
    <tr>
      <th>2</th>
      <td>25</td>
      <td>B</td>
    </tr>
    <tr>
      <th>3</th>
      <td>30</td>
      <td>C</td>
    </tr>
    <tr>
      <th>4</th>
      <td>38</td>
      <td>C</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="clustering">
<h4>Clustering<a class="headerlink" href="#clustering" title="Permalink to this headline">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">),</span>
    <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="p">})</span>

<span class="n">clusterer</span> <span class="o">=</span> <span class="n">KMeans</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">group</span> <span class="o">=</span> <span class="n">clusterer</span><span class="o">.</span><span class="n">fit_predict</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>

<span class="n">df</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">group</span><span class="o">=</span><span class="n">group</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>x</th>
      <th>y</th>
      <th>group</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>47</td>
      <td>86</td>
      <td>2</td>
    </tr>
    <tr>
      <th>1</th>
      <td>22</td>
      <td>81</td>
      <td>2</td>
    </tr>
    <tr>
      <th>2</th>
      <td>82</td>
      <td>16</td>
      <td>1</td>
    </tr>
    <tr>
      <th>3</th>
      <td>19</td>
      <td>35</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>85</td>
      <td>60</td>
      <td>1</td>
    </tr>
    <tr>
      <th>5</th>
      <td>15</td>
      <td>30</td>
      <td>0</td>
    </tr>
    <tr>
      <th>6</th>
      <td>89</td>
      <td>28</td>
      <td>1</td>
    </tr>
    <tr>
      <th>7</th>
      <td>74</td>
      <td>94</td>
      <td>2</td>
    </tr>
    <tr>
      <th>8</th>
      <td>26</td>
      <td>21</td>
      <td>0</td>
    </tr>
    <tr>
      <th>9</th>
      <td>11</td>
      <td>38</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="mapping">
<h4>Mapping<a class="headerlink" href="#mapping" title="Permalink to this headline">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;England&#39;</span><span class="p">,</span> <span class="s1">&#39;France&#39;</span><span class="p">,</span> <span class="s1">&#39;Germany&#39;</span><span class="p">,</span> <span class="s1">&#39;Korea&#39;</span><span class="p">,</span> <span class="s1">&#39;Japan&#39;</span><span class="p">]})</span>

<span class="n">x_map</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">map</span><span class="p">({</span>
    <span class="s1">&#39;England&#39;</span><span class="p">:</span> <span class="s1">&#39;Europe&#39;</span><span class="p">,</span> <span class="s1">&#39;France&#39;</span><span class="p">:</span> <span class="s1">&#39;Europe&#39;</span><span class="p">,</span> <span class="s1">&#39;Germany&#39;</span><span class="p">:</span> <span class="s1">&#39;Europe&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Korea&#39;</span><span class="p">:</span> <span class="s1">&#39;Asia&#39;</span><span class="p">,</span> <span class="s1">&#39;Japan&#39;</span><span class="p">:</span> <span class="s1">&#39;Asia&#39;</span>
<span class="p">})</span>

<span class="n">df</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">x_map</span><span class="o">=</span><span class="n">x_map</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>x</th>
      <th>x_map</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>England</td>
      <td>Europe</td>
    </tr>
    <tr>
      <th>1</th>
      <td>France</td>
      <td>Europe</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Germany</td>
      <td>Europe</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Korea</td>
      <td>Asia</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Japan</td>
      <td>Asia</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
</section>
<section id="encoding">
<h3>1.3. Encoding<a class="headerlink" href="#encoding" title="Permalink to this headline">#</a></h3>
<p>Encoding is the technique that transforms a categorical variable to numerical variable(s). This is important because most modern Machine Learning algorithms require input features to be numerical.</p>
<section id="ordinal-encoding">
<h4>Ordinal encoding<a class="headerlink" href="#ordinal-encoding" title="Permalink to this headline">#</a></h4>
<p><a class="reference external" href="https://contrib.scikit-learn.org/category_encoders/ordinal.html"><code class="docutils literal notranslate"><span class="pre">OrdinalEncoder</span></code></a>
transforms categorical columns into unique numbers starting from 0. The disadvantage is that the categories are ordered randomly, which can add unexpected noises that hurt model performance. It also provides an option to pass a dictionary for custom order.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;education&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;Highschool&#39;</span><span class="p">,</span> <span class="s1">&#39;Bachelor&#39;</span><span class="p">,</span> <span class="s1">&#39;Master&#39;</span><span class="p">,</span> <span class="s1">&#39;PhD&#39;</span><span class="p">]</span>
<span class="p">})</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">encoder</span> <span class="o">=</span> <span class="n">ce</span><span class="o">.</span><span class="n">OrdinalEncoder</span><span class="p">()</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;encodeEdu&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">encoder</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">education</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>education</th>
      <th>encodeEdu</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Highschool</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Bachelor</td>
      <td>2</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Master</td>
      <td>3</td>
    </tr>
    <tr>
      <th>3</th>
      <td>PhD</td>
      <td>4</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="one-hot-encoding">
<h4>One-hot encoding<a class="headerlink" href="#one-hot-encoding" title="Permalink to this headline">#</a></h4>
<p><a class="reference external" href="https://contrib.scikit-learn.org/category_encoders/onehot.html"><code class="docutils literal notranslate"><span class="pre">OneHotEncoder</span></code></a>
generates a binary feature for each category. This technique will expand the dataset which can lead to curse of dimensionality and over memory because of storing sparse data. A variant is sometimes used, call Dummy Encoding which cuts the last feature and encode the corresponding class using vectors of <span class="math notranslate nohighlight">\(0\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;fruit&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;Apple&#39;</span><span class="p">,</span> <span class="s1">&#39;Apple&#39;</span><span class="p">,</span> <span class="s1">&#39;Orange&#39;</span><span class="p">,</span> <span class="s1">&#39;Mango&#39;</span><span class="p">,</span> <span class="s1">&#39;Mango&#39;</span><span class="p">]</span>
<span class="p">})</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">encoder</span> <span class="o">=</span> <span class="n">ce</span><span class="o">.</span><span class="n">OneHotEncoder</span><span class="p">(</span><span class="n">use_cat_names</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">xEncoded</span> <span class="o">=</span> <span class="n">encoder</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">fruit</span><span class="p">)</span>

<span class="n">df</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">xEncoded</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>fruit</th>
      <th>fruit_Apple</th>
      <th>fruit_Orange</th>
      <th>fruit_Mango</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Apple</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Apple</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Orange</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Mango</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Mango</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="rare-encoding">
<h4>Rare encoding<a class="headerlink" href="#rare-encoding" title="Permalink to this headline">#</a></h4>
<p><a class="reference external" href="https://feature-engine.readthedocs.io/en/1.0.x/encoding/RareLabelEncoder.html"><code class="docutils literal notranslate"><span class="pre">RareLabelEncoder</span></code></a>
is more of a preprocessing technique than an encoder, as it does not returns a numerical value, which is what we are expecting. However, it is still an useful method to gather rare categories into a single group to reduces noises.</p>
<p>In this example, the data is about what phone operating system people are using. Beside popular Android and iOS, there are also low market share ones. As these observations are definitely not crucial to our model, and we want to focus on large categories (make more money, larger market), it would be better to group them into a single group.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;osPhone&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span>
        <span class="p">[</span><span class="s1">&#39;Android&#39;</span><span class="p">,</span> <span class="s1">&#39;iOS&#39;</span><span class="p">,</span> <span class="s1">&#39;Windows&#39;</span><span class="p">,</span> <span class="s1">&#39;Blackberry&#39;</span><span class="p">,</span> <span class="s1">&#39;Bada&#39;</span><span class="p">,</span> <span class="s1">&#39;Symbian&#39;</span><span class="p">,</span> <span class="s1">&#39;Meego&#39;</span><span class="p">],</span>
        <span class="n">size</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="p">[</span><span class="o">.</span><span class="mi">4</span><span class="p">,</span> <span class="o">.</span><span class="mi">32</span><span class="p">,</span> <span class="o">.</span><span class="mi">12</span><span class="p">,</span> <span class="o">.</span><span class="mi">10</span><span class="p">,</span> <span class="o">.</span><span class="mi">03</span><span class="p">,</span> <span class="o">.</span><span class="mi">02</span><span class="p">,</span> <span class="o">.</span><span class="mi">01</span><span class="p">]</span>
    <span class="p">)</span>
<span class="p">})</span>
<span class="n">df</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>osPhone</th>
      <th>count</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Android</td>
      <td>408</td>
    </tr>
    <tr>
      <th>1</th>
      <td>iOS</td>
      <td>309</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Windows</td>
      <td>130</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Blackberry</td>
      <td>99</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Bada</td>
      <td>30</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Symbian</td>
      <td>17</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Meego</td>
      <td>7</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">feature_engine.encoding</span> <span class="kn">import</span> <span class="n">RareLabelEncoder</span>
<span class="n">encoder</span> <span class="o">=</span> <span class="n">RareLabelEncoder</span><span class="p">(</span><span class="n">tol</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">n_categories</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">encoder</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>osPhone</th>
      <th>count</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Android</td>
      <td>408</td>
    </tr>
    <tr>
      <th>1</th>
      <td>iOS</td>
      <td>309</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Windows</td>
      <td>130</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Blackberry</td>
      <td>99</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Rare</td>
      <td>54</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="helmert-encoding">
<h4>Helmert encoding<a class="headerlink" href="#helmert-encoding" title="Permalink to this headline">#</a></h4>
<p><a class="reference external" href="https://contrib.scikit-learn.org/category_encoders/helmert.html"><code class="docutils literal notranslate"><span class="pre">HelmertEncoder</span></code></a>
uses the occuring order of categories in a feature to performce encoding. It ignores the first category, and for each category starting from the second one, it create a feature so that:</p>
<ul class="simple">
<li><p>Equals <span class="math notranslate nohighlight">\(-1\)</span> for all previous categories</p></li>
<li><p>Equals a categorys own rank for itself</p></li>
<li><p>Equals <span class="math notranslate nohighlight">\(0\)</span> elsewhere</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;education&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;Highschool&#39;</span><span class="p">,</span> <span class="s1">&#39;Bachelor&#39;</span><span class="p">,</span> <span class="s1">&#39;Master&#39;</span><span class="p">,</span> <span class="s1">&#39;PhD&#39;</span><span class="p">],</span>
    <span class="s1">&#39;target&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
<span class="p">})</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">encoder</span> <span class="o">=</span> <span class="n">ce</span><span class="o">.</span><span class="n">HelmertEncoder</span><span class="p">()</span>
<span class="n">dfEncode</span> <span class="o">=</span> <span class="n">encoder</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">df</span><span class="p">[[</span><span class="s1">&#39;education&#39;</span><span class="p">]],</span> <span class="n">df</span><span class="o">.</span><span class="n">target</span><span class="p">)</span>
<span class="n">dfEncode</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>intercept</th>
      <th>education_0</th>
      <th>education_1</th>
      <th>education_2</th>
      <th>education</th>
      <th>target</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>-1.0</td>
      <td>-1.0</td>
      <td>-1.0</td>
      <td>Highschool</td>
      <td>5</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>1.0</td>
      <td>-1.0</td>
      <td>-1.0</td>
      <td>Bachelor</td>
      <td>7</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1</td>
      <td>0.0</td>
      <td>2.0</td>
      <td>-1.0</td>
      <td>Master</td>
      <td>3</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>3.0</td>
      <td>PhD</td>
      <td>4</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="count-encoding">
<h4>Count encoding<a class="headerlink" href="#count-encoding" title="Permalink to this headline">#</a></h4>
<p><a class="reference external" href="https://contrib.scikit-learn.org/category_encoders/count.html"><code class="docutils literal notranslate"><span class="pre">CountEncoder</span></code></a> encodes each category using an integer of how many times or a float of how frequently it occurs in the dataset.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;fruit&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;Apple&#39;</span><span class="p">,</span> <span class="s1">&#39;Apple&#39;</span><span class="p">,</span> <span class="s1">&#39;Mango&#39;</span><span class="p">,</span> <span class="s1">&#39;Mango&#39;</span><span class="p">,</span> <span class="s1">&#39;Mango&#39;</span><span class="p">]</span>
<span class="p">})</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">encoder</span> <span class="o">=</span> <span class="n">ce</span><span class="o">.</span><span class="n">CountEncoder</span><span class="p">(</span><span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">encoder</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">fruit</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>fruit</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.4</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.4</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.6</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.6</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.6</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="target-encoding">
<h4>Target encoding<a class="headerlink" href="#target-encoding" title="Permalink to this headline">#</a></h4>
<p><a class="reference external" href="https://dl.acm.org/doi/10.1145/507533.507538">Target encoding</a> is the one most popular encoders used in Kaggle competitions. The main idea is to replace each category <span class="math notranslate nohighlight">\(c\)</span> of a categorial feature <span class="math notranslate nohighlight">\(\mathbf{x}\)</span> with the mean of target associated with that category, <span class="math notranslate nohighlight">\(y_c\)</span>. However, this encoding strategy suffers from <em>data leakage</em>, as we are kind of <em>leaking the answer before teaching our machinary student</em>. This is a significant disadvantage which leads to overfitting. To solve this, we smooth the encoded values by pushing it towards the population mean <span class="math notranslate nohighlight">\(\bar{y}\)</span>:</p>
<div class="math notranslate nohighlight">
\[x_c=wy_c+(1-w)\bar{y}\]</div>
<p>Here, <span class="math notranslate nohighlight">\(w\)</span> follows a logistic distribution parameterized by the category size <span class="math notranslate nohighlight">\(n_c\)</span>, so that our encoder assigns more credit to <span class="math notranslate nohighlight">\(y_c\)</span> when <span class="math notranslate nohighlight">\(n_c\)</span> is large and prefer population mean <span class="math notranslate nohighlight">\(\bar{y}\)</span> for small categories. The smoothing effect is controled via two hyperparameters, min samples leaf <span class="math notranslate nohighlight">\(k\)</span> and smoothing coefficient <span class="math notranslate nohighlight">\(f\)</span>, given as:</p>
<div class="math notranslate nohighlight">
\[w=\frac{1}{1+\exp\left(-\dfrac{n_c-k}{f}\right)}\]</div>
<p>We can see that, the weight of a very small category (when <span class="math notranslate nohighlight">\(n_c\ll k\)</span>) is approximately <span class="math notranslate nohighlight">\(0\)</span>. In the simple example below, our categories have only 2 or 3 observations; so if we set <span class="math notranslate nohighlight">\(k=10\)</span>, they will uniformally replaced with <span class="math notranslate nohighlight">\(\bar{y}=0.6\)</span>. And a higher value of <span class="math notranslate nohighlight">\(f\)</span> indicates a flatter logistic curve as well as stronger regularization effect.</p>
<p>You can implement <a class="reference external" href="https://contrib.scikit-learn.org/category_encoders/targetencoder.html"><code class="docutils literal notranslate"><span class="pre">TargetEncoder</span></code></a> for the original version or <a class="reference external" href="https://contrib.scikit-learn.org/category_encoders/leaveoneout.html"><code class="docutils literal notranslate"><span class="pre">LeaveOneOutEncoder</span></code></a>, a variant to tackle <em>data leakage</em> by excluding the current row from the calculation of mean target. Notice this will return different encoding values within a category.</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;education&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;Highschool&#39;</span><span class="p">]</span><span class="o">*</span><span class="mi">3</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;Bachelor&#39;</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;Master&#39;</span><span class="p">]</span><span class="o">*</span><span class="mi">3</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;PhD&#39;</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span>
    <span class="s1">&#39;target&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
<span class="p">})</span>

<span class="n">encoder1</span> <span class="o">=</span> <span class="n">ce</span><span class="o">.</span><span class="n">TargetEncoder</span><span class="p">(</span><span class="n">smoothing</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">min_samples_leaf</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">encoder2</span> <span class="o">=</span> <span class="n">ce</span><span class="o">.</span><span class="n">TargetEncoder</span><span class="p">(</span><span class="n">smoothing</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">min_samples_leaf</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">encoder3</span> <span class="o">=</span> <span class="n">ce</span><span class="o">.</span><span class="n">TargetEncoder</span><span class="p">(</span><span class="n">smoothing</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">min_samples_leaf</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">encoder4</span> <span class="o">=</span> <span class="n">ce</span><span class="o">.</span><span class="n">TargetEncoder</span><span class="p">(</span><span class="n">smoothing</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">min_samples_leaf</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">encoder5</span> <span class="o">=</span> <span class="n">ce</span><span class="o">.</span><span class="n">TargetEncoder</span><span class="p">(</span><span class="n">smoothing</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">min_samples_leaf</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">encoder6</span> <span class="o">=</span> <span class="n">ce</span><span class="o">.</span><span class="n">LeaveOneOutEncoder</span><span class="p">()</span>

<span class="n">dfEncode1</span> <span class="o">=</span> <span class="n">encoder1</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">education</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">target</span><span class="p">)</span>
<span class="n">dfEncode2</span> <span class="o">=</span> <span class="n">encoder2</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">education</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">target</span><span class="p">)</span>
<span class="n">dfEncode3</span> <span class="o">=</span> <span class="n">encoder3</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">education</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">target</span><span class="p">)</span>
<span class="n">dfEncode4</span> <span class="o">=</span> <span class="n">encoder4</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">education</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">target</span><span class="p">)</span>
<span class="n">dfEncode5</span> <span class="o">=</span> <span class="n">encoder5</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">education</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">target</span><span class="p">)</span>
<span class="n">dfEncode6</span> <span class="o">=</span> <span class="n">encoder6</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">education</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">target</span><span class="p">)</span>

<span class="n">df</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span>
    <span class="n">noSmooth</span> <span class="o">=</span> <span class="n">dfEncode1</span><span class="o">.</span><span class="n">education</span><span class="p">,</span>
    <span class="n">veryHardPenalty</span> <span class="o">=</span> <span class="n">dfEncode2</span><span class="o">.</span><span class="n">education</span><span class="p">,</span>
    <span class="n">weakPush</span> <span class="o">=</span> <span class="n">dfEncode3</span><span class="o">.</span><span class="n">education</span><span class="p">,</span>
    <span class="n">strongPushWithK</span> <span class="o">=</span> <span class="n">dfEncode4</span><span class="o">.</span><span class="n">education</span><span class="p">,</span>
    <span class="n">strongPushWithF</span> <span class="o">=</span> <span class="n">dfEncode5</span><span class="o">.</span><span class="n">education</span><span class="p">,</span>
    <span class="n">leaveOneOut</span> <span class="o">=</span> <span class="n">dfEncode6</span><span class="o">.</span><span class="n">education</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>education</th>
      <th>target</th>
      <th>noSmooth</th>
      <th>veryHardPenalty</th>
      <th>weakPush</th>
      <th>strongPushWithK</th>
      <th>strongPushWithF</th>
      <th>leaveOneOut</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Highschool</td>
      <td>0</td>
      <td>0.333333</td>
      <td>0.599757</td>
      <td>0.365121</td>
      <td>0.405051</td>
      <td>0.453378</td>
      <td>0.5</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Highschool</td>
      <td>1</td>
      <td>0.333333</td>
      <td>0.599757</td>
      <td>0.365121</td>
      <td>0.405051</td>
      <td>0.453378</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Highschool</td>
      <td>0</td>
      <td>0.333333</td>
      <td>0.599757</td>
      <td>0.365121</td>
      <td>0.405051</td>
      <td>0.453378</td>
      <td>0.5</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Bachelor</td>
      <td>0</td>
      <td>0.500000</td>
      <td>0.599966</td>
      <td>0.526894</td>
      <td>0.550000</td>
      <td>0.547502</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Bachelor</td>
      <td>1</td>
      <td>0.500000</td>
      <td>0.599966</td>
      <td>0.526894</td>
      <td>0.550000</td>
      <td>0.547502</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Master</td>
      <td>1</td>
      <td>0.666667</td>
      <td>0.600061</td>
      <td>0.658720</td>
      <td>0.648737</td>
      <td>0.636656</td>
      <td>0.5</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Master</td>
      <td>1</td>
      <td>0.666667</td>
      <td>0.600061</td>
      <td>0.658720</td>
      <td>0.648737</td>
      <td>0.636656</td>
      <td>0.5</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Master</td>
      <td>0</td>
      <td>0.666667</td>
      <td>0.600061</td>
      <td>0.658720</td>
      <td>0.648737</td>
      <td>0.636656</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>8</th>
      <td>PhD</td>
      <td>1</td>
      <td>1.000000</td>
      <td>0.600134</td>
      <td>0.892423</td>
      <td>0.800000</td>
      <td>0.809992</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>9</th>
      <td>PhD</td>
      <td>1</td>
      <td>1.000000</td>
      <td>0.600134</td>
      <td>0.892423</td>
      <td>0.800000</td>
      <td>0.809992</td>
      <td>1.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="m-estimate-encoding">
<h4>M-estimate encoding<a class="headerlink" href="#m-estimate-encoding" title="Permalink to this headline">#</a></h4>
<p><a class="reference external" href="https://contrib.scikit-learn.org/category_encoders/mestimate.html"><code class="docutils literal notranslate"><span class="pre">MEstimateEncoder</span></code></a> is a simplified version of Target Encoder with same functionality but has only a tunable hyperparameter <span class="math notranslate nohighlight">\(m\)</span>, smoothing factor. We first define a mask vector that activates category <span class="math notranslate nohighlight">\(c\)</span>: <span class="math notranslate nohighlight">\(\mathbf{i}_c(n)=\mathbf{1}[x_n=x_c]\)</span>, the encoding formula is given as:</p>
<div class="math notranslate nohighlight">
\[x_c=\frac
{\mathbf{i}_c^\text{T}\mathbf{y} + m\bar{y}}
{\mathbf{i}_c^\text{T}\mathbf{1} + m}
\]</div>
<p>Now lets explain what do these ugly things mean. First, <span class="math notranslate nohighlight">\(\mathbf{i}_c^\text{T}\mathbf{y}\)</span> is the <a class="reference external" href="https://en.wikipedia.org/wiki/Dot_product">dot product</a> of the mask vector and the target, it computes the sum of target associated with category <span class="math notranslate nohighlight">\(c\)</span>. The part <span class="math notranslate nohighlight">\(\mathbf{i}_c^\text{T}\mathbf{1}\)</span> is another dot product, it counts the number of observations of category <span class="math notranslate nohighlight">\(c\)</span>. We can also add a small normal distributed noise into training data</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;education&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;Highschool&#39;</span><span class="p">]</span><span class="o">*</span><span class="mi">3</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;Bachelor&#39;</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;Master&#39;</span><span class="p">]</span><span class="o">*</span><span class="mi">3</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;PhD&#39;</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span>
    <span class="s1">&#39;target&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
<span class="p">})</span>

<span class="n">encoder1</span> <span class="o">=</span> <span class="n">ce</span><span class="o">.</span><span class="n">MEstimateEncoder</span><span class="p">(</span><span class="n">m</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">encoder2</span> <span class="o">=</span> <span class="n">ce</span><span class="o">.</span><span class="n">MEstimateEncoder</span><span class="p">(</span><span class="n">m</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">encoder3</span> <span class="o">=</span> <span class="n">ce</span><span class="o">.</span><span class="n">MEstimateEncoder</span><span class="p">(</span><span class="n">m</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="n">dfEncode1</span> <span class="o">=</span> <span class="n">encoder1</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">education</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">target</span><span class="p">)</span>
<span class="n">dfEncode2</span> <span class="o">=</span> <span class="n">encoder2</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">education</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">target</span><span class="p">)</span>
<span class="n">dfEncode3</span> <span class="o">=</span> <span class="n">encoder3</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">education</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">target</span><span class="p">)</span>

<span class="n">df</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span>
    <span class="n">noSmooth</span> <span class="o">=</span> <span class="n">dfEncode1</span><span class="o">.</span><span class="n">education</span><span class="p">,</span>
    <span class="n">weekSmooth</span> <span class="o">=</span> <span class="n">dfEncode2</span><span class="o">.</span><span class="n">education</span><span class="p">,</span>
    <span class="n">strongSmooth</span> <span class="o">=</span> <span class="n">dfEncode3</span><span class="o">.</span><span class="n">education</span><span class="p">,</span>
<span class="p">)</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s1">&#39;target&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>education</th>
      <th>noSmooth</th>
      <th>weekSmooth</th>
      <th>strongSmooth</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Highschool</td>
      <td>0.333333</td>
      <td>0.400000</td>
      <td>0.538462</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Bachelor</td>
      <td>0.500000</td>
      <td>0.533333</td>
      <td>0.583333</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Master</td>
      <td>0.666667</td>
      <td>0.650000</td>
      <td>0.615385</td>
    </tr>
    <tr>
      <th>8</th>
      <td>PhD</td>
      <td>1.000000</td>
      <td>0.866667</td>
      <td>0.666667</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="weight-of-evidence">
<h4>Weight of Evidence<a class="headerlink" href="#weight-of-evidence" title="Permalink to this headline">#</a></h4>
<p>Weight of Evidence is a concept exists in credit scoring and risk management, being generally described as a measure of separation between good and bad things. When applied in Machine Learning, this method is used exclusively on binary target, implemented as <a class="reference external" href="https://contrib.scikit-learn.org/category_encoders/woe.html"><code class="docutils literal notranslate"><span class="pre">WOEEncoder</span></code></a>. It has the following formula:</p>
<div class="math notranslate nohighlight">
\[x_c=\log\frac{\text{P}(x=x_c|y=1)}{\text{P}(x=x_c|y=0)}\]</div>
<p>Its clear to see in this equation, the numerator is the probability of observing category <span class="math notranslate nohighlight">\(c\)</span> considering only postitive labeled data, and thus it refers to <em>good things</em>. The same inference can also be applied to the denominator. One thing to notice is that when calculating these probabilities, a small quantity is add to the denominators to (1) prevent zero division error and (2) add regularization effect.</p>
<p>A great advantage that WoE has, is that it makes our categorical feature resemble log-odds, and is thus well suited for Logistic Regression. This encoding strategy returns a positive value when a category is <em>better than average</em>, negative value when a category is <em>worse than average</em>. Lets see how it works in action.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;education&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;Highschool&#39;</span><span class="p">]</span><span class="o">*</span><span class="mi">3</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;Bachelor&#39;</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;Master&#39;</span><span class="p">]</span><span class="o">*</span><span class="mi">3</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;PhD&#39;</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span>
    <span class="s1">&#39;target&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
<span class="p">})</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">encoder</span> <span class="o">=</span> <span class="n">ce</span><span class="o">.</span><span class="n">WOEEncoder</span><span class="p">(</span><span class="n">regularization</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">dfEncode</span> <span class="o">=</span> <span class="n">encoder</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">education</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">target</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[[</span><span class="s1">&#39;education&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">woe</span><span class="o">=</span><span class="n">dfEncode</span><span class="o">.</span><span class="n">education</span><span class="p">)</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>education</th>
      <th>woe</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Highschool</td>
      <td>-0.693147</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Bachelor</td>
      <td>-0.287682</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Master</td>
      <td>0.117783</td>
    </tr>
    <tr>
      <th>8</th>
      <td>PhD</td>
      <td>0.810930</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
</section>
</section>
<section id="feature-synthesis">
<h2>2. Feature synthesis<a class="headerlink" href="#feature-synthesis" title="Permalink to this headline">#</a></h2>
<p>We have already known many techniques to transform a single feature, but how about their combinations? Of course Data Scientists can use their domain knowledge in a creative way to create new ones, but there are still many combinations we would never even think about. To effectively do this, we need to (1) create so many features and (2) select the best ones from them.</p>
<p>The first problem is exactly what <a class="reference external" href="https://featuretools.alteryx.com/en/stable/index.html">Featuretools</a> solves, via an algorithm called <a class="reference external" href="https://featuretools.alteryx.com/en/stable/getting_started/afe.html">Deep Feature Synthesis</a> (DFS). It has the abiliy to generate new features from a single table or from a number of related tables, automatically and efficiency.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ft</span><span class="o">.</span><span class="n">list_primitives</span><span class="p">()</span>\
    <span class="o">.</span><span class="n">remove_columns</span><span class="p">([</span><span class="s1">&#39;spark_compatible&#39;</span><span class="p">,</span> <span class="s1">&#39;dask_compatible&#39;</span><span class="p">])</span>\
    <span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;../output/featuretools_primitives.csv&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="transform-within-a-table">
<h3>2.1. Transform within a table<a class="headerlink" href="#transform-within-a-table" title="Permalink to this headline">#</a></h3>
<p>In the most basic level of DFS, it allows us to specify a list of transformations (by class or string identifier), each can automatically find valid columns and transform them. Transformations in Featuretools can process one or many input columns.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dfYoutube</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;../data/youtube_trending.csv&#39;</span><span class="p">)</span>
<span class="n">dfYoutube</span> <span class="o">=</span> <span class="p">(</span><span class="n">dfYoutube</span>
    <span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="s1">&#39;trending_date&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="s1">&#39;publish_time&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">T%H:%M:%S.</span><span class="si">%f</span><span class="s1">Z&#39;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="s1">&#39;video_id&#39;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">remove_columns</span><span class="p">([</span><span class="s1">&#39;channel_title&#39;</span><span class="p">,</span> <span class="s1">&#39;category_id&#39;</span><span class="p">])</span>
    <span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="s1">&#39;video_id&#39;</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">dfYoutube</span><span class="o">.</span><span class="n">dtypes</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>video_id                     object
trending_date        datetime64[ns]
publish_time         datetime64[ns]
views                         int64
likes                         int64
dislikes                      int64
comment_count                 int64
comments_disabled              bool
ratings_disabled               bool
dtype: object
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">es</span> <span class="o">=</span> <span class="n">ft</span><span class="o">.</span><span class="n">EntitySet</span><span class="p">()</span>
<span class="n">es</span> <span class="o">=</span> <span class="n">es</span><span class="o">.</span><span class="n">add_dataframe</span><span class="p">(</span>
    <span class="n">dataframe</span><span class="o">=</span><span class="n">dfYoutube</span><span class="p">,</span>
    <span class="n">dataframe_name</span><span class="o">=</span><span class="s1">&#39;dfYoutube&#39;</span><span class="p">,</span>
    <span class="n">index</span><span class="o">=</span><span class="s1">&#39;video_id&#39;</span><span class="p">,</span>
    <span class="n">time_index</span><span class="o">=</span><span class="s1">&#39;publish_time&#39;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dfRich</span><span class="p">,</span> <span class="n">definitions</span> <span class="o">=</span> <span class="n">ft</span><span class="o">.</span><span class="n">dfs</span><span class="p">(</span>
    <span class="n">entityset</span><span class="o">=</span><span class="n">es</span><span class="p">,</span>
    <span class="n">target_dataframe_name</span><span class="o">=</span><span class="s1">&#39;dfYoutube&#39;</span><span class="p">,</span>
    <span class="n">trans_primitives</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;hour&#39;</span><span class="p">,</span> <span class="s1">&#39;square_root&#39;</span><span class="p">,</span> <span class="n">ft</span><span class="o">.</span><span class="n">primitives</span><span class="o">.</span><span class="n">AddNumericScalar</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="s1">&#39;add_numeric&#39;</span><span class="p">],</span>
    <span class="n">max_depth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">ignore_columns</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;transactions&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;comments_disabled&#39;</span><span class="p">,</span> <span class="s1">&#39;comments_disabled&#39;</span><span class="p">]}</span>
<span class="p">)</span>
<span class="n">dfRich</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>views</th>
      <th>likes</th>
      <th>dislikes</th>
      <th>comment_count</th>
      <th>comments_disabled</th>
      <th>ratings_disabled</th>
      <th>comment_count + dislikes</th>
      <th>comment_count + likes</th>
      <th>comment_count + views</th>
      <th>dislikes + likes</th>
      <th>...</th>
      <th>comment_count + 2</th>
      <th>dislikes + 2</th>
      <th>likes + 2</th>
      <th>views + 2</th>
      <th>HOUR(publish_time)</th>
      <th>HOUR(trending_date)</th>
      <th>SQUARE_ROOT(comment_count)</th>
      <th>SQUARE_ROOT(dislikes)</th>
      <th>SQUARE_ROOT(likes)</th>
      <th>SQUARE_ROOT(views)</th>
    </tr>
    <tr>
      <th>video_id</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>wFEAoF7RC7Y</th>
      <td>86744</td>
      <td>469</td>
      <td>4</td>
      <td>105</td>
      <td>False</td>
      <td>False</td>
      <td>109.0</td>
      <td>574.0</td>
      <td>86849.0</td>
      <td>473.0</td>
      <td>...</td>
      <td>107.0</td>
      <td>6.0</td>
      <td>471.0</td>
      <td>86746.0</td>
      <td>0</td>
      <td>0</td>
      <td>10.246951</td>
      <td>2.0</td>
      <td>21.656408</td>
      <td>294.523344</td>
    </tr>
    <tr>
      <th>Y8JGfi4MJ8k</th>
      <td>26482</td>
      <td>78</td>
      <td>1</td>
      <td>7</td>
      <td>False</td>
      <td>False</td>
      <td>8.0</td>
      <td>85.0</td>
      <td>26489.0</td>
      <td>79.0</td>
      <td>...</td>
      <td>9.0</td>
      <td>3.0</td>
      <td>80.0</td>
      <td>26484.0</td>
      <td>12</td>
      <td>0</td>
      <td>2.645751</td>
      <td>1.0</td>
      <td>8.831761</td>
      <td>162.732910</td>
    </tr>
    <tr>
      <th>rO_mAQC9bv0</th>
      <td>15382</td>
      <td>33</td>
      <td>1</td>
      <td>10</td>
      <td>False</td>
      <td>False</td>
      <td>11.0</td>
      <td>43.0</td>
      <td>15392.0</td>
      <td>34.0</td>
      <td>...</td>
      <td>12.0</td>
      <td>3.0</td>
      <td>35.0</td>
      <td>15384.0</td>
      <td>0</td>
      <td>0</td>
      <td>3.162278</td>
      <td>1.0</td>
      <td>5.744563</td>
      <td>124.024191</td>
    </tr>
    <tr>
      <th>2vQ_fnlvvr8</th>
      <td>45096</td>
      <td>287</td>
      <td>9</td>
      <td>59</td>
      <td>False</td>
      <td>False</td>
      <td>68.0</td>
      <td>346.0</td>
      <td>45155.0</td>
      <td>296.0</td>
      <td>...</td>
      <td>61.0</td>
      <td>11.0</td>
      <td>289.0</td>
      <td>45098.0</td>
      <td>1</td>
      <td>0</td>
      <td>7.681146</td>
      <td>3.0</td>
      <td>16.941074</td>
      <td>212.358188</td>
    </tr>
    <tr>
      <th>-37nIo_tLnk</th>
      <td>2863</td>
      <td>2</td>
      <td>0</td>
      <td>0</td>
      <td>False</td>
      <td>False</td>
      <td>0.0</td>
      <td>2.0</td>
      <td>2863.0</td>
      <td>2.0</td>
      <td>...</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>4.0</td>
      <td>2865.0</td>
      <td>23</td>
      <td>0</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>1.414214</td>
      <td>53.507009</td>
    </tr>
  </tbody>
</table>
<p>5 rows  22 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">_</span> <span class="o">=</span> <span class="p">[</span><span class="n">ft</span><span class="o">.</span><span class="n">describe_feature</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span> <span class="o">|</span> <span class="n">p</span><span class="p">(</span><span class="nb">print</span><span class="p">)</span> <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">definitions</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The &quot;views&quot;.
The &quot;likes&quot;.
The &quot;dislikes&quot;.
The &quot;comment_count&quot;.
The &quot;comments_disabled&quot;.
The &quot;ratings_disabled&quot;.
The sum of the &quot;comment_count&quot; and the &quot;dislikes&quot;.
The sum of the &quot;comment_count&quot; and the &quot;likes&quot;.
The sum of the &quot;comment_count&quot; and the &quot;views&quot;.
The sum of the &quot;dislikes&quot; and the &quot;likes&quot;.
The sum of the &quot;dislikes&quot; and the &quot;views&quot;.
The sum of the &quot;likes&quot; and the &quot;views&quot;.
The sum of the &quot;comment_count&quot; and 2.
The sum of the &quot;dislikes&quot; and 2.
The sum of the &quot;likes&quot; and 2.
The sum of the &quot;views&quot; and 2.
The hour value of the &quot;publish_time&quot;.
The hour value of the &quot;trending_date&quot;.
The square root of the &quot;comment_count&quot;.
The square root of the &quot;dislikes&quot;.
The square root of the &quot;likes&quot;.
The square root of the &quot;views&quot;.
</pre></div>
</div>
</div>
</div>
</section>
<section id="aggregating-across-tables">
<h3>2.2. Aggregating across tables<a class="headerlink" href="#aggregating-across-tables" title="Permalink to this headline">#</a></h3>
<p>This is the true power of DFS, working on multiple tables in a relation database to create features. We are going through all concepts to get this done: entity set and transmitives.</p>
<section id="entity-set">
<h4>Entity set<a class="headerlink" href="#entity-set" title="Permalink to this headline">#</a></h4>
<p><a class="reference external" href="https://featuretools.alteryx.com/en/stable/getting_started/using_entitysets.html">Entity set</a> is how Featuretools represents a relation database, in which each dataframe is an entity. The best practice to work with <a class="reference external" href="https://featuretools.alteryx.com/en/stable/generated/featuretools.EntitySet.html"><code class="docutils literal notranslate"><span class="pre">EntitySet</span></code></a> is to first create an empty one, then add dataframes and relationships once at a time. Here are some notices when calling <a class="reference external" href="https://featuretools.alteryx.com/en/stable/generated/featuretools.EntitySet.add_dataframe.html"><code class="docutils literal notranslate"><span class="pre">add_dataframe()</span></code></a> and <a class="reference external" href="https://featuretools.alteryx.com/en/stable/generated/featuretools.EntitySet.add_relationship.html"><code class="docutils literal notranslate"><span class="pre">add_relationship()</span></code></a> methods:</p>
<ul class="simple">
<li><p>Each entity must have a name (id), an index column (primary key), and can optionally have a datetime index column.</p></li>
<li><p>Relationships between entities are expected to be one-to-many, or parent-child. For example, a customer (parent) may have many transactions (children).</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">ft</span><span class="o">.</span><span class="n">demo</span><span class="o">.</span><span class="n">load_mock_customer</span><span class="p">()</span>
<span class="n">dfCustomer</span><span class="p">,</span> <span class="n">dfSession</span><span class="p">,</span> <span class="n">dfTransaction</span><span class="p">,</span> <span class="n">dfProduct</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dfCustomer</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>customer_id</th>
      <th>zip_code</th>
      <th>join_date</th>
      <th>birthday</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>60091</td>
      <td>2011-04-17 10:48:33</td>
      <td>1994-07-18</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>13244</td>
      <td>2012-04-15 23:31:04</td>
      <td>1986-08-18</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>13244</td>
      <td>2011-08-13 15:42:34</td>
      <td>2003-11-21</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dfSession</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>session_id</th>
      <th>customer_id</th>
      <th>device</th>
      <th>session_start</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>2</td>
      <td>desktop</td>
      <td>2014-01-01 00:00:00</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>5</td>
      <td>mobile</td>
      <td>2014-01-01 00:17:20</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>4</td>
      <td>mobile</td>
      <td>2014-01-01 00:28:10</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dfTransaction</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>transaction_id</th>
      <th>session_id</th>
      <th>transaction_time</th>
      <th>product_id</th>
      <th>amount</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>298</th>
      <td>298</td>
      <td>1</td>
      <td>2014-01-01 00:00:00</td>
      <td>5</td>
      <td>127.64</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2</td>
      <td>1</td>
      <td>2014-01-01 00:01:05</td>
      <td>2</td>
      <td>109.48</td>
    </tr>
    <tr>
      <th>308</th>
      <td>308</td>
      <td>1</td>
      <td>2014-01-01 00:02:10</td>
      <td>3</td>
      <td>95.06</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">es</span> <span class="o">=</span> <span class="n">ft</span><span class="o">.</span><span class="n">EntitySet</span><span class="p">(</span><span class="s1">&#39;CustomerProfile&#39;</span><span class="p">)</span>

<span class="n">es</span><span class="o">.</span><span class="n">add_dataframe</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">dfCustomer</span><span class="p">,</span> <span class="n">dataframe_name</span><span class="o">=</span><span class="s1">&#39;dfCustomer&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="s1">&#39;customer_id&#39;</span><span class="p">)</span>
<span class="n">es</span><span class="o">.</span><span class="n">add_dataframe</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">dfSession</span><span class="p">,</span> <span class="n">dataframe_name</span><span class="o">=</span><span class="s1">&#39;dfSession&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="s1">&#39;session_id&#39;</span><span class="p">)</span>
<span class="n">es</span><span class="o">.</span><span class="n">add_dataframe</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">dfTransaction</span><span class="p">,</span> <span class="n">dataframe_name</span><span class="o">=</span><span class="s1">&#39;dfTransaction&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="s1">&#39;transaction_id&#39;</span><span class="p">)</span>
<span class="n">es</span><span class="o">.</span><span class="n">add_dataframe</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">dfProduct</span><span class="p">,</span> <span class="n">dataframe_name</span><span class="o">=</span><span class="s1">&#39;dfProduct&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="s1">&#39;product_id&#39;</span><span class="p">)</span>

<span class="n">es</span><span class="o">.</span><span class="n">add_relationship</span><span class="p">(</span><span class="s1">&#39;dfCustomer&#39;</span><span class="p">,</span> <span class="s1">&#39;customer_id&#39;</span><span class="p">,</span> <span class="s1">&#39;dfSession&#39;</span><span class="p">,</span> <span class="s1">&#39;customer_id&#39;</span><span class="p">)</span>
<span class="n">es</span><span class="o">.</span><span class="n">add_relationship</span><span class="p">(</span><span class="s1">&#39;dfSession&#39;</span><span class="p">,</span> <span class="s1">&#39;session_id&#39;</span><span class="p">,</span> <span class="s1">&#39;dfTransaction&#39;</span><span class="p">,</span> <span class="s1">&#39;session_id&#39;</span><span class="p">)</span>
<span class="n">es</span><span class="o">.</span><span class="n">add_relationship</span><span class="p">(</span><span class="s1">&#39;dfProduct&#39;</span><span class="p">,</span> <span class="s1">&#39;product_id&#39;</span><span class="p">,</span> <span class="s1">&#39;dfTransaction&#39;</span><span class="p">,</span> <span class="s1">&#39;product_id&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Entityset: CustomerProfile
  DataFrames:
    dfCustomer [Rows: 5, Columns: 4]
    dfSession [Rows: 35, Columns: 4]
    dfTransaction [Rows: 500, Columns: 5]
    dfProduct [Rows: 5, Columns: 2]
  Relationships:
    dfSession.customer_id -&gt; dfCustomer.customer_id
    dfTransaction.session_id -&gt; dfSession.session_id
    dfTransaction.product_id -&gt; dfProduct.product_id
</pre></div>
</div>
</div>
</div>
</section>
<section id="primitives">
<h4>Primitives<a class="headerlink" href="#primitives" title="Permalink to this headline">#</a></h4>
<p><a class="reference external" href="https://featuretools.alteryx.com/en/stable/getting_started/primitives.html">Primitives</a> are building blocks of Featuretools, they define individual computations that can be applied to raw datasets to create new features. There are two types of primitive, transformation and aggregation, they are both a function but have different signatures:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\text{Transformation}:\text{scalar}\rightarrow\text{scalar}\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(\text{Aggregation}:\text{vector}\rightarrow\text{scalar}\)</span></p></li>
</ul>
<p>We can see their applications here: transformations process one or more existing columns and return a new one, while aggregations handle one-to-many relationships by grouping children then return a representative statistic for the parent. The full documentation of primitives can be found in <a class="reference external" href="https://primitives.featurelabs.com/">Featurelabs</a> or <a class="reference external" href="https://featuretools.alteryx.com/en/stable/api_reference.html#feature-primitives">API reference</a>.</p>
<p>During implementation via the function <a class="reference external" href="https://featuretools.alteryx.com/en/stable/generated/featuretools.dfs.html"><code class="docutils literal notranslate"><span class="pre">dfs()</span></code></a>, we specify a maximum depth to control how many primitives can be stacked.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dfRich</span><span class="p">,</span> <span class="n">definitions</span> <span class="o">=</span> <span class="n">ft</span><span class="o">.</span><span class="n">dfs</span><span class="p">(</span>
    <span class="n">entityset</span><span class="o">=</span><span class="n">es</span><span class="p">,</span>
    <span class="n">target_dataframe_name</span><span class="o">=</span><span class="s1">&#39;dfCustomer&#39;</span><span class="p">,</span>
    <span class="n">trans_primitives</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;hour&#39;</span><span class="p">,</span> <span class="s1">&#39;cum_mean&#39;</span><span class="p">],</span>
    <span class="n">agg_primitives</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;sum&#39;</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;count&#39;</span><span class="p">,</span> <span class="s1">&#39;std&#39;</span><span class="p">],</span>
    <span class="n">max_depth</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
    <span class="n">ignore_columns</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dfTransaction&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;session_id&#39;</span><span class="p">,</span><span class="s1">&#39;customer_id&#39;</span><span class="p">,</span><span class="s1">&#39;zip_code&#39;</span><span class="p">]}</span>
<span class="p">)</span>

<span class="n">definitions</span> <span class="o">|</span> <span class="n">p</span><span class="p">(</span><span class="nb">len</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>135
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">definitions</span><span class="p">[</span><span class="mi">100</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Feature: SUM(dfSession.STD(dfTransaction.dfProduct.COUNT(dfTransaction)))&gt;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ft</span><span class="o">.</span><span class="n">describe_feature</span><span class="p">(</span><span class="n">definitions</span><span class="p">[</span><span class="mi">100</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;The sum of the standard deviation of the number of all instances of &quot;dfTransaction&quot; for each &quot;product_id&quot; in &quot;dfProduct&quot; for the instance of &quot;dfProduct&quot; associated with this instance of &quot;dfTransaction&quot; of all instances of &quot;dfTransaction&quot; for each &quot;session_id&quot; in &quot;dfSession&quot; of all instances of &quot;dfSession&quot; for each &quot;customer_id&quot; in &quot;dfCustomer&quot;.&#39;
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="pipeline">
<h2>3. Pipeline<a class="headerlink" href="#pipeline" title="Permalink to this headline">#</a></h2>
<p>A data science project has multiple steps of getting data, cleaning, transforming, modeling and evalutating. To make the complicated process to become easier, Scikit-learn provides the <a class="reference external" href="https://scikit-learn.org/stable/modules/compose.html">pipeline</a> module. The purpose of the pipeline is to assemble several steps sequentially and can be reused for different datasets in the future.</p>
<section id="id1">
<h3>3.1. Data preprocessing<a class="headerlink" href="#id1" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dfTitanic</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;../data/titanic_train.csv&#39;</span><span class="p">)</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">dfTitanic</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s1">&#39;Survived&#39;</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">dfTitanic</span><span class="o">.</span><span class="n">Survived</span>

<span class="n">xTrain</span><span class="p">,</span> <span class="n">xTest</span><span class="p">,</span> <span class="n">yTrain</span><span class="p">,</span> <span class="n">yTest</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">xTrain</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>PassengerId</th>
      <th>Pclass</th>
      <th>Name</th>
      <th>Sex</th>
      <th>Age</th>
      <th>SibSp</th>
      <th>Parch</th>
      <th>Ticket</th>
      <th>Fare</th>
      <th>Cabin</th>
      <th>Embarked</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>205</th>
      <td>206</td>
      <td>3</td>
      <td>Strom, Miss. Telma Matilda</td>
      <td>female</td>
      <td>2.0</td>
      <td>0</td>
      <td>1</td>
      <td>347054</td>
      <td>10.4625</td>
      <td>G6</td>
      <td>S</td>
    </tr>
    <tr>
      <th>718</th>
      <td>719</td>
      <td>3</td>
      <td>McEvoy, Mr. Michael</td>
      <td>male</td>
      <td>NaN</td>
      <td>0</td>
      <td>0</td>
      <td>36568</td>
      <td>15.5000</td>
      <td>NaN</td>
      <td>Q</td>
    </tr>
    <tr>
      <th>835</th>
      <td>836</td>
      <td>1</td>
      <td>Compton, Miss. Sara Rebecca</td>
      <td>female</td>
      <td>39.0</td>
      <td>1</td>
      <td>1</td>
      <td>PC 17756</td>
      <td>83.1583</td>
      <td>E49</td>
      <td>C</td>
    </tr>
    <tr>
      <th>851</th>
      <td>852</td>
      <td>3</td>
      <td>Svensson, Mr. Johan</td>
      <td>male</td>
      <td>74.0</td>
      <td>0</td>
      <td>0</td>
      <td>347060</td>
      <td>7.7750</td>
      <td>NaN</td>
      <td>S</td>
    </tr>
    <tr>
      <th>773</th>
      <td>774</td>
      <td>3</td>
      <td>Elias, Mr. Dibo</td>
      <td>male</td>
      <td>NaN</td>
      <td>0</td>
      <td>0</td>
      <td>2674</td>
      <td>7.2250</td>
      <td>NaN</td>
      <td>C</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<section id="simple-pipeline">
<h4>Simple pipeline<a class="headerlink" href="#simple-pipeline" title="Permalink to this headline">#</a></h4>
<p>A simple preprocesing pipeline applies transformers to all columns. Provided via the class <a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.pipeline.Pipeline.html"><code class="docutils literal notranslate"><span class="pre">Pipeline</span></code></a>, the main component we would care about is the steps, which is constructed using a list of tuples with the signature
<code class="docutils literal notranslate"><span class="pre">(name,</span> <span class="pre">transformer)</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">trans</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
    <span class="p">(</span><span class="s1">&#39;Impute&#39;</span><span class="p">,</span> <span class="n">SimpleImputer</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">)),</span>
    <span class="p">(</span><span class="s1">&#39;Scale&#39;</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">()),</span>
<span class="p">])</span>

<span class="n">trans</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">xTrain</span><span class="p">[[</span><span class="s1">&#39;Age&#39;</span><span class="p">,</span> <span class="s1">&#39;Fare&#39;</span><span class="p">]])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[-2.1265, -0.431 ],
       [-0.    , -0.3352],
       [ 0.7519,  0.951 ],
       ...,
       [ 0.0518,  1.3934],
       [-0.    , -0.4826],
       [-0.8818, -0.4806]])
</pre></div>
</div>
</div>
</div>
</section>
<section id="column-transformer">
<h4>Column transformer<a class="headerlink" href="#column-transformer" title="Permalink to this headline">#</a></h4>
<p>The problem arises when we would probably want to apply diffrent pipelines to different subsets of features such as categorical and numerical. To tackle this, Scikit-learn provides the class <a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.compose.ColumnTransformer.html"><code class="docutils literal notranslate"><span class="pre">ColumnTransformer</span></code></a> which accepts a list of tuples with the signature <code class="docutils literal notranslate"><span class="pre">(name,</span> <span class="pre">transformer,</span> <span class="pre">columns)</span></code>.</p>
<p>We can use any Scikit-learns transformer stand alone as well as a pipeline. To specify columns, the best practice is using column names, but the class also accepts column indices. Also note that if a feature appears in different steps, only the first step takes effect.</p>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">name1</span> <span class="o">=</span> <span class="s1">&#39;Categorical1&#39;</span>
<span class="n">cols1</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Ticket&#39;</span><span class="p">,</span> <span class="s1">&#39;Cabin&#39;</span><span class="p">]</span>
<span class="n">trans1</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
    <span class="p">(</span><span class="s1">&#39;Impute&#39;</span><span class="p">,</span> <span class="n">SimpleImputer</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s1">&#39;constant&#39;</span><span class="p">)),</span>
    <span class="p">(</span><span class="s1">&#39;Encode&#39;</span><span class="p">,</span> <span class="n">OrdinalEncoder</span><span class="p">(</span><span class="n">handle_unknown</span><span class="o">=</span><span class="s1">&#39;use_encoded_value&#39;</span><span class="p">,</span> <span class="n">unknown_value</span><span class="o">=-</span><span class="mi">1</span><span class="p">))</span>
<span class="p">])</span>

<span class="n">name2</span> <span class="o">=</span> <span class="s1">&#39;Categorical2&#39;</span>
<span class="n">cols2</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Sex&#39;</span><span class="p">,</span> <span class="s1">&#39;Embarked&#39;</span><span class="p">]</span>
<span class="n">trans2</span> <span class="o">=</span> <span class="n">OneHotEncoder</span><span class="p">(</span><span class="n">handle_unknown</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>

<span class="n">name3</span> <span class="o">=</span> <span class="s1">&#39;Numerical&#39;</span>
<span class="n">cols3</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Age&#39;</span><span class="p">,</span> <span class="s1">&#39;Fare&#39;</span><span class="p">]</span>
<span class="n">trans3</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
    <span class="p">(</span><span class="s1">&#39;Impute&#39;</span><span class="p">,</span> <span class="n">KNNImputer</span><span class="p">(</span><span class="n">n_neighbors</span><span class="o">=</span><span class="mi">5</span><span class="p">)),</span>
    <span class="p">(</span><span class="s1">&#39;Scale&#39;</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">()),</span>
    <span class="p">(</span><span class="s1">&#39;Transform&#39;</span><span class="p">,</span> <span class="n">FunctionTransformer</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>
<span class="p">])</span>

<span class="n">name4</span> <span class="o">=</span> <span class="s1">&#39;Integer&#39;</span>
<span class="n">cols4</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Pclass&#39;</span><span class="p">,</span> <span class="s1">&#39;SibSp&#39;</span><span class="p">,</span> <span class="s1">&#39;Parch&#39;</span><span class="p">]</span>
<span class="n">trans4</span> <span class="o">=</span> <span class="s1">&#39;passthrough&#39;</span>

<span class="n">name5</span> <span class="o">=</span> <span class="s1">&#39;Unique&#39;</span>
<span class="n">cols5</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;PassengerId&#39;</span><span class="p">,</span> <span class="s1">&#39;Name&#39;</span><span class="p">]</span>
<span class="n">trans5</span> <span class="o">=</span> <span class="s1">&#39;drop&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">trans</span> <span class="o">=</span> <span class="n">ColumnTransformer</span><span class="p">([</span>
    <span class="p">(</span><span class="n">name1</span><span class="p">,</span> <span class="n">trans1</span><span class="p">,</span> <span class="n">cols1</span><span class="p">),</span>
    <span class="p">(</span><span class="n">name2</span><span class="p">,</span> <span class="n">trans2</span><span class="p">,</span> <span class="n">cols2</span><span class="p">),</span>
    <span class="p">(</span><span class="n">name3</span><span class="p">,</span> <span class="n">trans3</span><span class="p">,</span> <span class="n">cols3</span><span class="p">),</span>
    <span class="p">(</span><span class="n">name4</span><span class="p">,</span> <span class="n">trans4</span><span class="p">,</span> <span class="n">cols4</span><span class="p">),</span>
    <span class="p">(</span><span class="n">name5</span><span class="p">,</span> <span class="n">trans5</span><span class="p">,</span> <span class="n">cols5</span><span class="p">),</span>
<span class="p">])</span>

<span class="n">trans</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">xTrain</span><span class="p">)</span>
<span class="n">trans</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>#sk-container-id-1 {color: black;background-color: white;}#sk-container-id-1 pre{padding: 0;}#sk-container-id-1 div.sk-toggleable {background-color: white;}#sk-container-id-1 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-1 label.sk-toggleable__label-arrow:before {content: "";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-1 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-1 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-1 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-1 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-1 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-1 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "";}#sk-container-id-1 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-1 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-1 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-1 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-1 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-1 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-1 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-1 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-1 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-1 div.sk-item {position: relative;z-index: 1;}#sk-container-id-1 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-1 div.sk-item::before, #sk-container-id-1 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-1 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-1 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-1 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-1 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-1 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-1 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-1 div.sk-label-container {text-align: center;}#sk-container-id-1 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-1 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-1" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>ColumnTransformer(transformers=[(&#x27;Categorical1&#x27;,
                                 Pipeline(steps=[(&#x27;Impute&#x27;,
                                                  SimpleImputer(strategy=&#x27;constant&#x27;)),
                                                 (&#x27;Encode&#x27;,
                                                  OrdinalEncoder(handle_unknown=&#x27;use_encoded_value&#x27;,
                                                                 unknown_value=-1))]),
                                 [&#x27;Ticket&#x27;, &#x27;Cabin&#x27;]),
                                (&#x27;Categorical2&#x27;,
                                 OneHotEncoder(handle_unknown=&#x27;ignore&#x27;),
                                 [&#x27;Sex&#x27;, &#x27;Embarked&#x27;]),
                                (&#x27;Numerical&#x27;,
                                 Pipeline(steps=[(&#x27;Impute&#x27;, KNNImputer()),
                                                 (&#x27;Scale&#x27;, StandardScaler()),
                                                 (&#x27;Transform&#x27;,
                                                  FunctionTransformer(func=&lt;function &lt;lambda&gt; at 0x7fd2ee59ed30&gt;))]),
                                 [&#x27;Age&#x27;, &#x27;Fare&#x27;]),
                                (&#x27;Integer&#x27;, &#x27;passthrough&#x27;,
                                 [&#x27;Pclass&#x27;, &#x27;SibSp&#x27;, &#x27;Parch&#x27;]),
                                (&#x27;Unique&#x27;, &#x27;drop&#x27;, [&#x27;PassengerId&#x27;, &#x27;Name&#x27;])])</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-1" type="checkbox" ><label for="sk-estimator-id-1" class="sk-toggleable__label sk-toggleable__label-arrow">ColumnTransformer</label><div class="sk-toggleable__content"><pre>ColumnTransformer(transformers=[(&#x27;Categorical1&#x27;,
                                 Pipeline(steps=[(&#x27;Impute&#x27;,
                                                  SimpleImputer(strategy=&#x27;constant&#x27;)),
                                                 (&#x27;Encode&#x27;,
                                                  OrdinalEncoder(handle_unknown=&#x27;use_encoded_value&#x27;,
                                                                 unknown_value=-1))]),
                                 [&#x27;Ticket&#x27;, &#x27;Cabin&#x27;]),
                                (&#x27;Categorical2&#x27;,
                                 OneHotEncoder(handle_unknown=&#x27;ignore&#x27;),
                                 [&#x27;Sex&#x27;, &#x27;Embarked&#x27;]),
                                (&#x27;Numerical&#x27;,
                                 Pipeline(steps=[(&#x27;Impute&#x27;, KNNImputer()),
                                                 (&#x27;Scale&#x27;, StandardScaler()),
                                                 (&#x27;Transform&#x27;,
                                                  FunctionTransformer(func=&lt;function &lt;lambda&gt; at 0x7fd2ee59ed30&gt;))]),
                                 [&#x27;Age&#x27;, &#x27;Fare&#x27;]),
                                (&#x27;Integer&#x27;, &#x27;passthrough&#x27;,
                                 [&#x27;Pclass&#x27;, &#x27;SibSp&#x27;, &#x27;Parch&#x27;]),
                                (&#x27;Unique&#x27;, &#x27;drop&#x27;, [&#x27;PassengerId&#x27;, &#x27;Name&#x27;])])</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-2" type="checkbox" ><label for="sk-estimator-id-2" class="sk-toggleable__label sk-toggleable__label-arrow">Categorical1</label><div class="sk-toggleable__content"><pre>[&#x27;Ticket&#x27;, &#x27;Cabin&#x27;]</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-3" type="checkbox" ><label for="sk-estimator-id-3" class="sk-toggleable__label sk-toggleable__label-arrow">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(strategy=&#x27;constant&#x27;)</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-4" type="checkbox" ><label for="sk-estimator-id-4" class="sk-toggleable__label sk-toggleable__label-arrow">OrdinalEncoder</label><div class="sk-toggleable__content"><pre>OrdinalEncoder(handle_unknown=&#x27;use_encoded_value&#x27;, unknown_value=-1)</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-5" type="checkbox" ><label for="sk-estimator-id-5" class="sk-toggleable__label sk-toggleable__label-arrow">Categorical2</label><div class="sk-toggleable__content"><pre>[&#x27;Sex&#x27;, &#x27;Embarked&#x27;]</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-6" type="checkbox" ><label for="sk-estimator-id-6" class="sk-toggleable__label sk-toggleable__label-arrow">OneHotEncoder</label><div class="sk-toggleable__content"><pre>OneHotEncoder(handle_unknown=&#x27;ignore&#x27;)</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-7" type="checkbox" ><label for="sk-estimator-id-7" class="sk-toggleable__label sk-toggleable__label-arrow">Numerical</label><div class="sk-toggleable__content"><pre>[&#x27;Age&#x27;, &#x27;Fare&#x27;]</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-8" type="checkbox" ><label for="sk-estimator-id-8" class="sk-toggleable__label sk-toggleable__label-arrow">KNNImputer</label><div class="sk-toggleable__content"><pre>KNNImputer()</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-9" type="checkbox" ><label for="sk-estimator-id-9" class="sk-toggleable__label sk-toggleable__label-arrow">StandardScaler</label><div class="sk-toggleable__content"><pre>StandardScaler()</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-10" type="checkbox" ><label for="sk-estimator-id-10" class="sk-toggleable__label sk-toggleable__label-arrow">FunctionTransformer</label><div class="sk-toggleable__content"><pre>FunctionTransformer(func=&lt;function &lt;lambda&gt; at 0x7fd2ee59ed30&gt;)</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-11" type="checkbox" ><label for="sk-estimator-id-11" class="sk-toggleable__label sk-toggleable__label-arrow">Integer</label><div class="sk-toggleable__content"><pre>[&#x27;Pclass&#x27;, &#x27;SibSp&#x27;, &#x27;Parch&#x27;]</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-12" type="checkbox" ><label for="sk-estimator-id-12" class="sk-toggleable__label sk-toggleable__label-arrow">passthrough</label><div class="sk-toggleable__content"><pre>passthrough</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-13" type="checkbox" ><label for="sk-estimator-id-13" class="sk-toggleable__label sk-toggleable__label-arrow">Unique</label><div class="sk-toggleable__content"><pre>[&#x27;PassengerId&#x27;, &#x27;Name&#x27;]</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-14" type="checkbox" ><label for="sk-estimator-id-14" class="sk-toggleable__label sk-toggleable__label-arrow">drop</label><div class="sk-toggleable__content"><pre>drop</pre></div></div></div></div></div></div></div></div></div></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">trans</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">xTest</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[ -1., 126.,   0., ...,   3.,   0.,   0.],
       [ -1., 126.,   0., ...,   2.,   1.,   0.],
       [ -1., 126.,   0., ...,   3.,   0.,   0.],
       ...,
       [ -1., 126.,   0., ...,   3.,   0.,   0.],
       [ -1., 126.,   0., ...,   3.,   0.,   0.],
       [475., 126.,   1., ...,   2.,   1.,   0.]])
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="modeling">
<h3>3.2. Modeling<a class="headerlink" href="#modeling" title="Permalink to this headline">#</a></h3>
<p>A <code class="docutils literal notranslate"><span class="pre">Pipeline</span></code> is very useful for data preprocessing, but it can also be used for modeling.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dfTitanic</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;../data/titanic_train.csv&#39;</span><span class="p">)</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">dfTitanic</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s1">&#39;Survived&#39;</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">dfTitanic</span><span class="o">.</span><span class="n">Survived</span>

<span class="n">xTrain</span><span class="p">,</span> <span class="n">xTest</span><span class="p">,</span> <span class="n">yTrain</span><span class="p">,</span> <span class="n">yTest</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">xTrain</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>PassengerId</th>
      <th>Pclass</th>
      <th>Name</th>
      <th>Sex</th>
      <th>Age</th>
      <th>SibSp</th>
      <th>Parch</th>
      <th>Ticket</th>
      <th>Fare</th>
      <th>Cabin</th>
      <th>Embarked</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>205</th>
      <td>206</td>
      <td>3</td>
      <td>Strom, Miss. Telma Matilda</td>
      <td>female</td>
      <td>2.0</td>
      <td>0</td>
      <td>1</td>
      <td>347054</td>
      <td>10.4625</td>
      <td>G6</td>
      <td>S</td>
    </tr>
    <tr>
      <th>718</th>
      <td>719</td>
      <td>3</td>
      <td>McEvoy, Mr. Michael</td>
      <td>male</td>
      <td>NaN</td>
      <td>0</td>
      <td>0</td>
      <td>36568</td>
      <td>15.5000</td>
      <td>NaN</td>
      <td>Q</td>
    </tr>
    <tr>
      <th>835</th>
      <td>836</td>
      <td>1</td>
      <td>Compton, Miss. Sara Rebecca</td>
      <td>female</td>
      <td>39.0</td>
      <td>1</td>
      <td>1</td>
      <td>PC 17756</td>
      <td>83.1583</td>
      <td>E49</td>
      <td>C</td>
    </tr>
    <tr>
      <th>851</th>
      <td>852</td>
      <td>3</td>
      <td>Svensson, Mr. Johan</td>
      <td>male</td>
      <td>74.0</td>
      <td>0</td>
      <td>0</td>
      <td>347060</td>
      <td>7.7750</td>
      <td>NaN</td>
      <td>S</td>
    </tr>
    <tr>
      <th>773</th>
      <td>774</td>
      <td>3</td>
      <td>Elias, Mr. Dibo</td>
      <td>male</td>
      <td>NaN</td>
      <td>0</td>
      <td>0</td>
      <td>2674</td>
      <td>7.2250</td>
      <td>NaN</td>
      <td>C</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">name1</span> <span class="o">=</span> <span class="s1">&#39;Categorical1&#39;</span>
<span class="n">cols1</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Ticket&#39;</span><span class="p">,</span> <span class="s1">&#39;Cabin&#39;</span><span class="p">]</span>
<span class="n">trans1</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
    <span class="p">(</span><span class="s1">&#39;Impute&#39;</span><span class="p">,</span> <span class="n">SimpleImputer</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s1">&#39;constant&#39;</span><span class="p">)),</span>
    <span class="p">(</span><span class="s1">&#39;Encode&#39;</span><span class="p">,</span> <span class="n">OrdinalEncoder</span><span class="p">(</span><span class="n">handle_unknown</span><span class="o">=</span><span class="s1">&#39;use_encoded_value&#39;</span><span class="p">,</span> <span class="n">unknown_value</span><span class="o">=-</span><span class="mi">1</span><span class="p">))</span>
<span class="p">])</span>

<span class="n">name2</span> <span class="o">=</span> <span class="s1">&#39;Categorical2&#39;</span>
<span class="n">cols2</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Sex&#39;</span><span class="p">,</span> <span class="s1">&#39;Embarked&#39;</span><span class="p">]</span>
<span class="n">trans2</span> <span class="o">=</span> <span class="n">OneHotEncoder</span><span class="p">(</span><span class="n">handle_unknown</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>

<span class="n">name3</span> <span class="o">=</span> <span class="s1">&#39;Numerical&#39;</span>
<span class="n">cols3</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Age&#39;</span><span class="p">,</span> <span class="s1">&#39;Fare&#39;</span><span class="p">]</span>
<span class="n">trans3</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
    <span class="p">(</span><span class="s1">&#39;Impute&#39;</span><span class="p">,</span> <span class="n">KNNImputer</span><span class="p">(</span><span class="n">n_neighbors</span><span class="o">=</span><span class="mi">5</span><span class="p">)),</span>
    <span class="p">(</span><span class="s1">&#39;Scale&#39;</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">()),</span>
<span class="p">])</span>

<span class="n">name4</span> <span class="o">=</span> <span class="s1">&#39;Integer&#39;</span>
<span class="n">cols4</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Pclass&#39;</span><span class="p">,</span> <span class="s1">&#39;SibSp&#39;</span><span class="p">,</span> <span class="s1">&#39;Parch&#39;</span><span class="p">]</span>
<span class="n">trans4</span> <span class="o">=</span> <span class="s1">&#39;passthrough&#39;</span>

<span class="n">name5</span> <span class="o">=</span> <span class="s1">&#39;Unique&#39;</span>
<span class="n">cols5</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;PassengerId&#39;</span><span class="p">,</span> <span class="s1">&#39;Name&#39;</span><span class="p">]</span>
<span class="n">trans5</span> <span class="o">=</span> <span class="s1">&#39;drop&#39;</span>
</pre></div>
</div>
</div>
</div>
<section id="grid-search">
<h4>Grid search<a class="headerlink" href="#grid-search" title="Permalink to this headline">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">trans</span> <span class="o">=</span> <span class="n">ColumnTransformer</span><span class="p">([</span>
    <span class="p">(</span><span class="n">name1</span><span class="p">,</span> <span class="n">trans1</span><span class="p">,</span> <span class="n">cols1</span><span class="p">),</span>
    <span class="p">(</span><span class="n">name2</span><span class="p">,</span> <span class="n">trans2</span><span class="p">,</span> <span class="n">cols2</span><span class="p">),</span>
    <span class="p">(</span><span class="n">name3</span><span class="p">,</span> <span class="n">trans3</span><span class="p">,</span> <span class="n">cols3</span><span class="p">),</span>
    <span class="p">(</span><span class="n">name4</span><span class="p">,</span> <span class="n">trans4</span><span class="p">,</span> <span class="n">cols4</span><span class="p">),</span>
    <span class="p">(</span><span class="n">name5</span><span class="p">,</span> <span class="n">trans5</span><span class="p">,</span> <span class="n">cols5</span><span class="p">),</span>
<span class="p">])</span>

<span class="n">modelRf</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>

<span class="n">pipe</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
    <span class="p">(</span><span class="s1">&#39;Transformer&#39;</span><span class="p">,</span> <span class="n">trans</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;ModelRF&#39;</span><span class="p">,</span> <span class="n">modelRf</span><span class="p">)</span>
<span class="p">])</span>
<span class="n">pipe</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>#sk-container-id-2 {color: black;background-color: white;}#sk-container-id-2 pre{padding: 0;}#sk-container-id-2 div.sk-toggleable {background-color: white;}#sk-container-id-2 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-2 label.sk-toggleable__label-arrow:before {content: "";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-2 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-2 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-2 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-2 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-2 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-2 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "";}#sk-container-id-2 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-2 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-2 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-2 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-2 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-2 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-2 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-2 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-2 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-2 div.sk-item {position: relative;z-index: 1;}#sk-container-id-2 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-2 div.sk-item::before, #sk-container-id-2 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-2 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-2 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-2 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-2 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-2 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-2 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-2 div.sk-label-container {text-align: center;}#sk-container-id-2 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-2 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-2" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>Pipeline(steps=[(&#x27;Transformer&#x27;,
                 ColumnTransformer(transformers=[(&#x27;Categorical1&#x27;,
                                                  Pipeline(steps=[(&#x27;Impute&#x27;,
                                                                   SimpleImputer(strategy=&#x27;constant&#x27;)),
                                                                  (&#x27;Encode&#x27;,
                                                                   OrdinalEncoder(handle_unknown=&#x27;use_encoded_value&#x27;,
                                                                                  unknown_value=-1))]),
                                                  [&#x27;Ticket&#x27;, &#x27;Cabin&#x27;]),
                                                 (&#x27;Categorical2&#x27;,
                                                  OneHotEncoder(handle_unknown=&#x27;ignore&#x27;),
                                                  [&#x27;Sex&#x27;, &#x27;Embarked&#x27;]),
                                                 (&#x27;Numerical&#x27;,
                                                  Pipeline(steps=[(&#x27;Impute&#x27;,
                                                                   KNNImputer()),
                                                                  (&#x27;Scale&#x27;,
                                                                   StandardScaler())]),
                                                  [&#x27;Age&#x27;, &#x27;Fare&#x27;]),
                                                 (&#x27;Integer&#x27;, &#x27;passthrough&#x27;,
                                                  [&#x27;Pclass&#x27;, &#x27;SibSp&#x27;, &#x27;Parch&#x27;]),
                                                 (&#x27;Unique&#x27;, &#x27;drop&#x27;,
                                                  [&#x27;PassengerId&#x27;, &#x27;Name&#x27;])])),
                (&#x27;ModelRF&#x27;, RandomForestClassifier(random_state=7))])</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-15" type="checkbox" ><label for="sk-estimator-id-15" class="sk-toggleable__label sk-toggleable__label-arrow">Pipeline</label><div class="sk-toggleable__content"><pre>Pipeline(steps=[(&#x27;Transformer&#x27;,
                 ColumnTransformer(transformers=[(&#x27;Categorical1&#x27;,
                                                  Pipeline(steps=[(&#x27;Impute&#x27;,
                                                                   SimpleImputer(strategy=&#x27;constant&#x27;)),
                                                                  (&#x27;Encode&#x27;,
                                                                   OrdinalEncoder(handle_unknown=&#x27;use_encoded_value&#x27;,
                                                                                  unknown_value=-1))]),
                                                  [&#x27;Ticket&#x27;, &#x27;Cabin&#x27;]),
                                                 (&#x27;Categorical2&#x27;,
                                                  OneHotEncoder(handle_unknown=&#x27;ignore&#x27;),
                                                  [&#x27;Sex&#x27;, &#x27;Embarked&#x27;]),
                                                 (&#x27;Numerical&#x27;,
                                                  Pipeline(steps=[(&#x27;Impute&#x27;,
                                                                   KNNImputer()),
                                                                  (&#x27;Scale&#x27;,
                                                                   StandardScaler())]),
                                                  [&#x27;Age&#x27;, &#x27;Fare&#x27;]),
                                                 (&#x27;Integer&#x27;, &#x27;passthrough&#x27;,
                                                  [&#x27;Pclass&#x27;, &#x27;SibSp&#x27;, &#x27;Parch&#x27;]),
                                                 (&#x27;Unique&#x27;, &#x27;drop&#x27;,
                                                  [&#x27;PassengerId&#x27;, &#x27;Name&#x27;])])),
                (&#x27;ModelRF&#x27;, RandomForestClassifier(random_state=7))])</pre></div></div></div><div class="sk-serial"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-16" type="checkbox" ><label for="sk-estimator-id-16" class="sk-toggleable__label sk-toggleable__label-arrow">Transformer: ColumnTransformer</label><div class="sk-toggleable__content"><pre>ColumnTransformer(transformers=[(&#x27;Categorical1&#x27;,
                                 Pipeline(steps=[(&#x27;Impute&#x27;,
                                                  SimpleImputer(strategy=&#x27;constant&#x27;)),
                                                 (&#x27;Encode&#x27;,
                                                  OrdinalEncoder(handle_unknown=&#x27;use_encoded_value&#x27;,
                                                                 unknown_value=-1))]),
                                 [&#x27;Ticket&#x27;, &#x27;Cabin&#x27;]),
                                (&#x27;Categorical2&#x27;,
                                 OneHotEncoder(handle_unknown=&#x27;ignore&#x27;),
                                 [&#x27;Sex&#x27;, &#x27;Embarked&#x27;]),
                                (&#x27;Numerical&#x27;,
                                 Pipeline(steps=[(&#x27;Impute&#x27;, KNNImputer()),
                                                 (&#x27;Scale&#x27;, StandardScaler())]),
                                 [&#x27;Age&#x27;, &#x27;Fare&#x27;]),
                                (&#x27;Integer&#x27;, &#x27;passthrough&#x27;,
                                 [&#x27;Pclass&#x27;, &#x27;SibSp&#x27;, &#x27;Parch&#x27;]),
                                (&#x27;Unique&#x27;, &#x27;drop&#x27;, [&#x27;PassengerId&#x27;, &#x27;Name&#x27;])])</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-17" type="checkbox" ><label for="sk-estimator-id-17" class="sk-toggleable__label sk-toggleable__label-arrow">Categorical1</label><div class="sk-toggleable__content"><pre>[&#x27;Ticket&#x27;, &#x27;Cabin&#x27;]</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-18" type="checkbox" ><label for="sk-estimator-id-18" class="sk-toggleable__label sk-toggleable__label-arrow">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(strategy=&#x27;constant&#x27;)</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-19" type="checkbox" ><label for="sk-estimator-id-19" class="sk-toggleable__label sk-toggleable__label-arrow">OrdinalEncoder</label><div class="sk-toggleable__content"><pre>OrdinalEncoder(handle_unknown=&#x27;use_encoded_value&#x27;, unknown_value=-1)</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-20" type="checkbox" ><label for="sk-estimator-id-20" class="sk-toggleable__label sk-toggleable__label-arrow">Categorical2</label><div class="sk-toggleable__content"><pre>[&#x27;Sex&#x27;, &#x27;Embarked&#x27;]</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-21" type="checkbox" ><label for="sk-estimator-id-21" class="sk-toggleable__label sk-toggleable__label-arrow">OneHotEncoder</label><div class="sk-toggleable__content"><pre>OneHotEncoder(handle_unknown=&#x27;ignore&#x27;)</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-22" type="checkbox" ><label for="sk-estimator-id-22" class="sk-toggleable__label sk-toggleable__label-arrow">Numerical</label><div class="sk-toggleable__content"><pre>[&#x27;Age&#x27;, &#x27;Fare&#x27;]</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-23" type="checkbox" ><label for="sk-estimator-id-23" class="sk-toggleable__label sk-toggleable__label-arrow">KNNImputer</label><div class="sk-toggleable__content"><pre>KNNImputer()</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-24" type="checkbox" ><label for="sk-estimator-id-24" class="sk-toggleable__label sk-toggleable__label-arrow">StandardScaler</label><div class="sk-toggleable__content"><pre>StandardScaler()</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-25" type="checkbox" ><label for="sk-estimator-id-25" class="sk-toggleable__label sk-toggleable__label-arrow">Integer</label><div class="sk-toggleable__content"><pre>[&#x27;Pclass&#x27;, &#x27;SibSp&#x27;, &#x27;Parch&#x27;]</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-26" type="checkbox" ><label for="sk-estimator-id-26" class="sk-toggleable__label sk-toggleable__label-arrow">passthrough</label><div class="sk-toggleable__content"><pre>passthrough</pre></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-27" type="checkbox" ><label for="sk-estimator-id-27" class="sk-toggleable__label sk-toggleable__label-arrow">Unique</label><div class="sk-toggleable__content"><pre>[&#x27;PassengerId&#x27;, &#x27;Name&#x27;]</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-28" type="checkbox" ><label for="sk-estimator-id-28" class="sk-toggleable__label sk-toggleable__label-arrow">drop</label><div class="sk-toggleable__content"><pre>drop</pre></div></div></div></div></div></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-29" type="checkbox" ><label for="sk-estimator-id-29" class="sk-toggleable__label sk-toggleable__label-arrow">RandomForestClassifier</label><div class="sk-toggleable__content"><pre>RandomForestClassifier(random_state=7)</pre></div></div></div></div></div></div></div></div></div>
</div>
<p>Now we have prepare a pipeline, lets see how to use it with grid search. We have already known grid search is used to find the best hyperparameters of a model, but when coming with pipeline, it can also be used to search for the best configurations of preprocessing steps.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">start</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>

<span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;Transformer__Numerical__Impute__n_neighbors&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">],</span>
    <span class="s1">&#39;ModelRF__n_estimators&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">30</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">70</span><span class="p">],</span>
    <span class="s1">&#39;ModelRF__max_features&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">],</span>
    <span class="s1">&#39;ModelRF__max_samples&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">],</span>
<span class="p">}</span>
<span class="n">validator</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">pipe</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;roc_auc&#39;</span><span class="p">)</span>
<span class="n">validator</span> <span class="o">=</span> <span class="n">validator</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">xTrain</span><span class="p">,</span> <span class="n">yTrain</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0:00:16.232052
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">validator</span><span class="o">.</span><span class="n">best_params_</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;ModelRF__max_features&#39;: 0.4,
 &#39;ModelRF__max_samples&#39;: 0.4,
 &#39;ModelRF__n_estimators&#39;: 70,
 &#39;Transformer__Numerical__Impute__n_neighbors&#39;: 5}
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">yTestPred</span> <span class="o">=</span> <span class="n">validator</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">xTest</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">auc</span> <span class="o">=</span> <span class="n">AUC</span><span class="p">(</span><span class="n">yTest</span><span class="p">,</span> <span class="n">yTestPred</span><span class="p">)</span>
<span class="n">modelName</span> <span class="o">=</span> <span class="n">validator</span><span class="o">.</span><span class="n">best_estimator_</span><span class="o">.</span><span class="n">steps</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;AUC = </span><span class="si">{</span><span class="n">auc</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1"> [</span><span class="si">{</span><span class="n">modelName</span><span class="si">}</span><span class="s1">]&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>AUC = 0.7995 [RandomForestClassifier]
</pre></div>
</div>
</div>
</div>
</section>
<section id="model-selection">
<h4>Model selection<a class="headerlink" href="#model-selection" title="Permalink to this headline">#</a></h4>
<p>To adapt pipeline to select among multiple Machine Learning algorithms, we need some tricks.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">trans</span> <span class="o">=</span> <span class="n">ColumnTransformer</span><span class="p">([</span>
    <span class="p">(</span><span class="n">name1</span><span class="p">,</span> <span class="n">trans1</span><span class="p">,</span> <span class="n">cols1</span><span class="p">),</span>
    <span class="p">(</span><span class="n">name2</span><span class="p">,</span> <span class="n">trans2</span><span class="p">,</span> <span class="n">cols2</span><span class="p">),</span>
    <span class="p">(</span><span class="n">name3</span><span class="p">,</span> <span class="n">trans3</span><span class="p">,</span> <span class="n">cols3</span><span class="p">),</span>
    <span class="p">(</span><span class="n">name4</span><span class="p">,</span> <span class="n">trans4</span><span class="p">,</span> <span class="n">cols4</span><span class="p">),</span>
    <span class="p">(</span><span class="n">name5</span><span class="p">,</span> <span class="n">trans5</span><span class="p">,</span> <span class="n">cols5</span><span class="p">),</span>
<span class="p">])</span>

<span class="n">pipe</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
    <span class="p">(</span><span class="s1">&#39;Transformer&#39;</span><span class="p">,</span> <span class="n">trans</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;Model&#39;</span><span class="p">,</span> <span class="n">RandomForestClassifier</span><span class="p">())</span>
<span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">start</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>

<span class="n">params</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="s1">&#39;Transformer__Numerical__Impute__n_neighbors&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">],</span>
        <span class="s1">&#39;Model&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">RandomForestClassifier</span><span class="p">()],</span>
        <span class="s1">&#39;Model__n_estimators&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">80</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span>
        <span class="s1">&#39;Model__max_samples&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s1">&#39;Transformer__Numerical__Impute__n_neighbors&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">],</span>
        <span class="s1">&#39;Model&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">HistGradientBoostingClassifier</span><span class="p">()],</span>
        <span class="s1">&#39;Model__max_iter&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">80</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span>
        <span class="s1">&#39;Model__learning_rate&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">],</span>
    <span class="p">}</span>
<span class="p">]</span>

<span class="n">validator</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">pipe</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;roc_auc&#39;</span><span class="p">)</span>
<span class="n">validator</span> <span class="o">=</span> <span class="n">validator</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">xTrain</span><span class="p">,</span> <span class="n">yTrain</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0:00:21.043318
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">validator</span><span class="o">.</span><span class="n">best_params_</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;Model&#39;: HistGradientBoostingClassifier(learning_rate=0.05),
 &#39;Model__learning_rate&#39;: 0.05,
 &#39;Model__max_iter&#39;: 100,
 &#39;Transformer__Numerical__Impute__n_neighbors&#39;: 5}
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">yTestPred</span> <span class="o">=</span> <span class="n">validator</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">xTest</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">auc</span> <span class="o">=</span> <span class="n">AUC</span><span class="p">(</span><span class="n">yTest</span><span class="p">,</span> <span class="n">yTestPred</span><span class="p">)</span>
<span class="n">modelName</span> <span class="o">=</span> <span class="n">validator</span><span class="o">.</span><span class="n">best_estimator_</span><span class="o">.</span><span class="n">steps</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;AUC = </span><span class="si">{</span><span class="n">auc</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1"> [</span><span class="si">{</span><span class="n">modelName</span><span class="si">}</span><span class="s1">]&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>AUC = 0.8102 [HistGradientBoostingClassifier]
</pre></div>
</div>
</div>
</div>
</section>
<section id="saving-a-model">
<h4>Saving a model<a class="headerlink" href="#saving-a-model" title="Permalink to this headline">#</a></h4>
<p>The built-in package <a class="reference external" href="https://docs.python.org/3/library/pickle.html">Pickle</a> in python let us save the model into a file and load it again to make prediction. This helps us saving the time to train the model from the begin each time we use it. In case the model is too big, <a class="reference external" href="https://joblib.readthedocs.io/en/latest/">Joblib</a> is a good alternative. The extension of pickle files can be anything, but is usually <code class="docutils literal notranslate"><span class="pre">.p</span></code>, <code class="docutils literal notranslate"><span class="pre">.pkl</span></code>, <code class="docutils literal notranslate"><span class="pre">.pickle</span></code> as Pickle uses Pickle protocol to read the data inside the file and ignores the extension.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pickle</span>
<span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;../output/pipeline_model.pkl&#39;</span>

<span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">validator</span><span class="p">,</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">))</span>

<span class="n">modelLoaded</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">))</span>

<span class="n">yTestPred</span> <span class="o">=</span> <span class="n">modelLoaded</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">xTest</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">auc</span> <span class="o">=</span> <span class="n">AUC</span><span class="p">(</span><span class="n">yTest</span><span class="p">,</span> <span class="n">yTestPred</span><span class="p">)</span>
<span class="n">modelName</span> <span class="o">=</span> <span class="n">modelLoaded</span><span class="o">.</span><span class="n">best_estimator_</span><span class="o">.</span><span class="n">steps</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;AUC = </span><span class="si">{</span><span class="n">auc</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1"> [</span><span class="si">{</span><span class="n">modelName</span><span class="si">}</span><span class="s1">]&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>AUC = 0.8102 [HistGradientBoostingClassifier]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">joblib</span>
<span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;../output/pipeline_model.joblib&#39;</span>

<span class="n">joblib</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">validator</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>

<span class="n">modelLoaded</span> <span class="o">=</span> <span class="n">joblib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

<span class="n">yTestPred</span> <span class="o">=</span> <span class="n">modelLoaded</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">xTest</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">auc</span> <span class="o">=</span> <span class="n">AUC</span><span class="p">(</span><span class="n">yTest</span><span class="p">,</span> <span class="n">yTestPred</span><span class="p">)</span>
<span class="n">modelName</span> <span class="o">=</span> <span class="n">modelLoaded</span><span class="o">.</span><span class="n">best_estimator_</span><span class="o">.</span><span class="n">steps</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;AUC = </span><span class="si">{</span><span class="n">auc</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1"> [</span><span class="si">{</span><span class="n">modelName</span><span class="si">}</span><span class="s1">]&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>AUC = 0.8102 [HistGradientBoostingClassifier]
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="resources">
<h2>Resources<a class="headerlink" href="#resources" title="Permalink to this headline">#</a></h2>
<ul class="simple">
<li><p><em>featuretools.alteryx - <a class="reference external" href="https://featuretools.alteryx.com/en/stable/">Documentation</a></em></p></li>
<li><p><em>contrib.scikit-learn - <a class="reference external" href="https://contrib.scikit-learn.org/category_encoders/">Category encoders</a></em></p></li>
<li><p><em>kaggle - <a class="reference external" href="https://www.kaggle.com/code/subinium/11-categorical-encoders-and-benchmark">11 categorical encoders and benchmarks</a></em></p></li>
<li><p><em>kaggle - <a class="reference external" href="https://www.kaggle.com/code/willkoehrsen/automated-feature-engineering-basics/notebook#Deep-Feature-Synthesis">Automated feature engineering basics</a></em></p></li>
<li><p><em>medium - <a class="reference external" href="https://towardsdatascience.com/benchmarking-categorical-encoders-9c322bd77ee8">Benchmarking categorical encoders</a></em></p></li>
<li><p><em>medium - <a class="reference external" href="https://towardsdatascience.com/automated-feature-engineering-in-python-99baf11cc219">Automated feature engineering in Python</a></em></p></li>
<li><p><em>medium - <a class="reference external" href="https://towardsdatascience.com/all-about-categorical-variable-encoding-305f3361fd02">All about categorical variable encoding</a></em></p></li>
<li><p><em>listendata - <a class="reference external" href="https://www.listendata.com/2015/03/weight-of-evidence-woe-and-information.html">Weight of Evidence and Information value explained</a></em></p></li>
</ul>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "hungpq7/tabular-book",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./06-machine-learning"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="sklearn-regression.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Sklearn: Regression</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="lenskit-recommendation.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Lenskit: Recommendation</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Quang Hung &#9829; Thuy Linh<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>